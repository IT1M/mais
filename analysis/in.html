<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate-key="pageTitle">Smart Business Analytics - Saudi Mais Co</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: white;
            overflow-x: hidden;
            perspective: 2000px;
            min-height: 100vh;
        }

        .language-switcher {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1001;
            display: flex;
            gap: 10px;
        }

        html[dir="rtl"] .language-switcher {
            left: auto;
            right: 20px;
        }

        .lang-btn {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: white;
            cursor: pointer;
            border-radius: 20px;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .lang-btn:hover, .lang-btn.active {
            background: linear-gradient(45deg, #00c6ff, #0072ff);
            border-color: transparent;
        }


        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            transform-style: preserve-3d;
        }

        .header {
            text-align: center;
            padding: 80px 0 40px 0; /* Increased top padding for lang switcher & API status */
            transform: translateZ(100px);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateZ(100px) translateY(0px); }
            50% { transform: translateZ(120px) translateY(-20px); }
        }

        .header h1 {
            font-size: 3.5em;
            background: linear-gradient(45deg, #00c6ff, #0072ff, #ff6b6b);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(0, 198, 255, 0.5);
            margin-bottom: 20px;
        }
        
        .navigation {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
            transform: translateZ(50px);
        }

        .nav-btn {
            padding: 12px 25px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            transform: translateZ(10px);
            border: 2px solid transparent;
        }

        .nav-btn:hover, .nav-btn.active {
            transform: translateZ(20px) scale(1.05);
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .section {
            display: none;
            animation: fadeInUp 0.6s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .company-info {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 30px;
            margin: 30px 0;
            transform: translateZ(50px) rotateX(5deg);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.5s ease;
        }

        .company-info:hover {
            transform: translateZ(80px) rotateX(0deg) scale(1.02);
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 30px;
            margin: 40px 0;
            transform-style: preserve-3d;
        }

        .analysis-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            transform: translateZ(40px);
            box-shadow: 
                0 15px 35px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.6s cubic-bezier(0.23, 1, 0.320, 1);
            position: relative;
            overflow: hidden;
        }

        .analysis-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s;
        }
        html[dir="rtl"] .analysis-card::before {
            left: auto;
            right: -100%;
            background: linear-gradient(-90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: right 0.6s;
        }


        .analysis-card:hover::before {
            left: 100%;
        }
        html[dir="rtl"] .analysis-card:hover::before {
            left: auto;
            right: 100%;
        }

        .analysis-card:hover {
            transform: translateZ(80px) rotateY(5deg);
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        html[dir="rtl"] .analysis-card:hover {
            transform: translateZ(80px) rotateY(-5deg); /* Invert Y rotation for RTL */
        }


        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        html[dir="rtl"] .card-header {
            flex-direction: row-reverse; /* Icon on the right */
        }


        .card-icon {
            font-size: 2.5em;
            margin-right: 15px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        html[dir="rtl"] .card-icon {
            margin-right: 0;
            margin-left: 15px;
        }


        .input-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .input-options {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap; /* Allow wrapping on small screens */
        }

        .option-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option-btn.active {
            background: linear-gradient(45deg, #00c6ff, #0072ff);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .input-area {
            display: none;
        }

        .input-area.active {
            display: block;
        }

        .text-input, .focus-input {
            width: 100%;
            min-height: 120px;
            background: rgba(0, 0, 0, 0.2); /* Darker input */
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            padding: 15px;
            font-size: 16px;
            resize: vertical;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
        }
        html[dir="rtl"] .text-input, html[dir="rtl"] .focus-input {
            text-align: right;
        }

        .text-input::placeholder, .focus-input::placeholder {
            color: rgba(255, 255, 255, 0.5); /* Lighter placeholder */
        }
        html[dir="rtl"] .text-input::placeholder, html[dir="rtl"] .focus-input::placeholder {
            text-align: right;
        }


        .focus-input {
            height: 80px;
            font-size: 14px;
            margin-top: 10px;
        }

        .file-upload-area { /* Wrapper for file input and status */
             margin-bottom: 15px;
        }

        .file-upload {
            width: 100%;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2); /* Darker upload area */
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            background: rgba(0, 0, 0, 0.3);
            border-color: rgba(0, 198, 255, 0.7);
        }

        .file-upload input {
            display: none;
        }
        
        .file-status-display {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top:10px;
        }
        .file-status-display p {
            margin-bottom: 5px;
        }
        .file-status-display .file-name {
            font-weight: bold;
            color: #00c6ff;
        }
        .file-status-display .file-preview {
            font-size: 0.9em;
            opacity: 0.8;
            max-height: 60px;
            overflow-y: auto;
            background: rgba(0,0,0,0.2);
            padding: 5px;
            border-radius: 5px;
            margin-top:5px;
            border: 1px solid rgba(255,255,255,0.1);
        }


        .gemini-integration {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 25px;
            padding: 40px;
            margin: 40px 0;
            transform: translateZ(60px);
            box-shadow: 0 30px 60px rgba(102, 126, 234, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .gemini-chat {
            background: rgba(0,0,0, 0.2); /* Darker chat */
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            min-height: 400px;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.3);
        }
        html[dir="rtl"] .gemini-chat p {
            text-align: right;
        }
        
        .gemini-chat p {
            margin-bottom: 15px;
            line-height: 1.7;
        }
        .gemini-chat p strong { /* User/AI Name */
            color: #00c6ff;
            display: block;
            margin-bottom: 3px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .input-group input {
            flex: 1;
            min-width: 200px;
            padding: 15px;
            background: rgba(0,0,0, 0.3); /* Darker input */
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: white;
            font-size: 16px;
        }
        html[dir="rtl"] .input-group input {
            text-align: right;
        }


        .input-group input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        html[dir="rtl"] .input-group input::placeholder {
            text-align: right;
        }

        .btn {
            padding: 15px 25px;
            background: linear-gradient(45deg, #00c6ff, #0072ff);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            transform: translateZ(10px);
            white-space: nowrap;
            margin: 5px; /* Added for wrap spacing */
        }

        .btn:hover {
            transform: translateZ(20px) scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 114, 255, 0.4);
        }

        .export-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            font-size: 12px;
            padding: 10px 15px;
        }

        .export-btn:hover {
            box-shadow: 0 10px 20px rgba(40, 167, 69, 0.4);
        }

        .chart-container {
            background: rgba(0,0,0,0.15); /* Darker chart bg */
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            transform: translateZ(30px);
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.2);
            height: 300px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transform: translateZ(40px);
            transition: all 0.4s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-card:hover {
            transform: translateZ(60px) scale(1.05);
            background: rgba(255, 255, 255, 0.15);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 10px 0;
        }

        .recommendations { /* This class was present but not used in HTML. Retaining for potential future use. */
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            color: #333;
            border-radius: 25px;
            padding: 40px;
            margin: 40px 0;
            transform: translateZ(50px);
            box-shadow: 0 25px 50px rgba(255, 154, 158, 0.3);
        }
        html[dir="rtl"] .recommendations {
             text-align: right;
        }

        .solution-card {
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid rgba(76, 175, 80, 0.3);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            transform: translateZ(35px);
            transition: all 0.4s ease;
        }

        .solution-card:hover {
            transform: translateZ(55px);
            background: rgba(76, 175, 80, 0.2);
        }

        /* محسن - تصميم مخرجات النتائج */
        .results-section {
            background: rgba(10, 20, 30, 0.6); /* Darker, more distinct background */
            backdrop-filter: blur(30px); /* Increased blur */
            -webkit-backdrop-filter: blur(30px);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            border: 1px solid rgba(0, 198, 255, 0.4); /* Themed border */
            max-height: 700px; /* Consider increasing for desktop */
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5), inset 0 0 20px rgba(0, 198, 255, 0.15); /* Enhanced shadow */
            position: relative;
        }

        .results-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px; /* Thicker highlight bar */
            background: linear-gradient(90deg, #00c6ff, #0072ff, #ff6b6b);
            border-radius: 20px 20px 0 0;
        }
        html[dir="rtl"] .results-section::before {
            background: linear-gradient(-90deg, #00c6ff, #0072ff, #ff6b6b); /* Invert gradient for RTL */
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px; /* Increased margin */
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(0, 198, 255, 0.25); /* Themed border */
            flex-wrap: wrap;
            gap: 15px;
        }
        html[dir="rtl"] .results-header {
            flex-direction: row-reverse; /* Ensure controls are on the left */
        }


        .results-header h4 {
            font-size: 1.8em; /* Larger title */
            background: linear-gradient(45deg, #00c6ff, #4ecdc4);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 12px rgba(0, 198, 255, 0.6); /* Enhanced text shadow */
        }

        .export-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .api-status {
            position: fixed;
            top: 20px;
            right: 20px; 
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        html[dir="rtl"] .api-status {
            right: auto;
            left: 20px; 
        }

        .api-connected {
            background: rgba(76, 175, 80, 0.9);
            color: white;
        }

        .api-disconnected {
            background: rgba(244, 67, 54, 0.9);
            color: white;
        }

        .status-messages {
            background: rgba(0,0,0, 0.2); /* Darker status messages */
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            font-size: 14px;
            display: none;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        html[dir="rtl"] .status-messages {
            text-align: right;
        }


        .status-step {
            margin: 8px 0;
            opacity: 0.7;
            transition: all 0.3s ease;
            padding: 5px 0;
        }

        .status-step.active {
            opacity: 1;
            color: #00c6ff;
            font-weight: bold;
        }

        /* تحسين تنسيق المحتوى */
        .formatted-content {
            line-height: 1.8;
            font-size: 16px; /* Slightly larger base font for results */
        }
        html[dir="rtl"] .formatted-content {
            text-align: right;
        }

        .formatted-content h1 {
            color: #00c6ff;
            font-size: 2em; /* Larger H1 */
            margin: 30px 0 20px 0;
            padding: 15px 0;
            border-bottom: 2px solid rgba(0, 198, 255, 0.4);
            background: linear-gradient(45deg, #00c6ff, #4ecdc4);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 8px rgba(0, 198, 255, 0.3);
        }

        .formatted-content h2 {
            color: #4cecbc; /* Brighter H2 */
            font-size: 1.7em;
            margin: 25px 0 15px 0;
            padding: 12px 0 10px 0;
            border-left: 4px solid #4cecbc;
            padding-left: 15px;
        }
        html[dir="rtl"] .formatted-content h2 {
            border-left: none;
            border-right: 4px solid #4cecbc;
            padding-left: 0;
            padding-right: 15px;
        }


        .formatted-content h3 {
            color: #ff7b7b; /* Brighter H3 */
            font-size: 1.4em;
            margin: 20px 0 12px 0;
            padding: 10px 0;
        }

        .formatted-content h4 {
            color: #ffb74e; /* Brighter H4 */
            font-size: 1.2em;
            margin: 18px 0 10px 0;
        }

        .formatted-content ul, .formatted-content ol {
            margin: 18px 0;
            padding-left: 30px; /* More indent */
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 20px 30px; /* More padding inside list bg */
            border: 1px solid rgba(255,255,255,0.08);
        }
        html[dir="rtl"] .formatted-content ul, html[dir="rtl"] .formatted-content ol {
            padding-left: 0;
            padding-right: 30px;
        }


        .formatted-content li {
            margin: 10px 0; /* More spacing for li */
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .formatted-content li:last-child {
            border-bottom: none;
        }

        .formatted-content p {
            margin: 15px 0;
            text-align: justify; 
        }
        /* Removed empty ruleset: html[dir="rtl"] .formatted-content p */

        .formatted-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            background: rgba(0, 0, 0, 0.15); /* Darker table */
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .formatted-content th, .formatted-content td {
            border: 1px solid rgba(255, 255, 255, 0.15); /* Slightly more visible border */
            padding: 14px 18px; /* More padding */
            text-align: left; 
        }
        html[dir="rtl"] .formatted-content th, html[dir="rtl"] .formatted-content td {
            text-align: right;
        }

        .formatted-content th {
            background: rgba(0, 198, 255, 0.25); /* More prominent th */
            font-weight: bold;
            color: #00e0ff; /* Brighter th text */
        }

        .formatted-content td {
            background: rgba(255, 255, 255, 0.03); /* Slightly lighter td for contrast */
        }

        .formatted-content strong {
            color: #5effd1; /* Brighter strong */
            font-weight: bold;
        }

        .formatted-content em {
            color: #ff8b8b; /* Brighter em */
            font-style: italic;
        }

        .formatted-content blockquote {
            background: rgba(0, 0, 0, 0.1); /* Darker blockquote */
            border-left: 5px solid #00c6ff; 
            margin: 20px 0;
            padding: 20px 25px;
            border-radius: 0 10px 10px 0; 
            font-style: italic;
            box-shadow: inset 3px 0 8px rgba(0,0,0,0.2);
        }
        html[dir="rtl"] .formatted-content blockquote {
            border-left: none;
            border-right: 5px solid #00c6ff;
            border-radius: 10px 0 0 10px;
        }

        /* تحسين بطاقات النتائج المتخصصة */
        .analysis-result-card { /* Main container for a "section" of results */
            background: rgba(255, 255, 255, 0.04); /* Slightly lighter than section bg */
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.12);
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .analysis-result-card:hover {
            background: rgba(255, 255, 255, 0.07);
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .analysis-result-card h2, .analysis-result-card h3 { /* Titles within result cards */
            margin-top: 0; /* Remove default top margin for titles inside these cards */
            border-left: none; /* Remove default h2 border if it's inside */
            padding-left: 0;
        }
        html[dir="rtl"] .analysis-result-card h2, html[dir="rtl"] .analysis-result-card h3 {
            border-right: none;
            padding-right: 0;
        }


        .result-icon { /* Generic icon styling if needed */
            font-size: 2em;
            margin-bottom: 10px;
            display: block;
            color: #00c6ff; /* Example color */
        }

        .metric-card {
            background: linear-gradient(135deg, rgba(0, 198, 255, 0.15), rgba(76, 236, 196, 0.15)); /* Slightly stronger gradient */
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0; /* Increased margin */
            text-align: center;
            border: 1px solid rgba(0, 198, 255, 0.3); /* More visible border */
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .metric-value {
            font-size: 2.4em; /* Slightly larger */
            font-weight: bold;
            color: #00d2ff; /* Brighter */
            margin: 10px 0;
        }

        .metric-label {
            font-size: 1em; /* Larger label */
            opacity: 0.85;
            margin-top: 8px;
        }

        .quality-indicator {
            display: inline-block;
            padding: 6px 14px; /* More padding */
            border-radius: 20px;
            font-size: 0.9em; /* Slightly larger */
            font-weight: bold;
            margin: 5px; /* More margin */
            text-transform: uppercase; /* Make it stand out */
            letter-spacing: 0.5px;
        }

        .quality-excellent {
            background: rgba(76, 175, 80, 0.3);
            color: #66bb6a; /* Brighter green */
            border: 1px solid #66bb6a;
        }

        .quality-good {
            background: rgba(76, 236, 196, 0.3);
            color: #50e1c2; /* Brighter teal */
            border: 1px solid #50e1c2;
        }

        .quality-warning {
            background: rgba(255, 167, 38, 0.3);
            color: #ffb74d; /* Brighter orange */
            border: 1px solid #ffb74d;
        }

        .quality-critical {
            background: rgba(244, 67, 54, 0.3);
            color: #ef5350; /* Brighter red */
            border: 1px solid #ef5350;
        }

        .recommendation-box, .warning-box, .critical-box {
            border-left: 5px solid #4caf50; /* Thicker border */
            border-radius: 0 10px 10px 0;  
            padding: 25px; /* More padding */
            margin: 25px 0; /* More margin */
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        html[dir="rtl"] .recommendation-box, html[dir="rtl"] .warning-box, html[dir="rtl"] .critical-box {
            border-left: none;
            border-radius: 10px 0 0 10px;
            text-align: right;
        }

        .recommendation-box {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(139, 195, 74, 0.15));
            border-left-color: #4caf50;
        }
        html[dir="rtl"] .recommendation-box { border-right: 5px solid #4caf50; }


        .warning-box {
            background: linear-gradient(135deg, rgba(255, 167, 38, 0.15), rgba(255, 193, 7, 0.15));
            border-left-color: #ffa726;
        }
        html[dir="rtl"] .warning-box { border-right: 5px solid #ffa726; }

        .critical-box {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.15), rgba(229, 57, 53, 0.15));
            border-left-color: #f44336;
        }
        html[dir="rtl"] .critical-box { border-right: 5px solid #f44336; }

        .recommendation-box h4, .warning-box h4, .critical-box h4 {
            margin-top:0;
            margin-bottom: 10px;
            font-size: 1.3em;
        }
        .recommendation-box h4 { color: #4caf50; }
        .warning-box h4 { color: #ffa726; }
        .critical-box h4 { color: #f44336; }

        /* تحسين للهواتف المحمولة */
        @media (max-width: 768px) {
            .language-switcher {
                top: 10px;
                left: 10px;
                flex-wrap: wrap; /* Added for safety */
            }
            html[dir="rtl"] .language-switcher {
                left: auto;
                right: 10px;
            }
            .header {
                padding-top: 70px; /* More space if lang switcher wraps */
            }

            .container {
                padding: 10px; /* Slightly more padding */
            }
            .analysis-grid {
                grid-template-columns: 1fr;
            }
            .header h1 {
                font-size: 2.2em; /* Slightly larger for tablets */
            }
            
            .input-group {
                flex-direction: column;
                gap: 8px; /* Increased gap */
            }
            .navigation {
                gap: 8px; /* Increased gap */
            }
            .nav-btn {
                padding: 10px 18px; /* Slightly larger */
                font-size: 13px;
            }
            .input-options {
                flex-direction: column;
                gap: 10px;
            }
            .results-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            html[dir="rtl"] .results-header {
                align-items: flex-end;
            }
            .export-controls {
                width: 100%;
                justify-content: flex-start;
            }
            html[dir="rtl"] .export-controls {
                justify-content: flex-end;
            }
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); /* Larger minmax */
                gap: 10px;
            }
            .stat-value {
                font-size: 1.5em;
            }
            .formatted-content {
                font-size: 14px; /* Base for mobile */
            }
            .formatted-content h1 { font-size: 1.5em; }
            .formatted-content h2 { font-size: 1.3em; }
            .formatted-content h3 { font-size: 1.2em; }
            .formatted-content h4 { font-size: 1.1em; }

            .formatted-content table {
                font-size: 12px; /* Slightly larger table font */
            }
            .formatted-content th, .formatted-content td {
                padding: 8px 10px;
            }
            .metric-value {
                font-size: 1.8em; /* Larger metric value */
            }
            .results-section {
                max-height: 450px; /* Increased max-height */
                padding: 15px;
            }
            .api-status {
                position: relative; 
                top: auto; right: auto; left: auto;
                margin: 10px auto; 
                display: block;
                text-align: center;
                font-size: 13px;
                padding: 8px 12px;
                width: fit-content;
            }
            
            .card-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px; /* Increased gap */
            }
            html[dir="rtl"] .card-header {
                align-items: flex-end;
            }
            .analysis-card, .section-card { 
                padding: 20px; /* More padding */
            }
            .gemini-integration { padding: 25px; }
            .gemini-chat { min-height: 300px; max-height: 400px;}
        }

        /* تحسين للشاشات الصغيرة جداً */
        @media (max-width: 480px) {
             .language-switcher {
                top: 8px; /* More space */
                left: 8px;
                gap: 5px;
            }
            html[dir="rtl"] .language-switcher {
                left: auto;
                right: 8px;
            }
            .lang-btn {
                padding: 6px 12px; /* Slightly larger */
                font-size: 11px;
            }
            .header {
                padding-top: 60px; /* Adjust if lang switcher wraps */
            }

            .container {
                padding: 5px;
            }
            
            .header h1 {
                font-size: 1.8em; /* Readable size */
            }
             .header h2 { font-size: 1em; }
             .header p { font-size: 0.85em; }

            .nav-btn {
                padding: 8px 12px;
                font-size: 11px;
            }
            .analysis-card, .section-card {
                padding: 15px;
            }
            .input-section {
                padding: 10px;
            }
            .text-input, .focus-input {
                font-size: 13px;
                padding: 10px;
                min-height: 100px;
            }
            .focus-input { height: 70px; }
            .btn {
                padding: 10px 15px;
                font-size: 12px;
            }
            .results-section {
                padding: 10px;
                max-height: 350px; /* Increased */
            }
            .formatted-content ul, .formatted-content ol {
                padding: 10px 15px;
            }
            html[dir="rtl"] .formatted-content ul, html[dir="rtl"] .formatted-content ol {
                padding-left: 15px; 
                padding-right: 15px;
            }

            .stats-grid {
                grid-template-columns: 1fr; /* Single column for very small */
            }
            .stat-card { padding: 15px; }
            .stat-value { font-size: 1.8em; }

            .formatted-content { font-size: 13px; }
            .formatted-content h1 { font-size: 1.3em; }
            .formatted-content h2 { font-size: 1.15em; }
            .formatted-content h3 { font-size: 1.05em; }
            .formatted-content h4 { font-size: 1em; }
            .chart-container { height: 220px; padding: 10px;}
        }

        .floating-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .floating-element {
            position: absolute;
            background: rgba(255, 255, 255, 0.07); /* Slightly less visible */
            border-radius: 50%;
            animation: floatAround 20s infinite linear;
        }

        @keyframes floatAround {
            0% { transform: translateY(100vh) rotate(0deg) scale(0.8); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100px) rotate(360deg) scale(1.2); opacity: 0; }
        }

        .section-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            transform: translateZ(40px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.6s ease;
        }

        .section-card:hover {
            transform: translateZ(60px) scale(1.01); /* Subtle scale */
        }

        .results-section::-webkit-scrollbar { width: 10px; }
        .results-section::-webkit-scrollbar-track {
            background: rgba(0,0,0, 0.2);
            border-radius: 10px;
        }
        .results-section::-webkit-scrollbar-thumb {
            background: linear-gradient(0deg, #0072ff, #00c6ff); /* Vertical gradient */
            border-radius: 10px;
        }
        .results-section::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(0deg, #00c6ff, #0072ff);
        }
        
        .gemini-chat::-webkit-scrollbar { width: 8px; }
        .gemini-chat::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); border-radius: 10px; }
        .gemini-chat::-webkit-scrollbar-thumb { background: rgba(0, 198, 255, 0.5); border-radius: 10px; }
        .gemini-chat::-webkit-scrollbar-thumb:hover { background: rgba(0, 198, 255, 0.8); }


        .loading-enhanced {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 12px 18px; /* Adjusted padding */
            background: rgba(0, 198, 255, 0.15); /* Slightly more visible */
            border-radius: 10px;
            border: 1px solid rgba(0, 198, 255, 0.4); /* Stronger border */
            color: #00c6ff; /* Text color match */
            font-weight: 500;
        }

        .loading-dots {
            display: flex;
            gap: 5px; /* Increased gap */
        }

        .loading-dot {
            width: 10px; /* Larger dots */
            height: 10px;
            background: #00c6ff;
            border-radius: 50%;
            animation: loadingDots 1.4s infinite ease-in-out; /* Smoother animation */
        }

        .loading-dot:nth-child(2) { animation-delay: 0.2s; }
        .loading-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes loadingDots {
            0%, 80%, 100% { opacity: 0.4; transform: scale(0.7); }
            40% { opacity: 1; transform: scale(1.1); } /* More pronounced scale */
        }
    </style>
</head>
<body>
    <div class="language-switcher">
        <button id="lang-en" class="lang-btn" onclick="setLanguage('en')">English</button>
        <button id="lang-ar" class="lang-btn" onclick="setLanguage('ar')">العربية</button>
    </div>

    <div id="apiStatus" class="api-status api-disconnected">
        <span data-translate-key="apiStatusDisconnected">🔴 Not connected to Yazeed AI API</span>
    </div>

    <div class="floating-elements">
        <div class="floating-element" style="left: 10%; width: 60px; height: 60px; animation-delay: 0s; animation-duration: 25s;"></div>
        <div class="floating-element" style="left: 25%; width: 35px; height: 35px; animation-delay: 6s; animation-duration: 18s;"></div>
        <div class="floating-element" style="left: 75%; width: 50px; height: 50px; animation-delay: 12s; animation-duration: 30s;"></div>
        <div class="floating-element" style="left: 85%; width: 30px; height: 30px; animation-delay: 18s; animation-duration: 22s;"></div>
        <div class="floating-element" style="left: 50%; width: 45px; height: 45px; animation-delay: 3s; animation-duration: 20s;"></div>
    </div>

    <div class="container">
        <div class="header">
            <h1 data-translate-key="mainTitle">🔍 Smart Business Analytics</h1>
            <h2 data-translate-key="companyNameHeader">Saudi Mais Co. Medical Products</h2>
            <p data-translate-key="headerSubtitle">Advanced AI-powered analysis system for financial crisis resolution</p>
        </div>

        <div class="navigation">
            <button class="nav-btn active" onclick="showSection('overview')" data-translate-key="navOverview">🏠 Overview</button>
            <button class="nav-btn" onclick="showSection('advanced-analysis')" data-translate-key="navAdvancedAnalysis">📊 Advanced Analysis</button>
            <button class="nav-btn" onclick="showSection('quality-management')" data-translate-key="navQualityManagement">🏥 Quality Management</button>
            <button class="nav-btn" onclick="showSection('demand-forecasting')" data-translate-key="navDemandForecasting">📈 Demand Forecasting</button>
            <button class="nav-btn" onclick="showSection('competitor-analysis')" data-translate-key="navCompetitorAnalysis">🎯 Competitor Analysis</button>
            <button class="nav-btn" onclick="showSection('ai-chat')" data-translate-key="navAiAssistant">🤖 AI Assistant</button>
        </div>

        <!-- Overview -->
        <div id="overview" class="section active">
            <div class="company-info">
                <h3 data-translate-key="companyInfoTitle">📋 Company Information</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">1994</div>
                        <p data-translate-key="yearFounded">Year Founded</p>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" data-translate-key="riyadh">Riyadh</div>
                        <p data-translate-key="headquarters">Headquarters</p>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" data-translate-key="medical">Medical</div>
                        <p data-translate-key="specializedProducts">Specialized Products</p>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" data-translate-key="middleEast">Middle East</div>
                        <p data-translate-key="targetMarket">Target Market</p>
                    </div>
                </div>
                <p data-translate-key="overviewCompanyDesc" style="text-align: center; margin-top: 20px; opacity: 0.9;">Saudi Mais Co. is a leading provider of medical products, committed to enhancing healthcare standards in the region through innovation and quality.</p>
            </div>

            <!-- Crisis Indicator Removed -->

            <div class="analysis-grid">
                <div class="analysis-card">
                    <div class="card-header">
                        <span class="card-icon">📊</span>
                        <h3 data-translate-key="marketAnalysisTitle">Market Analysis</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="marketChart"></canvas>
                    </div>
                </div>

                <div class="analysis-card">
                    <div class="card-header">
                        <span class="card-icon">💰</span>
                        <h3 data-translate-key="financialAnalysisTitle">Financial Analysis</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="financialChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Analysis -->
        <div id="advanced-analysis" class="section">
            <div class="section-card">
                <div class="card-header">
                    <span class="card-icon">📊</span>
                    <h3 data-translate-key="advancedAnalyticsSystemTitle">Advanced Data Analytics System</h3>
                </div>
                <p data-translate-key="advancedAnalyticsSystemDesc">Comprehensive analysis of market trends and operational performance with strategic recommendations</p>
                
                <div class="input-section">
                    <div class="input-options">
                        <button class="option-btn active" onclick="toggleInputMode('advanced', 'text')" data-translate-key="textInputBtn">📝 Text Input</button>
                        <button class="option-btn" onclick="toggleInputMode('advanced', 'file')" data-translate-key="fileUploadBtn">📁 File Upload</button>
                    </div>
                    
                    <div id="advanced-text" class="input-area active">
                        <textarea id="advancedTextInput" class="text-input" data-translate-key="advancedTextInputPlaceholder" placeholder="Enter company data for advanced analysis (financial data, sales, production, etc...)"></textarea>
                        <textarea id="advancedFocusInput" class="focus-input" data-translate-key="advancedFocusInputPlaceholder" placeholder="Specific focus areas or questions (e.g., 'Analyze competitor impact in respiratory products sector', 'Evaluate new regulation effects')"></textarea>
                    </div>
                    
                    <div id="advanced-file" class="input-area">
                        <div class="file-upload-area">
                            <div class="file-upload" onclick="document.getElementById('advancedFileInput').click()">
                                <p data-translate-key="dragFileHere">📁 Drag file here or click to select</p>
                                <p style="font-size: 14px; opacity: 0.7;" data-translate-key="supportedFileTypes">Supports: Excel, CSV, PDF, Word, TXT</p>
                                <input type="file" id="advancedFileInput" accept=".xlsx,.xls,.csv,.pdf,.doc,.docx,.txt" onchange="handleFileUpload('advanced', this)">
                            </div>
                            <div id="advancedFileStatus" class="file-status-display" style="display:none;"></div>
                        </div>
                        <textarea id="advancedFocusInputFile" class="focus-input" data-translate-key="advancedFocusInputFilePlaceholder" placeholder="Specific focus areas for file analysis"></textarea>
                    </div>
                    
                    <button class="btn" onclick="startAdvancedAnalysis()" data-translate-key="startAdvancedAnalysisBtn">🚀 Start Advanced Analysis</button>
                </div>
                
                <div id="advancedStatus" class="status-messages">
                    <div class="status-step" id="advancedStep1" data-translate-key="advancedStep1Text">📄 Processing input/file...</div>
                    <div class="status-step" id="advancedStep2" data-translate-key="advancedStep2Text">🔄 Sending data to Yazeed AI...</div>
                    <div class="status-step" id="advancedStep3" data-translate-key="advancedStep3Text">🧠 AI analysis in progress...</div>
                    <div class="status-step" id="advancedStep4" data-translate-key="advancedStep4Text">📊 Formatting results...</div>
                </div>
                
                <div id="advancedResults" class="results-section" style="display: none;">
                    <div class="results-header">
                        <h4 data-translate-key="advancedAnalysisResultsTitle">📊 Advanced Analysis Results</h4>
                        <div class="export-controls">
                            <button class="btn export-btn" onclick="exportResults('advanced', 'txt')" data-translate-key="exportTxtBtn">📄 Export TXT</button>
                            <button class="btn export-btn" onclick="exportResults('advanced', 'md')" data-translate-key="exportMdBtn">📝 Export MD</button>
                            <button class="btn export-btn" onclick="exportResults('advanced', 'pdf')" data-translate-key="exportPdfBtn">📑 Export PDF</button>
                        </div>
                    </div>
                    <div id="advancedAnalysisContent" class="formatted-content"></div>
                </div>
            </div>
        </div>

        <!-- Quality Management -->
        <div id="quality-management" class="section">
            <div class="section-card">
                <div class="card-header">
                    <span class="card-icon">🏥</span>
                    <h3 data-translate-key="qualityManagementSystemTitle">Smart Quality Management System</h3>
                </div>
                <p data-translate-key="qualityManagementSystemDesc">Quality monitoring according to international standards ISO 13485 and FDA requirements</p>
                
                <div class="input-section">
                     <div class="input-options">
                        <button class="option-btn active" onclick="toggleInputMode('quality', 'text')" data-translate-key="textInputBtn">📝 Text Input</button>
                        <button class="option-btn" onclick="toggleInputMode('quality', 'file')" data-translate-key="fileUploadBtn">📁 File Upload</button>
                    </div>
                    
                    <div id="quality-text" class="input-area active">
                        <textarea id="qualityTextInput" class="text-input" data-translate-key="qualityTextInputPlaceholder" placeholder="Enter quality data (production defects, customer complaints, test results, etc...)"></textarea>
                        <textarea id="qualityFocusInput" class="focus-input" data-translate-key="qualityFocusInputPlaceholder" placeholder="Quality focus areas (e.g., 'ISO compliance assessment', 'Customer satisfaction analysis')"></textarea>
                    </div>
                    
                    <div id="quality-file" class="input-area">
                        <div class="file-upload-area">
                            <div class="file-upload" onclick="document.getElementById('qualityFileInput').click()">
                                <p data-translate-key="dragQualityFile">📁 Drag quality data file here</p>
                                <p style="font-size: 14px; opacity: 0.7;" data-translate-key="qualityFileTypes">Quality reports, inspection records, customer complaints</p>
                                <input type="file" id="qualityFileInput" accept=".xlsx,.xls,.csv,.pdf,.doc,.docx,.txt" onchange="handleFileUpload('quality', this)">
                            </div>
                            <div id="qualityFileStatus" class="file-status-display" style="display:none;"></div>
                        </div>
                        <textarea id="qualityFocusInputFile" class="focus-input" data-translate-key="qualityFocusInputFilePlaceholder" placeholder="Quality analysis focus areas"></textarea>
                    </div>
                    
                    <button class="btn" onclick="startQualityAnalysis()" data-translate-key="analyzeQualityBtn">🔍 Analyze Quality</button>
                </div>
                
                <div id="qualityStatus" class="status-messages">
                    <div class="status-step" id="qualityStep1" data-translate-key="qualityStep1Text">📄 Reading quality data...</div>
                    <div class="status-step" id="qualityStep2" data-translate-key="qualityStep2Text">🔄 Sending to AI analysis...</div>
                    <div class="status-step" id="qualityStep3" data-translate-key="qualityStep3Text">🏥 Quality assessment in progress...</div>
                    <div class="status-step" id="qualityStep4" data-translate-key="qualityStep4Text">📊 Generating quality report...</div>
                </div>
                
                <div id="qualityResults" class="results-section" style="display: none;">
                    <div class="results-header">
                        <h4 data-translate-key="qualityAnalysisResultsTitle">🏥 Quality Analysis Results</h4>
                        <div class="export-controls">
                            <button class="btn export-btn" onclick="exportResults('quality', 'txt')" data-translate-key="exportTxtBtn">📄 Export TXT</button>
                            <button class="btn export-btn" onclick="exportResults('quality', 'md')" data-translate-key="exportMdBtn">📝 Export MD</button>
                            <button class="btn export-btn" onclick="exportResults('quality', 'pdf')" data-translate-key="exportPdfBtn">📑 Export PDF</button>
                        </div>
                    </div>
                    <div id="qualityAnalysisContent" class="formatted-content"></div>
                </div>
            </div>
        </div>

        <!-- Demand Forecasting -->
        <div id="demand-forecasting" class="section">
            <div class="section-card">
                <div class="card-header">
                    <span class="card-icon">📈</span>
                    <h3 data-translate-key="demandForecastingSystemTitle">Demand Forecasting & Inventory System</h3>
                </div>
                <p data-translate-key="demandForecastingSystemDesc">Predict future demand and optimize inventory levels using artificial intelligence</p>
                
                <div class="input-section">
                    <div class="input-options">
                        <button class="option-btn active" onclick="toggleInputMode('demand', 'text')" data-translate-key="textInputBtn">📝 Text Input</button>
                        <button class="option-btn" onclick="toggleInputMode('demand', 'file')" data-translate-key="fileUploadBtn">📁 File Upload</button>
                    </div>
                    
                    <div id="demand-text" class="input-area active">
                        <textarea id="demandTextInput" class="text-input" data-translate-key="demandTextInputPlaceholder" placeholder="Enter historical sales and inventory data (periods, quantities, seasons, etc...)"></textarea>
                        <textarea id="demandFocusInput" class="focus-input" data-translate-key="demandFocusInputPlaceholder" placeholder="Forecasting focus (e.g., 'Q4 seasonal trends', 'New product demand projection')"></textarea>
                    </div>
                    
                    <div id="demand-file" class="input-area">
                        <div class="file-upload-area">
                            <div class="file-upload" onclick="document.getElementById('demandFileInput').click()">
                                <p data-translate-key="dragDemandFile">📁 Drag sales and inventory data file</p>
                                <p style="font-size: 14px; opacity: 0.7;" data-translate-key="demandFileTypes">Historical sales data, inventory levels</p>
                                <input type="file" id="demandFileInput" accept=".xlsx,.xls,.csv,.pdf,.doc,.docx,.txt" onchange="handleFileUpload('demand', this)">
                            </div>
                            <div id="demandFileStatus" class="file-status-display" style="display:none;"></div>
                        </div>
                        <textarea id="demandFocusInputFile" class="focus-input" data-translate-key="demandFocusInputFilePlaceholder" placeholder="Demand forecasting focus areas"></textarea>
                    </div>
                    
                    <button class="btn" onclick="startDemandForecasting()" data-translate-key="forecastDemandBtn">📊 Forecast Demand</button>
                </div>
                
                <div id="demandStatus" class="status-messages">
                    <div class="status-step" id="demandStep1" data-translate-key="demandStep1Text">📄 Processing historical data...</div>
                    <div class="status-step" id="demandStep2" data-translate-key="demandStep2Text">🔄 AI model preparation...</div>
                    <div class="status-step" id="demandStep3" data-translate-key="demandStep3Text">📈 Generating forecasts...</div>
                    <div class="status-step" id="demandStep4" data-translate-key="demandStep4Text">📊 Creating inventory recommendations...</div>
                </div>
                
                <div id="demandResults" class="results-section" style="display: none;">
                    <div class="results-header">
                        <h4 data-translate-key="demandForecastingResultsTitle">📈 Demand Forecasting Results</h4>
                        <div class="export-controls">
                            <button class="btn export-btn" onclick="exportResults('demand', 'txt')" data-translate-key="exportTxtBtn">📄 Export TXT</button>
                            <button class="btn export-btn" onclick="exportResults('demand', 'md')" data-translate-key="exportMdBtn">📝 Export MD</button>
                            <button class="btn export-btn" onclick="exportResults('demand', 'pdf')" data-translate-key="exportPdfBtn">📑 Export PDF</button>
                        </div>
                    </div>
                    <div id="demandAnalysisContent" class="formatted-content"></div>
                </div>
            </div>
        </div>
        
        <!-- Competitor Analysis -->
        <div id="competitor-analysis" class="section">
            <div class="section-card">
                <div class="card-header">
                    <span class="card-icon">🎯</span>
                    <h3 data-translate-key="competitorAnalysisSystemTitle">Competitor Analysis System</h3>
                </div>
                <p data-translate-key="competitorAnalysisSystemDesc">Comprehensive competitive analysis in the medical equipment market and strategic opportunity identification</p>
                
                <div class="input-section">
                    <div class="input-options">
                        <button class="option-btn active" onclick="toggleInputMode('competitor', 'text')" data-translate-key="textInputBtn">📝 Text Input</button>
                        <button class="option-btn" onclick="toggleInputMode('competitor', 'file')" data-translate-key="fileUploadBtn">📁 File Upload</button>
                    </div>
                    
                    <div id="competitor-text" class="input-area active">
                        <textarea id="competitorTextInput" class="text-input" data-translate-key="competitorTextInputPlaceholder" placeholder="Enter competitor data (company names, prices, services, strengths and weaknesses, etc...)"></textarea>
                        <textarea id="competitorFocusInput" class="focus-input" data-translate-key="competitorFocusInputPlaceholder" placeholder="Competitive analysis focus (e.g., 'Pricing strategy comparison', 'Market positioning analysis')"></textarea>
                    </div>
                    
                    <div id="competitor-file" class="input-area">
                        <div class="file-upload-area">
                            <div class="file-upload" onclick="document.getElementById('competitorFileInput').click()">
                                <p data-translate-key="dragCompetitorFile">📁 Drag competitor data file</p>
                                <p style="font-size: 14px; opacity: 0.7;" data-translate-key="competitorFileTypes">Market reports, competitor information, comparison studies</p>
                                <input type="file" id="competitorFileInput" accept=".xlsx,.xls,.csv,.pdf,.doc,.docx,.txt" onchange="handleFileUpload('competitor', this)">
                            </div>
                            <div id="competitorFileStatus" class="file-status-display" style="display:none;"></div>
                        </div>
                        <textarea id="competitorFocusInputFile" class="focus-input" data-translate-key="competitorFocusInputFilePlaceholder" placeholder="Competitor analysis focus areas"></textarea>
                    </div>
                    
                    <button class="btn" onclick="startCompetitorAnalysis()" data-translate-key="analyzeCompetitionBtn">🔎 Analyze Competition</button>
                </div>
                
                <div id="competitorStatus" class="status-messages">
                    <div class="status-step" id="competitorStep1" data-translate-key="competitorStep1Text">📄 Processing competitor data...</div>
                    <div class="status-step" id="competitorStep2" data-translate-key="competitorStep2Text">🔄 Market analysis in progress...</div>
                    <div class="status-step" id="competitorStep3" data-translate-key="competitorStep3Text">🎯 Competitive positioning analysis...</div>
                    <div class="status-step" id="competitorStep4" data-translate-key="competitorStep4Text">📊 Strategic recommendations generation...</div>
                </div>
                
                <div id="competitorResults" class="results-section" style="display: none;">
                    <div class="results-header">
                        <h4 data-translate-key="competitorAnalysisResultsTitle">🎯 Competitor Analysis Results</h4>
                        <div class="export-controls">
                            <button class="btn export-btn" onclick="exportResults('competitor', 'txt')" data-translate-key="exportTxtBtn">📄 Export TXT</button>
                            <button class="btn export-btn" onclick="exportResults('competitor', 'md')" data-translate-key="exportMdBtn">📝 Export MD</button>
                            <button class="btn export-btn" onclick="exportResults('competitor', 'pdf')" data-translate-key="exportPdfBtn">📑 Export PDF</button>
                        </div>
                    </div>
                    <div id="competitorAnalysisContent" class="formatted-content"></div>
                </div>
            </div>
        </div>

        <!-- AI Assistant -->
        <div id="ai-chat" class="section">
            <div class="gemini-integration">
                <h3 data-translate-key="aiAssistantTitle">🤖 Yazeed AI Smart Assistant</h3>
                <div class="gemini-chat" id="chatContainer">
                    <div id="chatMessages">
                        <p><strong data-translate-key="aiAssistantName">Yazeed AI:</strong> <span data-translate-key="aiWelcomeMessage">Welcome! I'm your smart assistant for analyzing Saudi Mais Co.'s situation. I'll provide comprehensive analysis of the financial situation and strategies for crisis recovery.</span></p>
                    </div>
                </div>
                <div class="input-group">
                    <input type="text" id="userInput" data-translate-key="aiChatInputPlaceholder" placeholder="Ask about financial analysis or recovery strategies...">
                    <button class="btn" onclick="sendMessage()" data-translate-key="sendBtn">Send</button>
                    <button class="btn" onclick="startComprehensiveAnalysis()" data-translate-key="comprehensiveAnalysisBtn">Comprehensive Analysis</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        // System variables
        let currentSection = 'overview';
        let uploadedFiles = {}; // Stores File objects
        let fileContents = {}; // Stores extracted text content from files
        let analysisHistory = {};
        let currentLanguage = localStorage.getItem('maisLang') || 'en';
        let marketChartInstance, financialChartInstance;


        const translations = {
            en: {
                pageTitle: "Smart Business Analytics - Saudi Mais Co",
                apiStatusConnected: "🟢 Connected to Yazeed AI API",
                apiStatusDisconnected: "🔴 Not connected to Yazeed AI API",
                mainTitle: "🔍 Smart Business Analytics",
                companyNameHeader: "Saudi Mais Co. Medical Products",
                headerSubtitle: "Advanced AI-powered analysis system for financial crisis resolution",
                navOverview: "🏠 Overview",
                navAdvancedAnalysis: "📊 Advanced Analysis",
                navQualityManagement: "🏥 Quality Management",
                navDemandForecasting: "📈 Demand Forecasting",
                navCompetitorAnalysis: "🎯 Competitor Analysis",
                navAiAssistant: "🤖 AI Assistant",
                companyInfoTitle: "📋 Company Information",
                yearFounded: "Year Founded",
                riyadh: "Riyadh",
                headquarters: "Headquarters",
                medical: "Medical",
                specializedProducts: "Specialized Products",
                middleEast: "Middle East",
                targetMarket: "Target Market",
                overviewCompanyDesc: "Saudi Mais Co. is a leading provider of medical products, committed to enhancing healthcare standards in the region through innovation and quality.",
                marketAnalysisTitle: "Market Analysis",
                financialAnalysisTitle: "Financial Analysis",
                advancedAnalyticsSystemTitle: "Advanced Data Analytics System",
                advancedAnalyticsSystemDesc: "Comprehensive analysis of market trends and operational performance with strategic recommendations for Saudi Mais Co.",
                textInputBtn: "📝 Text Input",
                fileUploadBtn: "📁 File Upload",
                advancedTextInputPlaceholder: "Enter company data for advanced analysis (financial data, sales, production, etc...) specific to Saudi Mais Co.",
                advancedFocusInputPlaceholder: "Specific focus areas for Saudi Mais Co. (e.g., 'Analyze competitor impact in respiratory products sector', 'Evaluate new regulation effects on Saudi Mais Co.')",
                dragFileHere: "📁 Drag file here or click to select",
                supportedFileTypes: "Supports: Excel, CSV, PDF, Word, TXT",
                advancedFocusInputFilePlaceholder: "Specific focus areas for file analysis related to Saudi Mais Co.",
                startAdvancedAnalysisBtn: "🚀 Start Advanced Analysis",
                advancedStep1Text: "📄 Processing input/file for Saudi Mais Co. analysis...",
                advancedStep2Text: "🔄 Sending data to Yazeed AI for Saudi Mais Co. context...",
                advancedStep3Text: "🧠 AI analysis for Saudi Mais Co. in progress...",
                advancedStep4Text: "📊 Formatting results for Saudi Mais Co...",
                advancedAnalysisResultsTitle: "📊 Advanced Analysis Results for Saudi Mais Co.",
                exportTxtBtn: "📄 Export TXT",
                exportMdBtn: "📝 Export MD",
                exportPdfBtn: "📑 Export PDF",
                qualityManagementSystemTitle: "Smart Quality Management System for Saudi Mais Co.",
                qualityManagementSystemDesc: "Quality monitoring according to international standards (ISO 13485) and FDA requirements for Saudi Mais Co.",
                qualityTextInputPlaceholder: "Enter quality data for Saudi Mais Co. (production defects, customer complaints, test results, etc...)",
                qualityFocusInputPlaceholder: "Quality focus areas for Saudi Mais Co. (e.g., 'ISO compliance assessment', 'Customer satisfaction analysis')",
                dragQualityFile: "📁 Drag quality data file here for Saudi Mais Co.",
                qualityFileTypes: "Quality reports, inspection records, customer complaints (Saudi Mais Co.)",
                qualityFocusInputFilePlaceholder: "Quality analysis focus areas from file for Saudi Mais Co.",
                analyzeQualityBtn: "🔍 Analyze Quality for Saudi Mais Co.",
                qualityStep1Text: "📄 Reading quality data for Saudi Mais Co....",
                qualityStep2Text: "🔄 Sending to AI for Saudi Mais Co. quality analysis...",
                qualityStep3Text: "🏥 Quality assessment for Saudi Mais Co. in progress...",
                qualityStep4Text: "📊 Generating quality report for Saudi Mais Co....",
                qualityAnalysisResultsTitle: "🏥 Quality Analysis Results for Saudi Mais Co.",
                demandForecastingSystemTitle: "Demand Forecasting & Inventory System for Saudi Mais Co.",
                demandForecastingSystemDesc: "Predict future demand and optimize inventory levels for Saudi Mais Co. using artificial intelligence",
                demandTextInputPlaceholder: "Enter historical sales and inventory data for Saudi Mais Co. (periods, quantities, seasons, etc...)",
                demandFocusInputPlaceholder: "Forecasting focus for Saudi Mais Co. (e.g., 'Q4 seasonal trends', 'New product demand projection')",
                dragDemandFile: "📁 Drag sales and inventory data file for Saudi Mais Co.",
                demandFileTypes: "Historical sales data, inventory levels (Saudi Mais Co.)",
                demandFocusInputFilePlaceholder: "Demand forecasting focus areas from file for Saudi Mais Co.",
                forecastDemandBtn: "📊 Forecast Demand for Saudi Mais Co.",
                demandStep1Text: "📄 Processing historical data for Saudi Mais Co....",
                demandStep2Text: "🔄 AI model preparation for Saudi Mais Co. demand...",
                demandStep3Text: "📈 Generating forecasts for Saudi Mais Co....",
                demandStep4Text: "📊 Creating inventory recommendations for Saudi Mais Co....",
                demandForecastingResultsTitle: "📈 Demand Forecasting Results for Saudi Mais Co.",
                competitorAnalysisSystemTitle: "Competitor Analysis System for Saudi Mais Co.",
                competitorAnalysisSystemDesc: "Comprehensive competitive analysis in the medical equipment market for Saudi Mais Co. and strategic opportunity identification",
                competitorTextInputPlaceholder: "Enter competitor data relevant to Saudi Mais Co. (company names, prices, services, strengths and weaknesses, etc...)",
                competitorFocusInputPlaceholder: "Competitive analysis focus for Saudi Mais Co. (e.g., 'Pricing strategy comparison', 'Market positioning analysis')",
                dragCompetitorFile: "📁 Drag competitor data file for Saudi Mais Co. analysis",
                competitorFileTypes: "Market reports, competitor information, comparison studies (Saudi Mais Co.)",
                competitorFocusInputFilePlaceholder: "Competitor analysis focus areas from file for Saudi Mais Co.",
                analyzeCompetitionBtn: "🔎 Analyze Competition for Saudi Mais Co.",
                competitorStep1Text: "📄 Processing competitor data for Saudi Mais Co. context...",
                competitorStep2Text: "🔄 Market analysis in progress for Saudi Mais Co....",
                competitorStep3Text: "🎯 Competitive positioning analysis for Saudi Mais Co....",
                competitorStep4Text: "📊 Strategic recommendations generation for Saudi Mais Co....",
                competitorAnalysisResultsTitle: "🎯 Competitor Analysis Results for Saudi Mais Co.",
                aiAssistantTitle: "🤖 Yazeed AI Smart Assistant for Saudi Mais Co.",
                aiAssistantName: "Yazeed AI (Saudi Mais Co. Specialist):",
                aiWelcomeMessage: "Welcome! I'm your smart assistant for analyzing Saudi Mais Co.'s situation. I specialize in providing comprehensive analysis of its financial situation and strategies for crisis recovery, leveraging its unique profile.",
                aiChatInputPlaceholder: "Ask about Saudi Mais Co. financial analysis or recovery strategies...",
                sendBtn: "Send",
                comprehensiveAnalysisBtn: "Comprehensive Analysis for Saudi Mais Co.",
                fileProcessingMessage: "Reading file:", 
                fileReadSuccessMessage: "✅ File ready:", 
                fileSizeLabel: "Size:",
                fileContentPreviewLabel: "Content preview (first 200 chars):",
                removeFileBtn: "🗑️ Remove File",
                fileReadError: "❌ Error reading file:",
                alertNoData: "Please enter data or upload a file for analysis related to Saudi Mais Co.",
                alertPdfExport: "PDF export feature requires an additional library. Exporting as text instead.",
                analysisFailedMsg: '<div class="critical-box"><h4>Analysis Failed</h4><p>Apologies, the analysis for Saudi Mais Co. could not be completed. Please check your input or try again later. If the problem persists, contact support.</p></div>',
                marketChartLabelCurrent: 'Current Status',
                marketChartLabelTarget: 'Future Target',
                marketChartLabels: ['Market Size', 'Growth', 'Competition', 'Quality', 'Price', 'Distribution'],
                financialChartLabelRevenue: 'Revenue (Million SAR)',
                financialChartLabelProfit: 'Profit (Million SAR)',
                financialChartLabels: ['2020', '2021', '2022', '2023', '2024', '2025 (Planned)'],
                loadingAnalysisText: "Analysis for Saudi Mais Co. in progress...",
                loadingQueryText: "Analyzing your query regarding Saudi Mais Co....",
                loadingComprehensiveAnalysisText: "Generating comprehensive business analysis for Saudi Mais Co....",
                comprehensiveAnalysisResultTitle: "Comprehensive Analysis for Saudi Mais Co.:",
                defaultFileName: "Uploaded File",
                simulatedDocxMessage: "Simulated DOCX content. Full parsing requires a dedicated library.",
                simulatedPdfMessage: "Simulated PDF reference. Full parsing requires a dedicated library."
            },
            ar: {
                pageTitle: "تحليلات الأعمال الذكية - شركة ميس السعودية",
                apiStatusConnected: "🟢 متصل بـ Yazeed AI API",
                apiStatusDisconnected: "🔴 غير متصل بـ Yazeed AI API",
                mainTitle: "🔍 تحليلات الأعمال الذكية",
                companyNameHeader: "شركة ميس السعودية للمنتجات الطبية",
                headerSubtitle: "نظام تحليل متقدم مدعوم بالذكاء الاصطناعي لحل الأزمات المالية لشركة ميس السعودية",
                navOverview: "🏠 نظرة عامة",
                navAdvancedAnalysis: "📊 تحليل متقدم",
                navQualityManagement: "🏥 إدارة الجودة",
                navDemandForecasting: "📈 توقعات الطلب",
                navCompetitorAnalysis: "🎯 تحليل المنافسين",
                navAiAssistant: "🤖 مساعد الذكاء الاصطناعي",
                companyInfoTitle: "📋 معلومات الشركة",
                yearFounded: "سنة التأسيس",
                riyadh: "الرياض",
                headquarters: "المقر الرئيسي",
                medical: "طبية",
                specializedProducts: "منتجات متخصصة",
                middleEast: "الشرق الأوسط",
                targetMarket: "السوق المستهدف",
                overviewCompanyDesc: "شركة ميس السعودية هي إحدى الشركات الرائدة في مجال المنتجات الطبية، وتلتزم بتعزيز معايير الرعاية الصحية في المنطقة من خلال الابتكار والجودة.",
                marketAnalysisTitle: "تحليل السوق",
                financialAnalysisTitle: "التحليل المالي",
                advancedAnalyticsSystemTitle: "نظام تحليل البيانات المتقدم لشركة ميس السعودية",
                advancedAnalyticsSystemDesc: "تحليل شامل لاتجاهات السوق والأداء التشغيلي مع توصيات استراتيجية لشركة ميس السعودية",
                textInputBtn: "📝 إدخال نصي",
                fileUploadBtn: "📁 رفع ملف",
                advancedTextInputPlaceholder: "أدخل بيانات شركة ميس السعودية للتحليل المتقدم (بيانات مالية، مبيعات، إنتاج، إلخ...)",
                advancedFocusInputPlaceholder: "مجالات تركيز لشركة ميس السعودية (مثال: 'تحليل تأثير المنافسين في قطاع منتجات الجهاز التنفسي'، 'تقييم آثار التنظيمات الجديدة على شركة ميس السعودية')",
                dragFileHere: "📁 اسحب الملف هنا أو انقر للاختيار",
                supportedFileTypes: "يدعم: Excel, CSV, PDF, Word, TXT",
                advancedFocusInputFilePlaceholder: "مجالات تركيز محددة لتحليل الملف الخاص بشركة ميس السعودية",
                startAdvancedAnalysisBtn: "🚀 بدء التحليل المتقدم لشركة ميس السعودية",
                advancedStep1Text: "📄 معالجة الإدخال/الملف لتحليل شركة ميس السعودية...",
                advancedStep2Text: "🔄 إرسال البيانات إلى Yazeed AI لسياق شركة ميس السعودية...",
                advancedStep3Text: "🧠 تحليل الذكاء الاصطناعي لشركة ميس السعودية قيد التقدم...",
                advancedStep4Text: "📊 تنسيق النتائج الخاصة بشركة ميس السعودية...",
                advancedAnalysisResultsTitle: "📊 نتائج التحليل المتقدم لشركة ميس السعودية",
                exportTxtBtn: "📄 تصدير TXT",
                exportMdBtn: "📝 تصدير MD",
                exportPdfBtn: "📑 تصدير PDF",
                qualityManagementSystemTitle: "نظام إدارة الجودة الذكي لشركة ميس السعودية",
                qualityManagementSystemDesc: "مراقبة الجودة وفقًا للمعايير الدولية (ISO 13485) ومتطلبات FDA لشركة ميس السعودية",
                qualityTextInputPlaceholder: "أدخل بيانات الجودة لشركة ميس السعودية (عيوب الإنتاج، شكاوى العملاء، نتائج الاختبارات، إلخ...)",
                qualityFocusInputPlaceholder: "مجالات تركيز الجودة لشركة ميس السعودية (مثال: 'تقييم الامتثال لـ ISO'، 'تحليل رضا العملاء')",
                dragQualityFile: "📁 اسحب ملف بيانات الجودة هنا لشركة ميس السعودية",
                qualityFileTypes: "تقارير الجودة، سجلات الفحص، شكاوى العملاء (شركة ميس السعودية)",
                qualityFocusInputFilePlaceholder: "مجالات تركيز تحليل الجودة من الملف لشركة ميس السعودية",
                analyzeQualityBtn: "🔍 تحليل الجودة لشركة ميس السعودية",
                qualityStep1Text: "📄 قراءة بيانات الجودة لشركة ميس السعودية...",
                qualityStep2Text: "🔄 الإرسال إلى تحليل الذكاء الاصطناعي لجودة شركة ميس السعودية...",
                qualityStep3Text: "🏥 تقييم الجودة لشركة ميس السعودية قيد التقدم...",
                qualityStep4Text: "📊 إنشاء تقرير الجودة لشركة ميس السعودية...",
                qualityAnalysisResultsTitle: "🏥 نتائج تحليل الجودة لشركة ميس السعودية",
                demandForecastingSystemTitle: "نظام توقعات الطلب والمخزون لشركة ميس السعودية",
                demandForecastingSystemDesc: "توقع الطلب المستقبلي وتحسين مستويات المخزون لشركة ميس السعودية باستخدام الذكاء الاصطناعي",
                demandTextInputPlaceholder: "أدخل بيانات المبيعات والمخزون التاريخية لشركة ميس السعودية (فترات، كميات، مواسم، إلخ...)",
                demandFocusInputPlaceholder: "تركيز التوقعات لشركة ميس السعودية (مثال: 'اتجاهات موسمية للربع الرابع'، 'توقع الطلب على منتج جديد')",
                dragDemandFile: "📁 اسحب ملف بيانات المبيعات والمخزون لشركة ميس السعودية",
                demandFileTypes: "بيانات المبيعات التاريخية، مستويات المخزون (شركة ميس السعودية)",
                demandFocusInputFilePlaceholder: "مجالات تركيز توقعات الطلب من الملف لشركة ميس السعودية",
                forecastDemandBtn: "📊 توقع الطلب لشركة ميس السعودية",
                demandStep1Text: "📄 معالجة البيانات التاريخية لشركة ميس السعودية...",
                demandStep2Text: "🔄 إعداد نموذج الذكاء الاصطناعي لطلب شركة ميس السعودية...",
                demandStep3Text: "📈 إنشاء التوقعات لشركة ميس السعودية...",
                demandStep4Text: "📊 إنشاء توصيات المخزون لشركة ميس السعودية...",
                demandForecastingResultsTitle: "📈 نتائج توقعات الطلب لشركة ميس السعودية",
                competitorAnalysisSystemTitle: "نظام تحليل المنافسين لشركة ميس السعودية",
                competitorAnalysisSystemDesc: "تحليل تنافسي شامل في سوق المعدات الطبية لشركة ميس السعودية وتحديد الفرص الاستراتيجية",
                competitorTextInputPlaceholder: "أدخل بيانات المنافسين ذات الصلة بشركة ميس السعودية (أسماء الشركات، الأسعار، الخدمات، نقاط القوة والضعف، إلخ...)",
                competitorFocusInputPlaceholder: "تركيز التحليل التنافسي لشركة ميس السعودية (مثال: 'مقارنة استراتيجية التسعير'، 'تحليل تحديد الموقع في السوق')",
                dragCompetitorFile: "📁 اسحب ملف بيانات المنافسين لتحليل شركة ميس السعودية",
                competitorFileTypes: "تقارير السوق، معلومات المنافسين، دراسات مقارنة (شركة ميس السعودية)",
                competitorFocusInputFilePlaceholder: "مجالات تركيز تحليل المنافسين من الملف لشركة ميس السعودية",
                analyzeCompetitionBtn: "🔎 تحليل المنافسة لشركة ميس السعودية",
                competitorStep1Text: "📄 معالجة بيانات المنافسين لسياق شركة ميس السعودية...",
                competitorStep2Text: "🔄 تحليل السوق قيد التقدم لشركة ميس السعودية...",
                competitorStep3Text: "🎯 تحليل تحديد الموقع التنافسي لشركة ميس السعودية...",
                competitorStep4Text: "📊 إنشاء التوصيات الاستراتيجية لشركة ميس السعودية...",
                competitorAnalysisResultsTitle: "🎯 نتائج تحليل المنافسين لشركة ميس السعودية",
                aiAssistantTitle: "🤖 مساعد يزيد الذكي لشركة ميس السعودية",
                aiAssistantName: "يزيد AI (متخصص شركة ميس السعودية):",
                aiWelcomeMessage: "مرحباً! أنا مساعدك الذكي لتحليل وضع شركة ميس السعودية. أنا متخصص في تقديم تحليل شامل لوضعها المالي واستراتيجيات التعافي من الأزمات، مع الاستفادة من ملفها التعريفي الفريد.",
                aiChatInputPlaceholder: "اسأل عن التحليل المالي أو استراتيجيات التعافي لشركة ميس السعودية...",
                sendBtn: "إرسال",
                comprehensiveAnalysisBtn: "تحليل شامل لشركة ميس السعودية",
                fileProcessingMessage: "قراءة الملف:",
                fileReadSuccessMessage: "✅ الملف جاهز:",
                fileSizeLabel: "الحجم:",
                fileContentPreviewLabel: "معاينة المحتوى (أول 200 حرف):",
                removeFileBtn: "🗑️ إزالة الملف",
                fileReadError: "❌ خطأ في قراءة الملف:",
                alertNoData: "الرجاء إدخال بيانات أو رفع ملف للتحليل الخاص بشركة ميس السعودية.",
                alertPdfExport: "ميزة تصدير PDF تتطلب مكتبة إضافية. سيتم التصدير كنص بدلاً من ذلك.",
                analysisFailedMsg: '<div class="critical-box"><h4>فشل التحليل</h4><p>عذراً، لم يتم إكمال التحليل الخاص بشركة ميس السعودية. يرجى التحقق من مدخلاتك أو المحاولة مرة أخرى لاحقاً. إذا استمرت المشكلة، يرجى الاتصال بالدعم.</p></div>',
                marketChartLabelCurrent: 'الوضع الحالي',
                marketChartLabelTarget: 'الهدف المستقبلي',
                marketChartLabels: ['حجم السوق', 'النمو', 'المنافسة', 'الجودة', 'السعر', 'التوزيع'],
                financialChartLabelRevenue: 'الإيرادات (مليون ريال)',
                financialChartLabelProfit: 'الأرباح (مليون ريال)',
                financialChartLabels: ['2020', '2021', '2022', '2023', '2024', '2025 (مخطط)'],
                loadingAnalysisText: "التحليل الخاص بشركة ميس السعودية قيد التقدم...",
                loadingQueryText: "تحليل استفسارك بخصوص شركة ميس السعودية...",
                loadingComprehensiveAnalysisText: "إنشاء تحليل شامل للأعمال لشركة ميس السعودية...",
                comprehensiveAnalysisResultTitle: "التحليل الشامل لشركة ميس السعودية:",
                defaultFileName: "ملف مرفوع",
                simulatedDocxMessage: "محتوى DOCX محاكى. التحليل الكامل يتطلب مكتبة متخصصة.",
                simulatedPdfMessage: "إشارة لملف PDF محاكاة. التحليل الكامل يتطلب مكتبة متخصصة."
            }
        };

        function setLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('maisLang', lang);
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

            document.querySelectorAll('[data-translate-key]').forEach(el => {
                const key = el.getAttribute('data-translate-key');
                if (translations[lang] && translations[lang][key]) {
                    if (el.tagName === 'TEXTAREA' || (el.tagName === 'INPUT' && (el.type === 'text' || el.type === 'search' /* for AI input */))) {
                        el.placeholder = translations[lang][key];
                    } else {
                        el.innerHTML = translations[lang][key];
                    }
                }
            });
            
            document.getElementById('lang-en').classList.toggle('active', lang === 'en');
            document.getElementById('lang-ar').classList.toggle('active', lang === 'ar');
            
            initializeCharts();
            checkAPIConnection(); 
            Object.keys(uploadedFiles).forEach(section => {
                if (uploadedFiles[section]) {
                    updateFileStatusDisplay(section, uploadedFiles[section].name, fileContents[section] || "");
                }
            });
        }

        const GEMINI_API_KEY = 'AIzaSyAquNVYw6VOmAKTtKtTPU7Tl3PVIG0sKhg'; 
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent';

        function checkAPIConnection() {
            const statusElement = document.getElementById('apiStatus');
            const isConnected = GEMINI_API_KEY !== 'YOUR_GEMINI_API_KEY_HERE' && GEMINI_API_KEY.startsWith('AIza');
            const statusTextKey = isConnected ? 'apiStatusConnected' : 'apiStatusDisconnected';
            
            statusElement.className = `api-status ${isConnected ? 'api-connected' : 'api-disconnected'}`;
            const span = statusElement.querySelector('span') || document.createElement('span');
            span.setAttribute('data-translate-key', statusTextKey);
            span.innerHTML = translations[currentLanguage][statusTextKey];
            if (!statusElement.querySelector('span')) {
                statusElement.appendChild(span);
            }
        }

        function initializeCharts() {
            const currentLangTranslations = translations[currentLanguage];
            if (marketChartInstance) marketChartInstance.destroy();
            if (financialChartInstance) financialChartInstance.destroy();
            
            const chartLabelColor = 'rgba(255, 255, 255, 0.8)';
            const gridColor = 'rgba(255, 255, 255, 0.15)';
            const tickColor = 'rgba(255, 255, 255, 0.7)';

            const marketCtx = document.getElementById('marketChart');
            if (marketCtx) {
                marketChartInstance = new Chart(marketCtx.getContext('2d'), {
                    type: 'radar',
                    data: {
                        labels: currentLangTranslations.marketChartLabels,
                        datasets: [{
                            label: currentLangTranslations.marketChartLabelCurrent,
                            data: [40, 30, 25, 70, 60, 45],
                            backgroundColor: 'rgba(255, 99, 132, 0.3)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(255, 99, 132, 1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(255, 99, 132, 1)'
                        }, {
                            label: currentLangTranslations.marketChartLabelTarget,
                            data: [80, 75, 70, 90, 85, 80],
                            backgroundColor: 'rgba(54, 162, 235, 0.3)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(54, 162, 235, 1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(54, 162, 235, 1)'
                        }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: chartLabelColor, font: { size: 13 } } } },
                        scales: {
                            r: {
                                angleLines: { color: gridColor },
                                grid: { color: gridColor },
                                pointLabels: { color: chartLabelColor, font: { size: currentLanguage === 'ar' ? 11 : 12} },
                                ticks: { backdropColor: 'transparent', color: tickColor, stepSize: 20 }
                            }
                        },
                        elements: { line: { tension: 0.1 } }
                    }
                });
            }

            const financialCtx = document.getElementById('financialChart');
            if (financialCtx) {
                financialChartInstance = new Chart(financialCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: currentLangTranslations.financialChartLabels,
                        datasets: [{
                            label: currentLangTranslations.financialChartLabelRevenue,
                            data: [50, 45, 40, 35, 30, 60],
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.3)',
                            tension: 0.4, fill: true,
                            pointRadius: 4, pointHoverRadius: 6
                        }, {
                            label: currentLangTranslations.financialChartLabelProfit,
                            data: [10, 5, 0, -5, -10, 15],
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.3)',
                            tension: 0.4, fill: true,
                            pointRadius: 4, pointHoverRadius: 6
                        }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: chartLabelColor, font: {size: 13} } } },
                        scales: {
                            y: { grid: { color: gridColor }, ticks: { color: tickColor } },
                            x: { grid: { color: gridColor }, ticks: { color: tickColor } }
                        },
                        interaction: { intersect: false, mode: 'index' }
                    }
                });
            }
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            const activeSection = document.getElementById(sectionId);
            if (activeSection) activeSection.classList.add('active');
            
            const activeButton = document.querySelector(`.nav-btn[onclick*="showSection('${sectionId}')"]`);
            if (activeButton) activeButton.classList.add('active');
            
            currentSection = sectionId;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function toggleInputMode(section, mode) {
            const textInputArea = document.getElementById(`${section}-text`);
            const fileInputArea = document.getElementById(`${section}-file`);
            const buttons = document.querySelectorAll(`#${section}.section .input-options .option-btn`);
            
            buttons.forEach(btn => btn.classList.remove('active'));
            
            if (mode === 'text') {
                if(textInputArea) textInputArea.classList.add('active');
                if(fileInputArea) fileInputArea.classList.remove('active');
                if(buttons[0]) buttons[0].classList.add('active');
            } else {
                if(textInputArea) textInputArea.classList.remove('active');
                if(fileInputArea) fileInputArea.classList.add('active');
                if(buttons[1]) buttons[1].classList.add('active');
            }
        }

        function updateFileStatusDisplay(section, fileName, fileContentPreview) {
            const fileStatusDiv = document.getElementById(`${section}FileStatus`);
            if (!fileStatusDiv) return;

            fileStatusDiv.style.display = 'block';
            fileStatusDiv.innerHTML = `
                <p><span class="file-name">${translations[currentLanguage].fileReadSuccessMessage} ${fileName || translations[currentLanguage].defaultFileName}</span></p>
                <p style="font-size: 0.9em;">${translations[currentLanguage].fileSizeLabel} ${(uploadedFiles[section]?.size / 1024).toFixed(2)} KB</p>
                <div class="file-preview" lang="${currentLanguage}" dir="${currentLanguage === 'ar' ? 'rtl' : 'ltr'}">
                    <strong>${translations[currentLanguage].fileContentPreviewLabel}</strong><br>
                    ${fileContentPreview.substring(0, 200).replace(/</g, "&lt;").replace(/>/g, "&gt;")}${fileContentPreview.length > 200 ? '...' : ''}
                </div>
                <button class="btn" onclick="clearFile('${section}')" style="margin-top: 10px; padding: 8px 12px; font-size: 12px;">${translations[currentLanguage].removeFileBtn}</button>
            `;
        }

        async function handleFileUpload(section, inputElement) {
            const file = inputElement.files[0];
            if (!file) return;

            uploadedFiles[section] = file;
            const fileStatusDiv = document.getElementById(`${section}FileStatus`);
            if (fileStatusDiv) {
                 fileStatusDiv.style.display = 'block';
                 fileStatusDiv.innerHTML = `<div class="loading-enhanced" style="margin: 0 auto; width: fit-content;"><div class="loading-dots"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div> ${translations[currentLanguage].fileProcessingMessage} ${file.name}</div>`;
            }

            try {
                let content = '';
                if (file.type === 'text/plain' || file.name.endsWith('.txt') || file.type === 'text/csv' || file.name.endsWith('.csv')) {
                    content = await readTextFile(file);
                } else if (file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' || file.name.endsWith('.docx')) {
                    content = `${translations[currentLanguage].simulatedDocxMessage} (File: ${file.name})`; 
                } else if (file.type === 'application/pdf' || file.name.endsWith('.pdf')) {
                    content = `${translations[currentLanguage].simulatedPdfMessage} (File: ${file.name})`;
                } else {
                    content = `Binary file or unsupported type: ${file.name}`;
                }
                fileContents[section] = content;
                updateFileStatusDisplay(section, file.name, content);

            } catch (error) {
                if (fileStatusDiv) {
                    fileStatusDiv.innerHTML = `
                        <div style="background: rgba(244, 67, 54, 0.2); border: 1px solid rgba(244, 67, 54, 0.5); padding: 15px; border-radius: 10px;">
                            <p>${translations[currentLanguage].fileReadError} ${error.message}</p>
                            <button class="btn" onclick="clearFile('${section}')" style="margin-top: 10px;">${translations[currentLanguage].removeFileBtn}</button>
                        </div>`;
                }
                console.error("Error reading file:", error);
            }
        }

        function readTextFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = e => reject(new Error('Failed to read file content.'));
                reader.readAsText(file);
            });
        }

        function clearFile(section) {
            delete uploadedFiles[section];
            delete fileContents[section];
            const fileInput = document.getElementById(`${section}FileInput`);
            if (fileInput) fileInput.value = ''; 
            
            const fileStatusDiv = document.getElementById(`${section}FileStatus`);
            if (fileStatusDiv) {
                fileStatusDiv.style.display = 'none';
                fileStatusDiv.innerHTML = '';
            }
        }

        function showAnalysisStatus(section, stepsKeys) {
            const statusElement = document.getElementById(`${section}Status`);
            if (!statusElement) return;
            statusElement.style.display = 'block';
            
            stepsKeys.forEach((key, index) => {
                const stepEl = document.getElementById(`${section}Step${index + 1}`);
                if (stepEl) {
                    stepEl.classList.remove('active');
                    stepEl.innerHTML = `⏳ ${translations[currentLanguage][key] || `Step ${index + 1}...`}`;
                }
            });
            
            let delay = 0;
            stepsKeys.forEach((key, index) => {
                setTimeout(() => {
                    const stepEl = document.getElementById(`${section}Step${index + 1}`);
                    if (stepEl) {
                         stepEl.classList.add('active');
                         if (index < stepsKeys.length -1 ) {
                            stepEl.innerHTML = `✅ ${translations[currentLanguage][key] || `Step ${index + 1} Done`}`;
                         } else {
                            stepEl.innerHTML = `🏁 ${translations[currentLanguage][key] || `Step ${index + 1} Done`}`;
                         }
                    }
                }, delay);
                delay += 700; 
            });
            
            setTimeout(() => {
                 if (statusElement) statusElement.style.display = 'none';
            }, delay + 1500);
        }

        async function callGeminiAPI(prompt, dataToConsider = "") {
            const langInstruction = currentLanguage === 'ar' ? "الرجاء الرد باللغة العربية الفصحى بشكل كامل ومفصل ومنسق." : "Please respond in English fully, in detail, and well-formatted.";
            
            let contextDataInfo = "";
            if (dataToConsider) {
                contextDataInfo = currentLanguage === 'ar' ? 
                    `\n\nخذ في الاعتبار البيانات التالية (معاينة من الملف المرفق: "${dataToConsider.substring(0, 100).replace(/\n/g, " ")}...") في تحليلك، مع التركيز على هذه البيانات بشكل أساسي.` :
                    `\n\nConsider the following data (preview from attached file: "${dataToConsider.substring(0, 100).replace(/\n/g, " ")}...") in your analysis, focusing primarily on this data.`;
            }

            const fullPrompt = `${langInstruction}${contextDataInfo}\n\n${prompt}`;

            if (GEMINI_API_KEY === 'YOUR_GEMINI_API_KEY_HERE' || !GEMINI_API_KEY.startsWith('AIza')) {
                console.warn("Using simulated API response.");
                return await simulateGeminiResponse(prompt, dataToConsider);
            }

            try {
                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: fullPrompt }] }]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('Gemini API Error:', errorData);
                    throw new Error(`API Error: ${errorData.error?.message || response.statusText}`);
                }
                
                const data = await response.json();
                if (data.candidates && data.candidates[0]?.content?.parts?.[0]?.text) {
                    return data.candidates[0].content.parts[0].text;
                } else {
                     console.error('Unexpected API response structure:', data);
                     throw new Error('Invalid API response structure.');
                }
            } catch (error) {
                console.error('Error calling Gemini API:', error);
                return await simulateGeminiResponse(prompt, dataToConsider); 
            }
        }
        
        function formatContent(content) {
            let formatted = content;
            formatted = formatted.replace(/^#\s(.*?)$/gm, (match, p1) => p1.includes('<') ? match : `<h1>${p1}</h1>`);
            formatted = formatted.replace(/^##\s(.*?)$/gm, (match, p1) => p1.includes('<') ? match : `<h2>${p1}</h2>`);
            formatted = formatted.replace(/^###\s(.*?)$/gm, (match, p1) => p1.includes('<') ? match : `<h3>${p1}</h3>`);
            formatted = formatted.replace(/^####\s(.*?)$/gm, (match, p1) => p1.includes('<') ? match : `<h4>${p1}</h4>`);

            formatted = formatted.replace(/^\s*-\s(.*?)$/gm, (match, p1) => p1.includes('<') ? match : `<li>${p1}</li>`);
            formatted = formatted.replace(/^\s*\*\s(.*?)$/gm, (match, p1) => p1.includes('<') ? match : `<li>${p1}</li>`);
            formatted = formatted.replace(/(<li>.*?<\/li>(?:\s*<li>.*?<\/li>)*)/gs, (match) => {
                if (match.startsWith('<ul>') || match.startsWith('<ol>')) return match;
                return `<ul>${match}</ul>`;
            });

            formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            const lines = formatted.split('\n');
            const newLines = lines.map(line => {
                const trimmedLine = line.trim();
                if (trimmedLine.length === 0) return ''; 
                if (trimmedLine.startsWith('<') && trimmedLine.endsWith('>')) { 
                    if (trimmedLine.match(/^<(ul|ol|li|h[1-6]|p|div|table|blockquote|pre|hr|br)/i) ||
                        trimmedLine.match(/<\/(ul|ol|li|h[1-6]|p|div|table|blockquote|pre)>$/i)) {
                        return line;
                    }
                }
                if (!trimmedLine.startsWith('<p>') && !trimmedLine.endsWith('</p>')) {
                     return `<p>${line}</p>`;
                }
                return line;
            });
            formatted = newLines.join('\n');

            return formatted;
        }

        async function simulateGeminiResponse(prompt, dataContent = "") {
            await new Promise(resolve => setTimeout(resolve, 1200)); 
            
            let dataMention = "";
            if (dataContent) {
                const preview = dataContent.substring(0, 70).replace(/\n/g, " ").replace(/</g, "&lt;");
                dataMention = currentLanguage === 'ar' ? 
                    `<div class="analysis-result-card"><p><em>(ملاحظة: يستند هذا التحليل المحاكى إلى البيانات المقدمة من الملف الذي يبدأ بـ: "${preview}..." مع التركيز عليها بشكل أساسي.)</em></p></div>` :
                    `<div class="analysis-result-card"><p><em>(Note: This simulated analysis is primarily based on the provided file data starting with: "${preview}...")</em></p></div>`;
            }

            // Extracting simplified prompt identifiers for routing
            const lowerPrompt = prompt.toLowerCase();
            if (lowerPrompt.includes('advanced business analysis') || lowerPrompt.includes('تحليل أعمال متقدم')) {
                return dataMention + (currentLanguage === 'ar' ? generateAdvancedAnalysisResponseAr(dataContent) : generateAdvancedAnalysisResponseEn(dataContent));
            } else if (lowerPrompt.includes('quality management system') || lowerPrompt.includes('نظام إدارة الجودة')) {
                return dataMention + (currentLanguage === 'ar' ? generateQualityAnalysisResponseAr(dataContent) : generateQualityAnalysisResponseEn(dataContent));
            } else if (lowerPrompt.includes('demand forecasting') || lowerPrompt.includes('توقعات الطلب')) {
                return dataMention + (currentLanguage === 'ar' ? generateDemandForecastResponseAr(dataContent) : generateDemandForecastResponseEn(dataContent));
            } else if (lowerPrompt.includes('competitor analysis') || lowerPrompt.includes('تحليل تنافسي')) {
                return dataMention + (currentLanguage === 'ar' ? generateCompetitorAnalysisResponseAr(dataContent) : generateCompetitorAnalysisResponseEn(dataContent));
            } else if (lowerPrompt.includes('comprehensive strategic business analysis') || lowerPrompt.includes('تحليل أعمال استراتيجي شامل')) { // For AI Assistant
                return dataMention + (currentLanguage === 'ar' ? generateComprehensiveAnalysisResponseAr() : generateComprehensiveAnalysisResponseEn());
            }
             else { 
                return dataMention + (currentLanguage === 'ar' ? generateDefaultResponseAr(prompt) : generateDefaultResponseEn(prompt));
            }
        }

        // --- English Simulated Responses ---
        function generateAdvancedAnalysisResponseEn(data) {
            return `
                <h1>Advanced Business Analysis for Saudi Mais Co.</h1>
                ${data ? `<div class="analysis-result-card"><p><strong>Data Insight:</strong> Analysis incorporates provided data points from the uploaded file for Saudi Mais Co.</p></div>` : '<div class="analysis-result-card"><p><strong>Data Insight:</strong> Analysis based on general knowledge of Saudi Mais Co.</p></div>'}
                <div class="analysis-result-card">
                    <h2>1. Market Snapshot for Medical Consumables</h2>
                    <p>The Saudi medical device market, particularly for single-use consumables, is poised for significant expansion, heavily influenced by Vision 2030's healthcare infrastructure development. Key opportunities for Saudi Mais Co. lie in specialized sterile products and locally manufactured items aligning with IKTVA (In-Kingdom Total Value Add) program goals.</p>
                    <div class="metric-card">
                        <div class="metric-label">Projected Market Growth (CAGR - Medical Consumables KSA)</div>
                        <div class="metric-value">9.2% <span class="quality-indicator quality-excellent">Excellent</span></div>
                    </div>
                </div>
                <div class="analysis-result-card">
                    <h2>2. Financial Health Assessment of Saudi Mais Co.</h2>
                    <p>Current financials, potentially detailed in uploaded documents, likely indicate a need for strategic cost optimization, improved working capital management, and diversification of revenue streams beyond traditional products. Attention to liquidity ratios and gross profit margins on core product lines is critical.</p>
                    <div class="warning-box">
                        <h4>Liquidity & Profitability Focus</h4>
                        <p>If data indicates, the Quick Ratio and Net Profit Margin should be benchmarked against industry averages for Saudi medical manufacturers. Improving cash flow through better inventory turnover for consumables is a key recommendation.</p>
                    </div>
                </div>
                <div class="analysis-result-card">
                    <h2>3. Strategic Imperatives for Saudi Mais Co.</h2>
                    <ul>
                        <li>Enhance local manufacturing capabilities for a wider range of single-use medical devices to increase IKTVA contribution and reduce import reliance.</li>
                        <li>Invest in a robust digital QMS and ERP system to improve traceability, compliance (ISO 13485, SFDA), and operational efficiency.</li>
                        <li>Explore strategic partnerships with major hospital groups and governmental healthcare procurement agencies.</li>
                        <li>Develop or source innovative, cost-effective medical consumables tailored to regional needs.</li>
                    </ul>
                </div>
                <div class="recommendation-box">
                    <h4>Primary Recommendation for Saudi Mais Co.</h4>
                    <p>Prioritize strengthening local manufacturing excellence and achieving competitive cost structures for core single-use medical products. Simultaneously, explore niche, high-margin consumables and invest in digital tools to enhance market responsiveness and operational control, directly supporting Saudi Mais Co.'s commitment to quality and growth in the Middle East.</p>
                </div>
            `;
        }

        function generateQualityAnalysisResponseEn(data) {
            return `
                <h1>Quality Management System Review for Saudi Mais Co.</h1>
                ${data ? `<div class="analysis-result-card"><p><strong>Data Insight:</strong> Quality metrics from the provided data/document for Saudi Mais Co. have been central to this assessment.</p></div>` : '<div class="analysis-result-card"><p><strong>Data Insight:</strong> Assessment based on general QMS principles for medical device manufacturers like Saudi Mais Co.</p></div>'}
                <div class="analysis-result-card">
                    <h2>Overall Compliance & Effectiveness (ISO 13485 & SFDA)</h2>
                    <p>Saudi Mais Co. aims for the highest international quality standards. The QMS review, based on available information, suggests foundational adherence to ISO 13485. Continuous improvement efforts should focus on rigorous documentation for design controls (if applicable to their product development), risk management (ISO 14971), and post-market surveillance to ensure full alignment with SFDA requirements for medical consumables.</p>
                    <div class="metric-card">
                        <div class="metric-label">Internal Audit Non-Conformance Rate (Target <1%)</div>
                        <div class="metric-value">1.5% <span class="quality-indicator quality-warning">Needs Improvement</span></div>
                        <p style="font-size:0.8em; opacity:0.7;">(Example metric if data was provided)</p>
                    </div>
                </div>
                <div class="analysis-result-card">
                    <h2>Key Findings & Corrective/Preventive Actions (CAPA)</h2>
                    <ol>
                        <li><strong>Finding (Example):</strong> Inconsistent traceability in batch records for a specific consumable product line. <strong>Action:</strong> Implement enhanced digital batch recording with mandatory field entries; conduct targeted retraining for production staff at Saudi Mais Co.</li>
                        <li><strong>Finding (Example):</strong> Supplier quality audit schedule adherence below target. <strong>Action:</strong> Revise supplier audit plan based on risk; allocate dedicated resources for timely execution.</li>
                        <li><strong>Finding (Example):</strong> Customer complaint resolution times for defective consumables exceed internal KPIs. <strong>Action:</strong> Streamline complaint intake and investigation process; implement stricter CAPA timelines.</li>
                    </ol>
                </div>
                <div class="recommendation-box">
                    <h4>Quality Enhancement Initiative for Saudi Mais Co.</h4>
                    <p>Launch a "Zero Defect" initiative for critical single-use medical products, focusing on proactive risk mitigation in manufacturing processes. Strengthen the supplier quality assurance program, ensuring raw material and component quality aligns with Saudi Mais Co.'s high standards. Invest in advanced training for QA/QC personnel on latest regulatory updates and quality tools.</p>
                </div>
            `;
        }
        function generateDemandForecastResponseEn(data) {
             return `
                <h1>Demand Forecasting & Inventory Optimization for Saudi Mais Co.</h1>
                ${data ? `<div class="analysis-result-card"><p><strong>Data Insight:</strong> Historical sales and inventory data from the provided file for Saudi Mais Co. have shaped this forecast for its single-use medical consumables.</p></div>` : '<div class="analysis-result-card"><p><strong>Data Insight:</strong> Forecast based on general market trends for medical consumables in the Middle East, applied to Saudi Mais Co.</p></div>'}
                <div class="analysis-result-card">
                    <h2>Demand Projections (Next 12 Months - Saudi Mais Co. Consumables)</h2>
                    <p>A seasonal uplift is anticipated for certain respiratory-related consumables in Q4/Q1. Overall demand for general surgical and infection control single-use products manufactured by Saudi Mais Co. shows a steady 6-8% upward trend, driven by increased healthcare activity and population growth in the region.</p>
                    <div class="metric-card">
                        <div class="metric-label">Forecast Accuracy (MAPE - Previous Year)</div>
                        <div class="metric-value">18% <span class="quality-indicator quality-good">Good (Target <15%)</span></div>
                         <p style="font-size:0.8em; opacity:0.7;">(Example metric if data was provided)</p>
                    </div>
                    <h4>Example Product Category Forecast:</h4>
                    <table>
                        <thead><tr><th>Product Category (Saudi Mais Co.)</th><th>Forecasted Units (Next 12m)</th><th>Key Drivers</th></tr></thead>
                        <tbody>
                            <tr><td>Sterile Surgical Gloves</td><td>5,000,000 pairs</td><td>Increased surgical procedures, hospital demand</td></tr>
                            <tr><td>Disposable Face Masks (Type IIR)</td><td>10,000,000 units</td><td>Ongoing public health awareness, institutional use</td></tr>
                            <tr><td>IV Cannulas</td><td>2,500,000 units</td><td>Hospital admissions, outpatient services</td></tr>
                        </tbody>
                    </table>
                </div>
                <div class="analysis-result-card">
                    <h2>Inventory Recommendations for Saudi Mais Co.</h2>
                    <p>Implement a segmented inventory strategy for Saudi Mais Co.'s diverse range of medical consumables. For high-volume, predictable demand items (e.g., standard gloves, masks), consider more aggressive JIT or lean inventory approaches. For critical, less predictable, or long-lead-time imported components/products, maintain higher safety stock levels. Regularly review and update reorder points and EOQ based on refreshed forecasts and supplier reliability.</p>
                    <div class="critical-box">
                        <h4>Stockout Risk Alert (Example from Data)</h4>
                        <p>If data shows: Current inventory for 'Specialized Suture Kit XYZ' is at 5 days of supply, while the typical supplier lead time is 15 days. Immediate action to expedite an order and review safety stock for this item is critical to prevent disruption for Saudi Mais Co.'s customers.</p>
                    </div>
                </div>
            `;
        }
        function generateCompetitorAnalysisResponseEn(data) {
            return `
                <h1>Competitive Landscape Analysis for Saudi Mais Co.</h1>
                ${data ? `<div class="analysis-result-card"><p><strong>Data Insight:</strong> Competitor information from the provided file has been integrated into this analysis of Saudi Mais Co.'s market position.</p></div>` : '<div class="analysis-result-card"><p><strong>Data Insight:</strong> Analysis based on general knowledge of the medical consumables market in the Middle East relevant to Saudi Mais Co.</p></div>'}
                <div class="analysis-result-card">
                    <h2>Market Positioning of Saudi Mais Co. (Single-Use Medical Consumables)</h2>
                    <p>Saudi Mais Co. (founded 1994, Riyadh) is an established local manufacturer known for quality in single-use medical consumables. It competes with larger multinational corporations (MNCs) and emerging regional players. Key competitive factors include product quality/certifications (ISO, SFDA), price, breadth of product line, distribution network, and relationships with major healthcare providers (public and private sectors).</p>
                    <div class="metric-card">
                        <div class="metric-label">Estimated Market Share (KSA - Selected Consumables)</div>
                        <div class="metric-value">12-15% <span class="quality-indicator quality-good">Solid Local Player</span></div>
                         <p style="font-size:0.8em; opacity:0.7;">(Illustrative metric)</p>
                    </div>
                </div>
                <div class="analysis-result-card">
                    <h2>SWOT Analysis Summary (Saudi Mais Co. vs. Key Competitors)</h2>
                    <p><strong>Strengths:</strong> Local manufacturing presence (potential for IKTVA benefits, faster supply for some items), established reputation for quality, understanding of regional needs.</p>
                    <p><strong>Weaknesses:</strong> Potentially higher cost structure compared to some large-scale MNCs or low-cost importers, narrower R&D pipeline for highly innovative products, reliance on some imported raw materials.</p>
                    <p><strong>Opportunities:</strong> Growing healthcare market (Vision 2030), increasing demand for local content, potential for export to other GCC/MENA countries, product line expansion into adjacent consumable categories.</p>
                    <p><strong>Threats:</strong> Intense price competition, particularly in tender-based procurement; rapid technological advancements by global players; supply chain vulnerabilities for imported components.</p>
                </div>
                <h4>Key Competitors (Illustrative):</h4>
                 <ul><li>GlobalMed Devices (MNC - broad portfolio, strong R&D)</li><li>Arabian HealthTech (Regional Distributor/Importer - aggressive pricing)</li><li>Emerging Local Manufacturers (Focus on specific high-volume items)</li></ul>
                <div class="recommendation-box">
                    <h4>Competitive Strategy for Saudi Mais Co.</h4>
                    <p>Saudi Mais Co. should leverage its strengths in local manufacturing and quality assurance. Focus on a hybrid strategy:
                    1.  <strong>Cost Leadership for Core Products:</strong> Optimize manufacturing for high-volume consumables to compete effectively on price while maintaining quality.
                    2.  <strong>Differentiation for Specialized Products:</strong> Develop or source specialized consumables where quality, reliability, and local support can command a premium.
                    3.  <strong>Strengthen Relationships:</strong> Enhance partnerships with key governmental and private healthcare institutions, emphasizing reliability and responsiveness.
                    4.  <strong>Explore Niche Exports:</strong> Target specific GCC/MENA markets where Saudi-made quality products have an advantage.</p>
                </div>
            `;
        }
        function generateComprehensiveAnalysisResponseEn() {
            return `
                <h1>Comprehensive Strategic Analysis: Saudi Mais Co. for Medical Products</h1>
                <div class="analysis-result-card">
                    <h2>1. Executive Summary</h2>
                    <p>Saudi Mais Co. for Medical Products, a Riyadh-based manufacturer of single-use medical consumables since 1994, stands as a key local player committed to high international quality standards. While possessing a solid foundation, the company faces significant business and financial challenges that necessitate immediate and decisive strategic actions. This analysis outlines critical areas for transformation to ensure sustainable growth and enhanced market leadership in the evolving Saudi and Middle Eastern healthcare landscape.</p>
                </div>
                <div class="analysis-result-card">
                    <h2>2. Financial Situation & Recovery Strategies</h2>
                    <p>The company is likely experiencing pressures on liquidity and profitability. A robust recovery plan must focus on:
                    <ul>
                        <li><strong>Aggressive Cost Management:</strong> Implementing lean manufacturing principles to reduce waste and improve efficiency in the production of medical consumables. Target a 10-15% reduction in operational costs over 18 months.</li>
                        <li><strong>Working Capital Optimization:</strong> Improving inventory turnover for its single-use products, renegotiating payment terms with suppliers, and streamlining receivables collection.</li>
                        <li><strong>Debt Restructuring (if applicable):</strong> Exploring options to manage existing debt obligations more effectively.</li>
                        <li><strong>Revenue Enhancement:</strong> Identifying new, higher-margin product niches within medical consumables or exploring value-added services.</li>
                    </ul></p>
                    <div class="critical-box">
                        <h4>Urgent Action: Cash Flow Fortification</h4>
                        <p>Implement immediate measures to improve the cash conversion cycle. This includes a rigorous review of inventory holding costs for all single-use medical products and proactive management of trade receivables and payables.</p>
                    </div>
                </div>
                <div class="analysis-result-card">
                    <h2>3. Market Position & Competitive Dynamics (Medical Consumables)</h2>
                    <p>Saudi Mais Co. benefits from its local manufacturing base and adherence to quality (e.g., ISO 13485). However, it faces competition from MNCs and other regional players in the single-use medical device market. Vision 2030's healthcare expansion and IKTVA (local content) initiatives present significant opportunities.
                    Strategies should include:
                    <ul>
                        <li>Strengthening brand positioning around "Saudi-made quality".</li>
                        <li>Focusing on product categories where local manufacturing offers a distinct advantage (e.g., responsiveness, customization for regional needs).</li>
                        <li>Developing deeper relationships with key public and private healthcare procurement bodies.</li>
                    </ul></p>
                    <div class="metric-card">
                        <div class="metric-label">Customer Retention Rate (Target >85%)</div>
                        <div class="metric-value">78% <span class="quality-indicator quality-warning">Needs Attention</span></div>
                        <p style="font-size:0.8em; opacity:0.7;">(Illustrative)</p>
                    </div>
                </div>
                <div class="analysis-result-card">
                    <h2>4. Operational Assessment & Enhancement</h2>
                    <p>Saudi Mais Co.'s commitment to "highest international quality standards" is a core asset. Operational enhancements should focus on:
                    <ul>
                        <li><strong>QMS Digitization:</strong> Implementing digital tools for better quality control, traceability, and compliance reporting (SFDA, ISO).</li>
                        <li><strong>Supply Chain Resilience:</strong> Diversifying supplier base for critical raw materials for medical consumables and optimizing logistics.</li>
                        <li><strong>Manufacturing Efficiency:</strong> Investing in automation where feasible and continuous process improvement programs.</li>
                    </ul></p>
                </div>
                <div class="analysis-result-card">
                    <h2>5. Strategic Growth Opportunities for Saudi Mais Co.</h2>
                    <ul>
                        <li><strong>IKTVA Alignment:</strong> Maximizing local content in its single-use medical products to gain preference in governmental tenders.</li>
                        <li><strong>Product Line Expansion:</strong> Cautiously expanding into adjacent, high-demand medical consumable categories.</li>
                        <li><strong>Regional Export Development:</strong> Targeting specific GCC and MENA markets with its quality-certified, competitively priced products.</li>
                        <li><strong>Digital Health Integration (Long-term):</strong> Exploring how its consumables can integrate with or support digital health solutions.</li>
                    </ul>
                </div>
                <div class="recommendation-box">
                    <h4>Overarching Strategic Roadmap for Saudi Mais Co.</h4>
                    <p><strong>Phase 1 (0-12 Months): Financial Stabilization & Operational Excellence.</strong> Focus on cost reduction, cash flow improvement, and enhancing QMS efficiency for core medical consumables.</p>
                    <p><strong>Phase 2 (12-24 Months): Market Strengthening & Product Optimization.</strong> Deepen market penetration in KSA, optimize product portfolio based on profitability, and begin targeted export initiatives for its single-use devices.</p>
                    <p><strong>Phase 3 (24+ Months): Sustainable Growth & Diversification.</strong> Scale successful product lines, expand regional footprint, and explore strategic alliances or new technology adoption relevant to medical consumables manufacturing.</p>
                </div>
            `;
        }
        function generateDefaultResponseEn(query) {
             return `
                <div class="analysis-result-card">
                    <h2>Regarding your query for Saudi Mais Co.: "${query.substring(0,50)}..."</h2>
                    <p>As Yazeed AI, your consultant for Saudi Mais Co. (a Riyadh-based manufacturer of single-use medical consumables since 1994, committed to high quality and currently addressing business challenges), I will provide insights based on this context.</p>
                    <p>Saudi Mais Co.'s operations are significantly influenced by the Saudi Vision 2030 healthcare transformation, stringent quality standards (ISO 13485, SFDA), the competitive medical device market, and the drive for local content (IKTVA). For specific data-driven analysis, please utilize the dedicated sections or upload relevant documents. How can I further assist you regarding Saudi Mais Co.'s specific situation or its market for medical consumables?</p>
                </div>
            `;
        }

        // --- Arabic Simulated Responses ---
        function generateAdvancedAnalysisResponseAr(data) {
            return `
                <h1>تحليل الأعمال المتقدم لشركة ميس السعودية</h1>
                ${data ? `<div class="analysis-result-card"><p><strong>رؤية من البيانات:</strong> يتضمن التحليل نقاط بيانات من الملف المرفوع الخاص بشركة ميس السعودية.</p></div>` : '<div class="analysis-result-card"><p><strong>رؤية من البيانات:</strong> تحليل مبني على المعرفة العامة بشركة ميس السعودية.</p></div>'}
                <div class="analysis-result-card">
                    <h2>1. لمحة عن سوق المستهلكات الطبية</h2>
                    <p>من المتوقع أن يشهد سوق الأجهزة الطبية السعودي، وخاصة المستهلكات ذات الاستخدام الواحد، توسعًا كبيرًا، متأثرًا بشكل كبير بتطوير البنية التحتية للرعاية الصحية ضمن رؤية 2030. تكمن الفرص الرئيسية لشركة ميس السعودية في المنتجات المعقمة المتخصصة والمواد المصنعة محليًا والتي تتماشى مع أهداف برنامج اكتفاء (إجمالي القيمة المضافة في المملكة).</p>
                    <div class="metric-card">
                        <div class="metric-label">نمو السوق المتوقع (CAGR - المستهلكات الطبية السعودية)</div>
                        <div class="metric-value">9.2% <span class="quality-indicator quality-excellent">ممتاز</span></div>
                    </div>
                </div>
                <div class="analysis-result-card">
                    <h2>2. تقييم الصحة المالية لشركة ميس السعودية</h2>
                    <p>البيانات المالية الحالية، والتي قد تكون مفصلة في المستندات المرفوعة، من المحتمل أن تشير إلى الحاجة إلى تحسين استراتيجي للتكاليف، وتحسين إدارة رأس المال العامل، وتنويع مصادر الإيرادات بخلاف المنتجات التقليدية. من الضروري الاهتمام بنسب السيولة وهوامش الربح الإجمالية على خطوط الإنتاج الأساسية.</p>
                    <div class="warning-box">
                        <h4>التركيز على السيولة والربحية</h4>
                        <p>إذا أشارت البيانات، يجب مقارنة نسبة السيولة السريعة وهامش الربح الصافي بمتوسطات الصناعة لمصنعي الأجهزة الطبية السعوديين. يعد تحسين التدفق النقدي من خلال تحسين دوران المخزون للمستهلكات توصية رئيسية.</p>
                    </div>
                </div>
                <div class="analysis-result-card">
                    <h2>3. الضرورات الاستراتيجية لشركة ميس السعودية</h2>
                    <ul>
                        <li>تعزيز قدرات التصنيع المحلي لمجموعة أوسع من الأجهزة الطبية ذات الاستخدام الواحد لزيادة مساهمة اكتفاء وتقليل الاعتماد على الاستيراد.</li>
                        <li>الاستثمار في نظام رقمي قوي لإدارة الجودة ونظام تخطيط موارد المؤسسات لتحسين التتبع والامتثال (ISO 13485 ، SFDA) والكفاءة التشغيلية.</li>
                        <li>استكشاف شراكات استراتيجية مع مجموعات المستشفيات الكبرى ووكالات شراء الرعاية الصحية الحكومية.</li>
                        <li>تطوير أو توفير مستهلكات طبية مبتكرة وفعالة من حيث التكلفة مصممة خصيصًا للاحتياجات الإقليمية.</li>
                    </ul>
                </div>
                <div class="recommendation-box">
                    <h4>التوصية الأساسية لشركة ميس السعودية</h4>
                    <p>إعطاء الأولوية لتعزيز التميز في التصنيع المحلي وتحقيق هياكل تكلفة تنافسية للمنتجات الطبية الأساسية ذات الاستخدام الواحد. في الوقت نفسه، استكشاف المستهلكات المتخصصة ذات الهامش المرتفع والاستثمار في الأدوات الرقمية لتعزيز استجابة السوق والتحكم التشغيلي، مما يدعم بشكل مباشر التزام شركة ميس السعودية بالجودة والنمو في الشرق الأوسط.</p>
                </div>
            `;
        }
        function generateQualityAnalysisResponseAr(data) {
             return `
                <h1>مراجعة نظام إدارة الجودة لشركة ميس السعودية</h1>
                ${data ? `<div class="analysis-result-card"><p><strong>رؤية من البيانات:</strong> كانت مقاييس الجودة من البيانات/المستندات المقدمة لشركة ميس السعودية محورية في هذا التقييم.</p></div>` : '<div class="analysis-result-card"><p><strong>رؤية من البيانات:</strong> تقييم مبني على مبادئ QMS العامة لمصنعي الأجهزة الطبية مثل شركة ميس السعودية.</p></div>'}
                <div class="analysis-result-card">
                    <h2>الامتثال والفعالية العامة (ISO 13485 و SFDA)</h2>
                    <p>تهدف شركة ميس السعودية إلى تحقيق أعلى معايير الجودة العالمية. تشير مراجعة نظام إدارة الجودة، بناءً على المعلومات المتاحة، إلى الالتزام الأساسي بـ ISO 13485. يجب أن تركز جهود التحسين المستمر على التوثيق الصارم لضوابط التصميم (إذا كانت قابلة للتطبيق على تطوير منتجاتهم)، وإدارة المخاطر (ISO 14971)، والمراقبة بعد التسويق لضمان التوافق الكامل مع متطلبات الهيئة العامة للغذاء والدواء السعودية للمستهلكات الطبية.</p>
                    <div class="metric-card">
                        <div class="metric-label">معدل عدم المطابقة في التدقيق الداخلي (المستهدف <1%)</div>
                        <div class="metric-value">1.5% <span class="quality-indicator quality-warning">يحتاج لتحسين</span></div>
                        <p style="font-size:0.8em; opacity:0.7;">(مثال على مقياس إذا تم تقديم البيانات)</p>
                    </div>
                </div>
                <div class="analysis-result-card">
                    <h2>النتائج الرئيسية والإجراءات التصحيحية/الوقائية (CAPA)</h2>
                    <ol>
                        <li><strong>النتيجة (مثال):</strong> عدم اتساق التتبع في سجلات الدُفعات لخط إنتاج مستهلك معين. <strong>الإجراء:</strong> تطبيق تسجيل رقمي مُحسَّن للدُفعات مع إدخالات حقل إلزامية؛ إجراء إعادة تدريب مستهدف لموظفي الإنتاج في شركة ميس السعودية.</li>
                        <li><strong>النتيجة (مثال):</strong> الالتزام بجدول تدقيق جودة الموردين أقل من المستهدف. <strong>الإجراء:</strong> مراجعة خطة تدقيق الموردين بناءً على المخاطر؛ تخصيص موارد مخصصة للتنفيذ في الوقت المناسب.</li>
                        <li><strong>النتيجة (مثال):</strong> تجاوز أوقات حل شكاوى العملاء بشأن المستهلكات المعيبة لمؤشرات الأداء الرئيسية الداخلية. <strong>الإجراء:</strong> تبسيط عملية استقبال الشكاوى والتحقيق فيها؛ تطبيق جداول زمنية أكثر صرامة لـ CAPA.</li>
                    </ol>
                </div>
                <div class="recommendation-box">
                    <h4>مبادرة تحسين الجودة لشركة ميس السعودية</h4>
                    <p>إطلاق مبادرة "صفر عيوب" للمنتجات الطبية الحرجة ذات الاستخدام الواحد، مع التركيز على التخفيف الاستباقي للمخاطر في عمليات التصنيع. تعزيز برنامج ضمان جودة الموردين، وضمان توافق جودة المواد الخام والمكونات مع معايير شركة ميس السعودية العالية. الاستثمار في التدريب المتقدم لموظفي ضمان ومراقبة الجودة على أحدث التحديثات التنظيمية وأدوات الجودة.</p>
                </div>
            `;
        }
        function generateDemandForecastResponseAr(data) {
            return `
                <h1>توقعات الطلب وتحسين المخزون لشركة ميس السعودية</h1>
                ${data ? `<div class="analysis-result-card"><p><strong>رؤية من البيانات:</strong> ساهمت بيانات المبيعات والمخزون التاريخية من الملف المقدم لشركة ميس السعودية في تشكيل هذه التوقعات لمستهلكاتها الطبية ذات الاستخدام الواحد.</p></div>` : '<div class="analysis-result-card"><p><strong>رؤية من البيانات:</strong> توقعات مبنية على اتجاهات السوق العامة للمستهلكات الطبية في الشرق الأوسط، مطبقة على شركة ميس السعودية.</p></div>'}
                <div class="analysis-result-card">
                    <h2>توقعات الطلب (للأشهر الـ 12 القادمة - مستهلكات شركة ميس السعودية)</h2>
                    <p>من المتوقع حدوث ارتفاع موسمي لبعض المستهلكات المتعلقة بالجهاز التنفسي في الربع الرابع/الأول. يُظهر الطلب العام على المنتجات الجراحية ومنتجات مكافحة العدوى ذات الاستخدام الواحد التي تصنعها شركة ميس السعودية اتجاهًا تصاعديًا ثابتًا بنسبة 6-8٪، مدفوعًا بزيادة نشاط الرعاية الصحية والنمو السكاني في المنطقة.</p>
                    <div class="metric-card">
                        <div class="metric-label">دقة التوقعات (MAPE - السنة السابقة)</div>
                        <div class="metric-value">18% <span class="quality-indicator quality-good">جيد (المستهدف <15%)</span></div>
                         <p style="font-size:0.8em; opacity:0.7;">(مثال على مقياس إذا تم تقديم البيانات)</p>
                    </div>
                    <h4>مثال على توقعات فئة المنتج:</h4>
                    <table>
                        <thead><tr><th>فئة المنتج (شركة ميس السعودية)</th><th>الوحدات المتوقعة (12 شهرًا قادمة)</th><th>المحركات الرئيسية</th></tr></thead>
                        <tbody>
                            <tr><td>قفازات جراحية معقمة</td><td>5,000,000 زوج</td><td>زيادة العمليات الجراحية، طلب المستشفيات</td></tr>
                            <tr><td>كمامات وجه للاستخدام مرة واحدة (النوع IIR)</td><td>10,000,000 وحدة</td><td>الوعي الصحي العام المستمر، الاستخدام المؤسسي</td></tr>
                            <tr><td>قساطر وريدية</td><td>2,500,000 وحدة</td><td>حالات دخول المستشفيات، خدمات العيادات الخارجية</td></tr>
                        </tbody>
                    </table>
                </div>
                <div class="analysis-result-card">
                    <h2>توصيات المخزون لشركة ميس السعودية</h2>
                    <p>تطبيق استراتيجية مخزون مجزأة لمجموعة متنوعة من المستهلكات الطبية لشركة ميس السعودية. بالنسبة للمواد ذات الحجم الكبير والطلب المتوقع (مثل القفازات القياسية والكمامات)، ضع في اعتبارك مناهج JIT أو المخزون الخالي من الهدر الأكثر جرأة. بالنسبة للمكونات/المنتجات المستوردة الحرجة والأقل قابلية للتنبؤ بها أو ذات المهلة الطويلة، حافظ على مستويات مخزون أمان أعلى. قم بمراجعة وتحديث نقاط إعادة الطلب و EOQ بانتظام بناءً على التوقعات المحدثة وموثوقية الموردين.</p>
                    <div class="critical-box">
                        <h4>تنبيه بمخاطر نفاد المخزون (مثال من البيانات)</h4>
                        <p>إذا أظهرت البيانات: المخزون الحالي من 'طقم الخيوط الجراحية المتخصصة XYZ' يكفي لمدة 5 أيام، بينما تبلغ مهلة التوريد المعتادة 15 يومًا. من الضروري اتخاذ إجراء فوري لتسريع الطلب ومراجعة مخزون الأمان لهذا العنصر لمنع تعطيل عملاء شركة ميس السعودية.</p>
                    </div>
                </div>
            `;
        }
        function generateCompetitorAnalysisResponseAr(data) {
            return `
                <h1>تحليل المشهد التنافسي لشركة ميس السعودية</h1>
                ${data ? `<div class="analysis-result-card"><p><strong>رؤية من البيانات:</strong> تم دمج معلومات المنافسين من الملف المقدم في هذا التحليل لوضع شركة ميس السعودية في السوق.</p></div>` : '<div class="analysis-result-card"><p><strong>رؤية من البيانات:</strong> تحليل مبني على المعرفة العامة بسوق المستهلكات الطبية في الشرق الأوسط ذات الصلة بشركة ميس السعودية.</p></div>'}
                <div class="analysis-result-card">
                    <h2>التموضع السوقي لشركة ميس السعودية (المستهلكات الطبية ذات الاستخدام الواحد)</h2>
                    <p>تُعد شركة ميس السعودية (تأسست عام 1994، الرياض) مُصنعًا محليًا راسخًا معروفًا بالجودة في مجال المستهلكات الطبية ذات الاستخدام الواحد. تنافس الشركة مع شركات كبرى متعددة الجنسيات (MNCs) ولاعبين إقليميين ناشئين. تشمل العوامل التنافسية الرئيسية جودة المنتج/الشهادات (ISO، SFDA)، والسعر، واتساع خط الإنتاج، وشبكة التوزيع، والعلاقات مع كبار مقدمي الرعاية الصحية (القطاعين العام والخاص).</p>
                    <div class="metric-card">
                        <div class="metric-label">الحصة السوقية التقديرية (السعودية - مستهلكات مختارة)</div>
                        <div class="metric-value">12-15% <span class="quality-indicator quality-good">لاعب محلي قوي</span></div>
                         <p style="font-size:0.8em; opacity:0.7;">(مقياس توضيحي)</p>
                    </div>
                </div>
                <div class="analysis-result-card">
                    <h2>ملخص تحليل SWOT (شركة ميس السعودية مقابل المنافسين الرئيسيين)</h2>
                    <p><strong>نقاط القوة:</strong> وجود تصنيع محلي (إمكانية الاستفادة من برنامج اكتفاء، توريد أسرع لبعض المواد)، سمعة راسخة بالجودة، فهم للاحتياجات الإقليمية.</p>
                    <p><strong>نقاط الضعف:</strong> هيكل تكلفة أعلى محتمل مقارنة ببعض الشركات الكبرى متعددة الجنسيات أو المستوردين منخفضي التكلفة، خط أنابيب بحث وتطوير أضيق للمنتجات المبتكرة للغاية، الاعتماد على بعض المواد الخام المستوردة.</p>
                    <p><strong>الفرص:</strong> سوق رعاية صحية متنامي (رؤية 2030)، زيادة الطلب على المحتوى المحلي، إمكانية التصدير إلى دول مجلس التعاون الخليجي/الشرق الأوسط وشمال أفريقيا الأخرى، توسيع خط الإنتاج ليشمل فئات مستهلكات مجاورة.</p>
                    <p><strong>التهديدات:</strong> منافسة سعرية شديدة، خاصة في المشتريات القائمة على المناقصات؛ التطورات التكنولوجية السريعة من قبل اللاعبين العالميين؛ نقاط ضعف سلسلة التوريد للمكونات المستوردة.</p>
                </div>
                <h4>المنافسون الرئيسيون (توضيحي):</h4>
                 <ul><li>جلوبال ميد للأجهزة (شركة متعددة الجنسيات - محفظة واسعة، بحث وتطوير قوي)</li><li>آرابيان هيلث تك (موزع/مستورد إقليمي - تسعير قوي)</li><li>المصنعون المحليون الناشئون (التركيز على مواد معينة ذات حجم كبير)</li></ul>
                <div class="recommendation-box">
                    <h4>الاستراتيجية التنافسية لشركة ميس السعودية</h4>
                    <p>يجب على شركة ميس السعودية الاستفادة من نقاط قوتها في التصنيع المحلي وضمان الجودة. التركيز على استراتيجية هجينة:
                    1.  <strong>قيادة التكلفة للمنتجات الأساسية:</strong> تحسين التصنيع للمستهلكات ذات الحجم الكبير للتنافس بفعالية على السعر مع الحفاظ على الجودة.
                    2.  <strong>التمييز للمنتجات المتخصصة:</strong> تطوير أو توفير مستهلكات متخصصة حيث يمكن للجودة والموثوقية والدعم المحلي أن تبرر سعرًا أعلى.
                    3.  <strong>تعزيز العلاقات:</strong> تعزيز الشراكات مع المؤسسات الصحية الحكومية والخاصة الرئيسية، مع التأكيد على الموثوقية والاستجابة.
                    4.  <strong>استكشاف الصادرات المتخصصة:</strong> استهداف أسواق معينة في دول مجلس التعاون الخليجي/الشرق الأوسط وشمال أفريقيا حيث تتمتع المنتجات السعودية عالية الجودة بميزة.</p>
                </div>
            `;
        }
        function generateComprehensiveAnalysisResponseAr() {
            return `
                <h1>تحليل استراتيجي شامل: شركة ميس السعودية للمنتجات الطبية</h1>
                <div class="analysis-result-card">
                    <h2>1. ملخص تنفيذي</h2>
                    <p>تُعتبر شركة ميس السعودية للمنتجات الطبية، وهي شركة مصنعة للمستهلكات الطبية ذات الاستخدام الواحد مقرها الرياض منذ عام 1994، لاعبًا محليًا رئيسيًا ملتزمًا بمعايير الجودة العالمية العالية. ورغم امتلاكها أساسًا متينًا، تواجه الشركة تحديات كبيرة في الأعمال والجوانب المالية تستلزم اتخاذ إجراءات استراتيجية فورية وحاسمة. يوضح هذا التحليل المجالات الحيوية للتحول لضمان النمو المستدام وتعزيز الريادة في السوق في المشهد الصحي المتطور في السعودية والشرق الأوسط.</p>
                </div>
                <div class="analysis-result-card">
                    <h2>2. الوضع المالي واستراتيجيات التعافي</h2>
                    <p>من المرجح أن الشركة تعاني من ضغوط على السيولة والربحية. يجب أن تركز خطة التعافي القوية على:
                    <ul>
                        <li><strong>إدارة صارمة للتكاليف:</strong> تطبيق مبادئ التصنيع الخالي من الهدر لتقليل الفاقد وتحسين الكفاءة في إنتاج المستهلكات الطبية. استهداف خفض التكاليف التشغيلية بنسبة 10-15٪ على مدى 18 شهرًا.</li>
                        <li><strong>تحسين رأس المال العامل:</strong> تحسين دوران المخزون لمنتجاتها ذات الاستخدام الواحد، وإعادة التفاوض على شروط الدفع مع الموردين، وتبسيط تحصيل المستحقات.</li>
                        <li><strong>إعادة هيكلة الديون (إن وجدت):</strong> استكشاف خيارات لإدارة التزامات الديون الحالية بشكل أكثر فعالية.</li>
                        <li><strong>تعزيز الإيرادات:</strong> تحديد مجالات منتجات جديدة ذات هامش ربح أعلى ضمن المستهلكات الطبية أو استكشاف خدمات ذات قيمة مضافة.</li>
                    </ul></p>
                    <div class="critical-box">
                        <h4>إجراء عاجل: تعزيز التدفق النقدي</h4>
                        <p>تنفيذ تدابير فورية لتحسين دورة تحويل النقد. ويشمل ذلك مراجعة صارمة لتكاليف الاحتفاظ بالمخزون لجميع المنتجات الطبية ذات الاستخدام الواحد والإدارة الاستباقية للذمم التجارية المدينة والدائنة.</p>
                    </div>
                </div>
                <div class="analysis-result-card">
                    <h2>3. المركز السوقي وديناميكيات المنافسة (المستهلكات الطبية)</h2>
                    <p>تستفيد شركة ميس السعودية من قاعدتها التصنيعية المحلية والتزامها بالجودة (مثل ISO 13485). ومع ذلك، تواجه منافسة من الشركات متعددة الجنسيات واللاعبين الإقليميين الآخرين في سوق الأجهزة الطبية ذات الاستخدام الواحد. تمثل مبادرات توسيع الرعاية الصحية ضمن رؤية 2030 ومبادرات المحتوى المحلي (اكتفاء) فرصًا كبيرة.
                    يجب أن تشمل الاستراتيجيات:
                    <ul>
                        <li>تعزيز مكانة العلامة التجارية حول "الجودة السعودية الصنع".</li>
                        <li>التركيز على فئات المنتجات التي يوفر فيها التصنيع المحلي ميزة واضحة (مثل الاستجابة، التخصيص للاحتياجات الإقليمية).</li>
                        <li>تطوير علاقات أعمق مع هيئات الشراء الصحي الحكومية والخاصة الرئيسية.</li>
                    </ul></p>
                    <div class="metric-card">
                        <div class="metric-label">معدل الاحتفاظ بالعملاء (المستهدف >85%)</div>
                        <div class="metric-value">78% <span class="quality-indicator quality-warning">يحتاج لاهتمام</span></div>
                        <p style="font-size:0.8em; opacity:0.7;">(توضيحي)</p>
                    </div>
                </div>
                <div class="analysis-result-card">
                    <h2>4. التقييم والتحسين التشغيلي</h2>
                    <p>يُعد التزام شركة ميس السعودية "بأعلى معايير الجودة العالمية" رصيدًا أساسيًا. يجب أن تركز التحسينات التشغيلية على:
                    <ul>
                        <li><strong>رقمنة نظام إدارة الجودة:</strong> تطبيق أدوات رقمية لتحسين مراقبة الجودة والتتبع وتقارير الامتثال (الهيئة العامة للغذاء والدواء، ISO).</li>
                        <li><strong>مرونة سلسلة التوريد:</strong> تنويع قاعدة الموردين للمواد الخام الحرجة للمستهلكات الطبية وتحسين الخدمات اللوجستية.</li>
                        <li><strong>كفاءة التصنيع:</strong> الاستثمار في الأتمتة حيثما كان ذلك ممكنًا وبرامج التحسين المستمر للعمليات.</li>
                    </ul></p>
                </div>
                <div class="analysis-result-card">
                    <h2>5. فرص النمو الاستراتيجية لشركة ميس السعودية</h2>
                    <ul>
                        <li><strong>التوافق مع برنامج اكتفاء:</strong> تعظيم المحتوى المحلي في منتجاتها الطبية ذات الاستخدام الواحد للحصول على الأفضلية في المناقصات الحكومية.</li>
                        <li><strong>توسيع خط الإنتاج:</strong> التوسع بحذر في فئات المستهلكات الطبية المجاورة ذات الطلب المرتفع.</li>
                        <li><strong>تنمية الصادرات الإقليمية:</strong> استهداف أسواق معينة في دول مجلس التعاون الخليجي والشرق الأوسط وشمال أفريقيا بمنتجاتها المعتمدة بالجودة وبأسعار تنافسية.</li>
                        <li><strong>تكامل الصحة الرقمية (على المدى الطويل):</strong> استكشاف كيف يمكن لمستهلكاتها أن تتكامل مع حلول الصحة الرقمية أو تدعمها.</li>
                    </ul>
                </div>
                <div class="recommendation-box">
                    <h4>خارطة طريق استراتيجية شاملة لشركة ميس السعودية</h4>
                    <p><strong>المرحلة الأولى (0-12 شهرًا): الاستقرار المالي والتميز التشغيلي.</strong> التركيز على خفض التكاليف، وتحسين التدفق النقدي، وتعزيز كفاءة نظام إدارة الجودة للمستهلكات الطبية الأساسية.</p>
                    <p><strong>المرحلة الثانية (12-24 شهرًا): تعزيز السوق وتحسين المنتج.</strong> تعميق اختراق السوق في المملكة العربية السعودية، وتحسين محفظة المنتجات بناءً على الربحية، وبدء مبادرات تصدير مستهدفة لأجهزتها ذات الاستخدام الواحد.</p>
                    <p><strong>المرحلة الثالثة (24+ شهرًا): النمو المستدام والتنويع.</strong> توسيع نطاق خطوط الإنتاج الناجحة، وتوسيع البصمة الإقليمية، واستكشاف التحالفات الاستراتيجية أو اعتماد التكنولوجيا الجديدة ذات الصلة بتصنيع المستهلكات الطبية.</p>
                </div>
            `;
        }
        function generateDefaultResponseAr(query) {
            return `
                <div class="analysis-result-card">
                    <h2>بخصوص استفسارك لشركة ميس السعودية: "${query.substring(0,50)}..."</h2>
                    <p>بصفتي يزيد AI، مستشارك لشركة ميس السعودية (شركة مصنعة للمستهلكات الطبية ذات الاستخدام الواحد مقرها الرياض منذ عام 1994، ملتزمة بالجودة العالية وتواجه حاليًا تحديات في الأعمال)، سأقدم رؤى بناءً على هذا السياق.</p>
                    <p>تتأثر عمليات شركة ميس السعودية بشكل كبير بتحول الرعاية الصحية ضمن رؤية السعودية 2030، ومعايير الجودة الصارمة (ISO 13485، الهيئة العامة للغذاء والدواء)، وسوق الأجهزة الطبية التنافسي، والتوجه نحو المحتوى المحلي (اكتفاء). لتحليل محدد يعتمد على البيانات، يرجى استخدام الأقسام المخصصة أو تحميل المستندات ذات الصلة. كيف يمكنني مساعدتك بشكل أكبر فيما يتعلق بوضع شركة ميس السعودية المحدد أو سوقها للمستهلكات الطبية؟</p>
                </div>
            `;
        }

        function exportResults(section, format) {
            const contentElement = document.getElementById(`${section}AnalysisContent`);
            if (!contentElement) return;
            
            const rawHtmlContent = contentElement.innerHTML; 
            let textContent = new DOMParser().parseFromString(rawHtmlContent, "text/html").documentElement.textContent; 

            const timestamp = new Date().toISOString().replace(/:/g, '-').split('.')[0];
            const filename = `${section}_analysis_SaudiMaisCo_${timestamp}.${format}`;
            
            let exportContent = textContent;
            if (format === 'md') {
                exportContent = convertToMarkdown(rawHtmlContent); 
            } else if (format === 'pdf') {
                exportToPDF(rawHtmlContent, filename);
                return;
            }
            
            const blob = new Blob([exportContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function convertToMarkdown(htmlContent) {
            let md = htmlContent;
            md = md.replace(/<h1>(.*?)<\/h1>/gi, "# $1\n")
                   .replace(/<h2>(.*?)<\/h2>/gi, "## $1\n")
                   .replace(/<h3>(.*?)<\/h3>/gi, "### $1\n")
                   .replace(/<h4>(.*?)<\/h4>/gi, "#### $1\n")
                   .replace(/<p>(.*?)<\/p>/gi, "$1\n\n")
                   .replace(/<ul>/gi, "").replace(/<\/ul>/gi, "")
                   .replace(/<ol>/gi, "").replace(/<\/ol>/gi, "")
                   .replace(/<li>(.*?)<\/li>/gi, "- $1\n")
                   .replace(/<strong>(.*?)<\/strong>/gi, "**$1**")
                   .replace(/<em>(.*?)<\/em>/gi, "*$1*")
                   .replace(/<br\s*\/?>/gi, "\n")
                   .replace(/<[^>]+>/g, '') 
                   .replace(/\n{3,}/g, '\n\n'); 
            
            md = `# ${translations[currentLanguage].pageTitle}\n## ${translations[currentLanguage].companyNameHeader}\n\n${md}`;
            md += `\n\n---\n*${translations[currentLanguage].generatedOn || 'Generated on'} ${new Date().toLocaleString(currentLanguage === 'ar' ? 'ar-SA' : 'en-US')}*`;
            return md;
        }


        function exportToPDF(htmlContent, filename) {
            alert(translations[currentLanguage].alertPdfExport);
            const section = filename.split('_')[0];
            const textContent = new DOMParser().parseFromString(htmlContent, "text/html").documentElement.textContent;
            const blob = new Blob([textContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${section}_analysis_SaudiMaisCo_fallback.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        async function startAnalysis(sectionName, promptBuilder) {
            const textInputEl = document.getElementById(`${sectionName}TextInput`);
            const textInput = textInputEl ? textInputEl.value : '';
            
            const focusInputEl = document.getElementById(`${sectionName}FocusInput`);
            const focusInputFileEl = document.getElementById(`${sectionName}FocusInputFile`);
            const focusInput = (focusInputEl && focusInputEl.value) ? focusInputEl.value : (focusInputFileEl ? focusInputFileEl.value : '');
            
            const fileDataContent = fileContents[sectionName] || ""; 
            const resultsContainer = document.getElementById(`${sectionName}Results`);
            const contentContainer = document.getElementById(`${sectionName}AnalysisContent`);

            if (!textInput && !fileDataContent && sectionName !== 'ai-chat') {
                alert(translations[currentLanguage].alertNoData);
                return;
            }

            const statusKeysMap = {
                'advanced': ['advancedStep1Text', 'advancedStep2Text', 'advancedStep3Text', 'advancedStep4Text'],
                'quality': ['qualityStep1Text', 'qualityStep2Text', 'qualityStep3Text', 'qualityStep4Text'],
                'demand': ['demandStep1Text', 'demandStep2Text', 'demandStep3Text', 'demandStep4Text'],
                'competitor': ['competitorStep1Text', 'competitorStep2Text', 'competitorStep3Text', 'competitorStep4Text']
            };
            
            if (statusKeysMap[sectionName]) {
                showAnalysisStatus(sectionName, statusKeysMap[sectionName]);
            }
            
            if (resultsContainer) resultsContainer.style.display = 'block';
            if (contentContainer) contentContainer.innerHTML = `<div class="loading-enhanced" style="margin: 20px auto; width: fit-content;"><div class="loading-dots"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div>${translations[currentLanguage].loadingAnalysisText}</div>`;
            
            const primaryDataForAnalysis = fileDataContent || textInput;
            const prompt = promptBuilder(primaryDataForAnalysis, focusInput, currentLanguage); 
            
            try {
                const response = await callGeminiAPI(prompt, primaryDataForAnalysis); 
                if (contentContainer) contentContainer.innerHTML = formatContent(response); 
                saveAnalysisResults(sectionName, response);
            } catch (error) {
                if (contentContainer) contentContainer.innerHTML = translations[currentLanguage].analysisFailedMsg;
                console.error("Analysis failed:", error);
            }
        }
        
        function startAdvancedAnalysis() {
            startAnalysis('advanced', (data, focus, lang) => {
                const companyContextEn = "As an expert business analyst for Saudi Mais Co. for Medical Products (a leading manufacturer of single-use medical consumables in the Middle East, founded in 1994 in Riyadh, committed to highest international quality standards):";
                const companyContextAr = "بصفتك خبير تحليل أعمال لشركة ميس السعودية للمنتجات الطبية (شركة رائدة في تصنيع المستهلكات الطبية ذات الاستخدام الواحد في الشرق الأوسط، تأسست عام 1994 في الرياض، وملتزمة بأعلى معايير الجودة العالمية):";
                
                const fileInfoEn = data ? "Based *primarily* on the provided data/document content for Saudi Mais Co., and supplementing with your general knowledge where appropriate:" : "Based on your general knowledge of Saudi Mais Co. and the medical device market:";
                const fileInfoAr = data ? "بالاعتماد *بشكل أساسي* على محتوى البيانات/المستند المقدم الخاص بشركة ميس السعودية، مع الاستعانة بمعرفتك العامة عند الاقتضاء:" : "بناءً على معرفتك العامة بشركة ميس السعودية وسوق الأجهزة الطبية:";

                if (lang === 'ar') {
                    return `
                        ${companyContextAr}
                        ${fileInfoAr}
                        قم بإجراء تحليل أعمال متقدم وشامل.
                        يجب أن تشمل الاعتبارات الرئيسية اتجاهات السوق الحالية، والأداء المالي للشركة، والكفاءة التشغيلية، وفرص النمو الاستراتيجية، لا سيما في سياق خطط تطوير الرعاية الصحية ضمن رؤية السعودية 2030 وتخصص الشركة في الأجهزة الطبية ذات الاستخدام الواحد.
                        ${focus ? `يجب إيلاء تركيز خاص على: ${focus}\n` : ''}
                        يرجى تقديم تقرير مفصل منظم بالأقسام التالية:
                        1.  تحليل بيئة السوق (بما في ذلك الاتجاهات والمنافسة والمشهد التنظيمي المتعلق بالمستهلكات الطبية).
                        2.  تقييم متعمق للصحة المالية (تقييم الربحية والسيولة والملاءة والكفاءة).
                        3.  مراجعة الأداء التشغيلي (التصنيع، سلسلة التوريد، روابط مراقبة الجودة).
                        4.  توصيات نمو استراتيجية (قابلة للتنفيذ، ذات أولوية، ومرتبطة برؤية 2030).
                        5.  تقييم شامل للمخاطر واستراتيجيات التخفيف.
                        تأكد من أن التحليل قابل للتنفيذ ومصمم خصيصًا لشركة مصنعة للمنتجات الطبية مثل شركة ميس السعودية.
                    `;
                }
                return `
                    ${companyContextEn}
                    ${fileInfoEn}
                    Conduct a comprehensive advanced business analysis.
                    Key considerations should include current market trends, the company's financial performance, operational efficiency, and strategic growth opportunities, particularly within the context of Saudi Vision 2030's healthcare development plans and the company's specialization in single-use medical devices.
                    ${focus ? `Specific focus should be given to: ${focus}\n` : ''}
                    Please provide a detailed report structured with the following sections:
                    1.  Market Environment Analysis (including trends, competition, and regulatory landscape relevant to medical consumables).
                    2.  In-depth Financial Health Assessment (evaluating profitability, liquidity, solvency, and efficiency).
                    3.  Operational Performance Review (manufacturing, supply chain, quality control links).
                    4.  Strategic Growth Recommendations (actionable, prioritized, and linked to Vision 2030).
                    5.  Comprehensive Risk Assessment and Mitigation Strategies.
                    Ensure the analysis is actionable and tailored to a medical products manufacturer like Saudi Mais Co.
                `;
            });
        }

        function startQualityAnalysis() {
             startAnalysis('quality', (data, focus, lang) => {
                const companyContextEn = "As a specialized quality assurance consultant for Saudi Mais Co. for Medical Products (a leading manufacturer of single-use medical consumables in the Middle East, founded in 1994 in Riyadh, committed to highest international quality standards and adhering to standards like ISO 13485):";
                const companyContextAr = "بصفتك استشاري ضمان جودة متخصص لشركة ميس السعودية للمنتجات الطبية (شركة رائدة في تصنيع المستهلكات الطبية ذات الاستخدام الواحد في الشرق الأوسط، تأسست عام 1994 في الرياض، وملتزمة بأعلى معايير الجودة العالمية وتطبيق معايير مثل ISO 13485):";

                const fileInfoEn = data ? "Based *primarily* on the provided quality data/documentation for Saudi Mais Co., and supplementing with your expertise:" : "Based on your expertise in medical device quality management systems and general knowledge of Saudi Mais Co.:";
                const fileInfoAr = data ? "بالاعتماد *بشكل أساسي* على بيانات/وثائق الجودة المقدمة الخاصة بشركة ميس السعودية، مع الاستعانة بخبرتك:" : "بناءً على خبرتك في أنظمة إدارة جودة الأجهزة الطبية ومعرفتك العامة بشركة ميس السعودية:";
                
                if (lang === 'ar') {
                    return `
                        ${companyContextAr}
                        ${fileInfoAr}
                        قم بإجراء تحليل شامل لنظام إدارة الجودة (QMS) بالشركة.
                        قيّم فعاليته وامتثاله، خاصةً لمعيار ISO 13485، ولوائح الهيئة العامة للغذاء والدواء السعودية ذات الصلة، والمعايير الدولية الأخرى المطبقة على الأجهزة الطبية.
                        يجب أن يركز التحليل على معدلات العيوب، واتجاهات عدم المطابقة، وتحليل الأسباب الجذرية لمشكلات الجودة، وملاحظات العملاء, وإدارة جودة الموردين.
                        ${focus ? `يجب إيلاء تركيز خاص على: ${focus}\n` : ''}
                        يرجى تقديم تقرير شامل يتضمن:
                        1.  الفعالية الإجمالية لنظام إدارة الجودة وحالة الامتثال.
                        2.  تحليل مفصل للعيوب واتجاهات عدم المطابقة.
                        3.  تقييم الالتزام بمتطلبات ISO 13485 والهيئة العامة للغذاء والدواء.
                        4.  تقييم التعامل مع شكاوى العملاء ومقاييس الرضا.
                        5.  خطة تحسين جودة قوية وقابلة للتنفيذ مع توصيات ذات أولوية.
                        الهدف هو تعزيز جودة المنتج والامتثال التنظيمي لشركة ميس السعودية.
                    `;
                }
                return `
                    ${companyContextEn}
                    ${fileInfoEn}
                    Conduct a thorough analysis of the company's Quality Management System (QMS).
                    Evaluate its effectiveness and compliance, particularly against ISO 13485, relevant Saudi Food and Drug Authority (SFDA) regulations, and other applicable international standards for medical devices.
                    The analysis should emphasize defect rates, non-conformance trends, root cause analysis of quality issues, customer feedback, and supplier quality management.
                    ${focus ? `Specific focus should be given to: ${focus}\n` : ''}
                    Please deliver a comprehensive report including:
                    1.  Overall QMS Effectiveness and Compliance Status.
                    2.  Detailed Defect Analysis and Non-Conformance Trends.
                    3.  Assessment of Adherence to ISO 13485 and SFDA Requirements.
                    4.  Evaluation of Customer Complaint Handling and Satisfaction Metrics.
                    5.  A robust, actionable Quality Improvement Plan with prioritized recommendations.
                    The aim is to enhance product quality and regulatory compliance for Saudi Mais Co.
                `;
            });
        }

        function startDemandForecasting() {
            startAnalysis('demand', (data, focus, lang) => {
                const companyContextEn = "As an expert demand planner and inventory strategist for Saudi Mais Co. for Medical Products (a leading manufacturer of single-use medical consumables in the Middle East, founded in 1994 in Riyadh, aiming to meet increasing regional demand):";
                const companyContextAr = "بصفتك خبير تخطيط طلب واستراتيجي مخزون لشركة ميس السعودية للمنتجات الطبية (شركة رائدة في تصنيع المستهلكات الطبية ذات الاستخدام الواحد في الشرق الأوسط، تأسست عام 1994 في الرياض، وتهدف إلى تلبية الطلب الإقليمي المتزايد):";

                const fileInfoEn = data ? "Based *primarily* on the provided historical sales, inventory, and market data for Saudi Mais Co.:" : "Using your analytical expertise and general knowledge of demand patterns for medical consumables in the Middle East, specifically for Saudi Mais Co.:";
                const fileInfoAr = data ? "بالاعتماد *بشكل أساسي* على بيانات المبيعات والمخزون والسوق التاريخية المقدمة لشركة ميس السعودية:" : "باستخدام خبرتك التحليلية ومعرفتك العامة بأنماط الطلب على المستهلكات الطبية في الشرق الأوسط، وتحديداً لشركة ميس السعودية:";

                if (lang === 'ar') {
                    return `
                        ${companyContextAr}
                        ${fileInfoAr}
                        قم بإجراء تحليل مفصل لتوقعات الطلب ووضع استراتيجية لتحسين المخزون.
                        حلل البيانات التاريخية لتحديد الأنماط الموسمية، واتجاهات النمو، وتأثير عوامل مثل مبادرات توسيع الرعاية الصحية (مثل رؤية 2030)، والأحداث الصحية العامة، وإطلاق منتجات جديدة للأجهزة الطبية ذات الاستخدام الواحد.
                        ${focus ? `يجب إيلاء تركيز خاص على: ${focus}\n` : ''}
                        يجب أن يتضمن تقريرك ما يلي:
                        1.  تحليل شامل للطلب: مراجعة اتجاهات المبيعات التاريخية ومحركات الطلب الرئيسية.
                        2.  نتائج التوقعات: توقعات طلب لمدة 12 شهرًا حسب فئة المنتج (إن أمكن)، مع فترات ثقة.
                        3.  استراتيجية تحسين المخزون: توصيات لمستويات المخزون المثلى، ونقاط إعادة الطلب، وحسابات مخزون الأمان، وتقنيات التحكم في المخزون (مثل تحليل ABC، اعتبارات JIT) للمستهلكات الطبية.
                        4.  خارطة طريق للتنفيذ: الخطوات الرئيسية لشركة ميس السعودية لتنفيذ استراتيجيات التنبؤ والمخزون المقترحة.
                        الهدف هو تحسين دقة التوقعات، وتحسين مستويات المخزون، وتقليل تكاليف الاحتفاظ، وتقليل حالات نفاد المخزون.
                    `;
                }
                return `
                    ${companyContextEn}
                    ${fileInfoEn}
                    Conduct a detailed demand forecasting analysis and develop an inventory optimization strategy.
                    Analyze historical data to identify seasonal patterns, growth trends, and the impact of factors such as healthcare expansion initiatives (e.g., Vision 2030), public health events, and new product introductions for single-use medical devices.
                    ${focus ? `Specific focus should be given to: ${focus}\n` : ''}
                    Your report should include:
                    1.  Comprehensive Demand Analysis: Review of historical sales trends and key demand drivers.
                    2.  Forecasting Results: A 12-month demand projection by product category (if possible), with confidence intervals.
                    3.  Inventory Optimization Strategy: Recommendations for optimal inventory levels, reorder points, safety stock calculations, and inventory control techniques (e.g., ABC analysis, JIT considerations) for medical consumables.
                    4.  Implementation Roadmap: Key steps for Saudi Mais Co. to implement the proposed forecasting and inventory strategies.
                    The goal is to improve forecast accuracy, optimize stock levels, reduce holding costs, and minimize stockouts.
                `;
            });
        }

        function startCompetitorAnalysis() {
             startAnalysis('competitor', (data, focus, lang) => {
                const companyContextEn = "As a market intelligence analyst specializing in the medical device sector for Saudi Mais Co. for Medical Products (a leading manufacturer of single-use medical consumables in the Middle East, founded in 1994 in Riyadh, operating in a competitive market):";
                const companyContextAr = "بصفتك محلل معلومات سوق متخصص في قطاع الأجهزة الطبية لشركة ميس السعودية للمنتجات الطبية (شركة رائدة في تصنيع المستهلكات الطبية ذات الاستخدام الواحد في الشرق الأوسط، تأسست عام 1994 في الرياض، وتعمل في سوق تنافسي):";

                const fileInfoEn = data ? "Based *primarily* on the provided competitor data and market intelligence for Saudi Mais Co.:" : "Leveraging your market research skills and knowledge of the competitive landscape for medical device manufacturers in Saudi Arabia and the Middle East, with a focus on Saudi Mais Co.:";
                const fileInfoAr = data ? "بالاعتماد *بشكل أساسي* على بيانات المنافسين ومعلومات السوق المقدمة الخاصة بشركة ميس السعودية:" : "بالاستفادة من مهاراتك في أبحاث السوق ومعرفتك بالمشهد التنافسي لمصنعي الأجهزة الطبية في المملكة العربية السعودية والشرق الأوسط، مع التركيز على شركة ميس السعودية:";

                if (lang === 'ar') {
                    return `
                        ${companyContextAr}
                        ${fileInfoAr}
                        قم بإجراء تحليل تنافسي شامل يركز على أسواق المملكة العربية السعودية والشرق الأوسط الأوسع للأجهزة الطبية ذات الاستخدام الواحد.
                        حدد المنافسين الرئيسيين (المحليين والدوليين)، وحلل حصصهم السوقية، ومحافظ منتجاتهم، واستراتيجيات التسعير، وقنوات التوزيع، ونقاط القوة والضعف، والتكتيكات التسويقية.
                        ${focus ? `يجب إيلاء تركيز خاص على: ${focus}\n` : ''}
                        يرجى تنظيم تحليلك ليشمل:
                        1.  نظرة عامة مفصلة على المشهد السوقي: الحجم، النمو، القطاعات الرئيسية للمستهلكات الطبية.
                        2.  تقييم تنافسي متعمق: ملفات تعريفية لـ 3-5 منافسين رئيسيين، بما في ذلك تحليل SWOT الخاص بهم من منظور شركة ميس السعودية.
                        3.  تحليل مقارن: مقارنة شركة ميس السعودية بالمنافسين على العوامل الرئيسية (جودة المنتج، السعر، الابتكار، الخدمة).
                        4.  تحديد الفرص والتهديدات: بناءً على الديناميكيات التنافسية واتجاهات السوق.
                        5.  توصيات استراتيجية: استراتيجيات قابلة للتنفيذ لشركة ميس السعودية لتعزيز مركزها التنافسي، وتمييز عروضها، والاستفادة من فرص السوق المحددة.
                        يجب أن يوفر التحليل لشركة ميس السعودية رؤى واضحة لإرشاد استراتيجيتها التنافسية.
                    `;
                }
                return `
                    ${companyContextEn}
                    ${fileInfoEn}
                    Conduct a comprehensive competitor analysis focusing on the Saudi Arabian and broader Middle Eastern markets for single-use medical devices.
                    Identify key competitors (local and international), analyze their market share, product portfolios, pricing strategies, distribution channels, strengths, weaknesses, and marketing tactics.
                    ${focus ? `Specific focus should be given to: ${focus}\n` : ''}
                    Please structure your analysis to include:
                    1.  Detailed Market Landscape Overview: Size, growth, key segments for medical consumables.
                    2.  In-depth Competitive Assessment: Profiles of 3-5 key competitors, including their SWOT analysis from Saudi Mais Co.'s perspective.
                    3.  Comparative Analysis: Benchmarking Saudi Mais Co. against competitors on key factors (product quality, price, innovation, service).
                    4.  Opportunity and Threat Identification: Based on competitive dynamics and market trends.
                    5.  Strategic Recommendations: Actionable strategies for Saudi Mais Co. to enhance its competitive positioning, differentiate its offerings, and capitalize on identified market opportunities.
                    The analysis should provide Saudi Mais Co. with clear insights to inform its competitive strategy.
                `;
            });
        }

        async function sendMessageToAI(message, loadingTextKey, promptBuilder) {
            const chatMessagesContainer = document.getElementById('chatMessages');
            
            const aiThinkingPara = document.createElement('p');
            const aiStrong = document.createElement('strong');
            aiStrong.textContent = translations[currentLanguage].aiAssistantName;
            aiThinkingPara.appendChild(aiStrong);
            aiThinkingPara.innerHTML += ` <div class="loading-enhanced" style="margin-top: 5px;"><div class="loading-dots"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div>${translations[currentLanguage][loadingTextKey]}</div>`;
            chatMessagesContainer.appendChild(aiThinkingPara);
            chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;

            const prompt = promptBuilder(message, currentLanguage);
            const response = await callGeminiAPI(prompt); // No dataContent passed here as it's for general chat or a full comprehensive analysis request
            
            aiThinkingPara.innerHTML = ''; 
            aiThinkingPara.appendChild(aiStrong); 
            const responseContentDiv = document.createElement('div');
            responseContentDiv.className = 'formatted-content'; 
            responseContentDiv.innerHTML = formatContent(response); 
            aiThinkingPara.appendChild(responseContentDiv);
            
            chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            if (!message) return;

            const chatMessagesContainer = document.getElementById('chatMessages');
            const userPara = document.createElement('p');
            const userStrong = document.createElement('strong');
            userStrong.textContent = currentLanguage === 'ar' ? "أنت:" : "You:";
            userPara.appendChild(userStrong);
            userPara.appendChild(document.createTextNode(` ${message}`));
            chatMessagesContainer.appendChild(userPara);
            input.value = '';

            await sendMessageToAI(message, 'loadingQueryText', (query, lang) => {
                if (lang === 'ar') {
                    return `
                        بصفتك يزيد AI، مستشارك الذكي المخصص لشركة ميس السعودية للمنتجات الطبية (شركة رائدة في تصنيع المستهلكات الطبية ذات الاستخدام الواحد في الشرق الأوسط منذ عام 1994، مقرها الرياض، تركز على الإنتاج عالي الجودة وتواجه حاليًا تحديات في الأعمال):
                        يرجى معالجة استفسار المستخدم التالي بعناية: "${query}".
                        يجب أن يستند ردك إلى ملف الشركة، وديناميكيات أسواق الرعاية الصحية السعودية والشرق أوسطية، وأهداف رؤية السعودية 2030، والاتجاهات الحالية في المعدات والمستهلكات الطبية. قدم رؤى قابلة للتنفيذ أو تفسيرات واضحة حيثما أمكن.
                    `;
                }
                return `
                    As Yazeed AI, your dedicated AI consultant for Saudi Mais Co. for Medical Products (a leading manufacturer of single-use medical consumables in the Middle East since 1994, based in Riyadh, focused on high-quality production and currently navigating business challenges):
                    Please address the following user query thoughtfully: "${query}".
                    Your response should be informed by the company's profile, the dynamics of the Saudi and Middle Eastern healthcare markets, the objectives of Saudi Vision 2030, and current trends in medical equipment and consumables. Provide actionable insights or clear explanations where possible.
                `;
            });
        }

        async function startComprehensiveAnalysis() {
            const chatMessagesContainer = document.getElementById('chatMessages');
             const analysisTitlePara = document.createElement('p');
             const analysisTitleStrong = document.createElement('strong');
             analysisTitleStrong.textContent = translations[currentLanguage].comprehensiveAnalysisResultTitle;
             analysisTitlePara.appendChild(analysisTitleStrong);
             chatMessagesContainer.appendChild(analysisTitlePara);


            await sendMessageToAI("", 'loadingComprehensiveAnalysisText', (queryIgnored, lang) => {
                if (lang === 'ar') {
                     return `
                        بصفتك يزيد AI، قدم تحليل أعمال استراتيجي شامل لشركة ميس السعودية للمنتجات الطبية.
                        ملف الشركة: شركة رائدة في تصنيع المستهلكات الطبية ذات الاستخدام الواحد في الشرق الأوسط، تأسست عام 1994، ومقرها الرياض، المملكة العربية السعودية. تؤكد الشركة على الالتزام بأعلى معايير الجودة العالمية في إنتاجها وتواجه حاليًا تحديات كبيرة في الأعمال والجوانب المالية.
                        يجب أن يكون تحليلك منظمًا ومفصلاً، ويغطي المجالات الحيوية التالية:
                        1.  الوضع المالي الحالي واستراتيجيات التعافي الممكنة: تقييم السيولة والربحية والديون، واقتراح خطوات عملية لتحقيق الاستقرار المالي والتحول.
                        2.  المركز السوقي والمشهد التنافسي: تقييم الحصة السوقية، وتصور العلامة التجارية، والمنافسين الرئيسيين في قطاع الأجهزة الطبية ذات الاستخدام الواحد، وتأثير مبادرات الرعاية الصحية ضمن رؤية 2030.
                        3.  تقييم الكفاءة التشغيلية: مراجعة عمليات التصنيع، وإدارة سلسلة التوريد، وأنظمة مراقبة الجودة (مع مراعاة التزامهم بمعايير الجودة العالية)، وفرص تحسين التكاليف وزيادة الكفاءة.
                        4.  فرص النمو الاستراتيجية: تحديد مجالات النمو المحتملة، مثل تطوير منتجات جديدة (في إطار المستهلكات الطبية)، والتوسع في السوق (إقليميًا)، والاستفادة من مبادرات المحتوى المحلي (مثل برنامج اكتفاء).
                        5.  خارطة طريق استراتيجية مفصلة: ضع خطة مرحلية (قصيرة، متوسطة، طويلة الأجل) بأهداف ومعالم واضحة.
                        6.  تحليل المخاطر والتخفيف منها: تحديد المخاطر الرئيسية (المالية، التشغيلية، السوقية، التنظيمية) واقتراح استراتيجيات للتخفيف منها.
                        ضع تحليلك في سياق رؤية السعودية 2030، والتوجه نحو المحتوى المحلي (اكتفاء)، وإمكانات التوسع الإقليمي في الشرق الأوسط. يجب أن يكون الناتج احترافيًا وثاقبًا ويقدم توصيات واضحة وقابلة للتنفيذ لقيادة شركة ميس السعودية.
                    `;
                }
                return `
                    As Yazeed AI, provide a comprehensive strategic business analysis for Saudi Mais Co. for Medical Products.
                    Company Profile: A leading manufacturer of single-use medical consumables in the Middle East, founded in 1994, located in Riyadh, Saudi Arabia. The company emphasizes adherence to the highest international quality standards in its production and is currently addressing significant business and financial challenges.
                    Your analysis should be structured and detailed, covering the following critical areas:
                    1.  Current Financial Situation & Viable Recovery Strategies: Assess liquidity, profitability, debt, and propose actionable steps for financial stabilization and turnaround.
                    2.  Market Position & Competitive Landscape: Evaluate market share, brand perception, key competitors in the single-use medical device sector, and impact of Vision 2030 healthcare initiatives.
                    3.  Operational Efficiency Assessment: Review manufacturing processes, supply chain management, quality control systems (considering their commitment to high standards), and opportunities for cost optimization and efficiency gains.
                    4.  Strategic Growth Opportunities: Identify potential areas for growth, such as new product development (within medical consumables), market expansion (regional), and leveraging local content initiatives (e.g., IKTVA).
                    5.  Detailed Strategic Roadmap: Outline a phased plan (short, medium, long-term) with clear objectives and milestones.
                    6.  Risk Analysis and Mitigation: Identify key risks (financial, operational, market, regulatory) and propose mitigation strategies.
                    Contextualize your analysis within the framework of Saudi Vision 2030, the drive for local content (IKTVA), and potential for regional expansion in the Middle East. The output should be professional, insightful, and provide clear, actionable recommendations for Saudi Mais Co.'s leadership.
                `;
            });
        }

        document.getElementById('userInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) { 
                e.preventDefault();
                sendMessage();
            }
        });

        window.addEventListener('scroll', function() {
            if (window.innerWidth <= 768) { 
                 document.querySelectorAll('.analysis-card, .section-card, .results-section').forEach(card => {
                    card.style.transform = card.style.transform.replace(/rotateY\([^)]+\)/, 'rotateY(0deg)'); 
                 });
                return;
            }

            const cards = document.querySelectorAll('.analysis-card, .section-card, .results-section');
            cards.forEach((card) => {
                const rect = card.getBoundingClientRect();
                const isVisible = rect.top < window.innerHeight && rect.bottom > 0;
                
                if (isVisible) {
                    const scrollFactor = Math.min(1, Math.max(-1, (rect.top - (window.innerHeight / 2) + (rect.height / 2)) / (window.innerHeight / 2)));
                    const translateZ = 60 - Math.abs(scrollFactor) * 40; 
                    let rotateY = scrollFactor * -7; 
                    if (currentLanguage === 'ar') rotateY *= -1; 
                    const scale = 1 - Math.abs(scrollFactor) * 0.03; 
                    
                    if(Math.abs(rotateY) > 0.5 || Math.abs(1-scale) > 0.005) {
                       card.style.transform = `translateZ(${translateZ}px) rotateY(${rotateY}deg) scale(${scale})`;
                    }
                }
            });
        });

        function saveAnalysisResults(section, results) {
            analysisHistory[section] = {
                timestamp: new Date().toISOString(),
                results: results,
                version: '2.2' 
            };
            try {
                localStorage.setItem('maisAnalysisHistory', JSON.stringify(analysisHistory));
            } catch (e) {
                console.warn("Could not save analysis history to localStorage:", e);
            }
        }

        function loadAnalysisHistory() {
            try {
                const saved = localStorage.getItem('maisAnalysisHistory');
                if (saved) {
                    const loadedHistory = JSON.parse(saved);
                    // Basic version check, can be expanded
                    if (loadedHistory && (loadedHistory.version === '2.1' || loadedHistory.version === '2.2')) {
                         analysisHistory = loadedHistory;
                    } else {
                        // Clear old history if version mismatch or invalid
                        analysisHistory = {};
                        localStorage.removeItem('maisAnalysisHistory');
                    }
                }
            } catch (error) {
                console.warn('Failed to load analysis history:', error);
                analysisHistory = {};
            }
        }

        function adjustApiStatusPosition() {
            const apiStatus = document.getElementById('apiStatus');
            if (!apiStatus) return;

            if (window.innerWidth <= 768) {
                if (apiStatus.style.position !== 'relative') {
                    apiStatus.style.position = 'relative';
                    apiStatus.style.top = 'auto';
                    apiStatus.style.right = 'auto';
                    apiStatus.style.left = 'auto';
                    apiStatus.style.margin = '10px auto';
                    apiStatus.style.width = 'fit-content';
                }
            } else {
                 if (apiStatus.style.position !== 'fixed') {
                    apiStatus.style.position = 'fixed';
                    apiStatus.style.top = '20px';
                    apiStatus.style.margin = '0';
                    apiStatus.style.width = 'auto'; 
                    if (currentLanguage === 'ar') {
                        apiStatus.style.left = '20px';
                        apiStatus.style.right = 'auto';
                    } else {
                        apiStatus.style.right = '20px';
                        apiStatus.style.left = 'auto';
                    }
                 }
            }
        }

        window.addEventListener('resize', adjustApiStatusPosition);
        
        document.addEventListener('DOMContentLoaded', function() {
            setLanguage(currentLanguage);
            loadAnalysisHistory();
            adjustApiStatusPosition(); 
            
            const defaultActiveButton = document.querySelector(`.nav-btn[onclick*="showSection('${currentSection}')"]`);
            if (defaultActiveButton) defaultActiveButton.classList.add('active');
            
            const elementsToAnimate = document.querySelectorAll('.analysis-card, .solution-card, .section-card, .company-info');
            elementsToAnimate.forEach((element, index) => {
                element.style.opacity = '0';
                const baseTransformZ = element.classList.contains('company-info') ? '50px' : '40px';
                element.style.transform = `translateZ(0px) translateY(50px)`;
                
                setTimeout(() => {
                    element.style.transition = 'opacity 0.7s ease-out, transform 0.7s cubic-bezier(0.23, 1, 0.320, 1)';
                    element.style.opacity = '1';
                    element.style.transform = `translateZ(${baseTransformZ}) translateY(0px)`;
                }, index * 80); 
            });
        });
    </script>
</body>
</html>