<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate-key="pageTitle">Smart Business Analytics - Saudi Mais Co</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: white;
            overflow-x: hidden;
            perspective: 2000px;
            min-height: 100vh;
        }

        .language-switcher {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1001;
            display: flex;
            gap: 10px;
        }

        html[dir="rtl"] .language-switcher {
            left: auto;
            right: 20px;
        }

        .lang-btn {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: white;
            cursor: pointer;
            border-radius: 20px;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .lang-btn:hover, .lang-btn.active {
            background: linear-gradient(45deg, #00c6ff, #0072ff);
            border-color: transparent;
        }


        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            transform-style: preserve-3d;
        }

        .header {
            text-align: center;
            padding: 80px 0 40px 0; /* Increased top padding for lang switcher & API status */
            transform: translateZ(100px);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateZ(100px) translateY(0px); }
            50% { transform: translateZ(120px) translateY(-20px); }
        }

        .header h1 {
            font-size: 3.5em;
            background: linear-gradient(45deg, #00c6ff, #0072ff, #ff6b6b);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(0, 198, 255, 0.5);
            margin-bottom: 20px;
        }
        
        .navigation {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
            transform: translateZ(50px);
        }

        .nav-btn {
            padding: 12px 25px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            transform: translateZ(10px);
            border: 2px solid transparent;
        }

        .nav-btn:hover, .nav-btn.active {
            transform: translateZ(20px) scale(1.05);
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .section {
            display: none;
            animation: fadeInUp 0.6s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .company-info {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 30px;
            margin: 30px 0;
            transform: translateZ(50px) rotateX(5deg);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.5s ease;
        }

        .company-info:hover {
            transform: translateZ(80px) rotateX(0deg) scale(1.02);
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 30px;
            margin: 40px 0;
            transform-style: preserve-3d;
        }

        .analysis-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            transform: translateZ(40px);
            box-shadow: 
                0 15px 35px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.6s cubic-bezier(0.23, 1, 0.320, 1);
            position: relative;
            overflow: hidden;
        }

        .analysis-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s;
        }
        html[dir="rtl"] .analysis-card::before {
            left: auto;
            right: -100%;
            background: linear-gradient(-90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: right 0.6s;
        }


        .analysis-card:hover::before {
            left: 100%;
        }
        html[dir="rtl"] .analysis-card:hover::before {
            left: auto;
            right: 100%;
        }

        .analysis-card:hover {
            transform: translateZ(80px) rotateY(5deg);
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        html[dir="rtl"] .analysis-card:hover {
            transform: translateZ(80px) rotateY(-5deg); /* Invert Y rotation for RTL */
        }


        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        html[dir="rtl"] .card-header {
            flex-direction: row-reverse; /* Icon on the right */
        }


        .card-icon {
            font-size: 2.5em;
            margin-right: 15px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        html[dir="rtl"] .card-icon {
            margin-right: 0;
            margin-left: 15px;
        }


        .input-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .input-options {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap; /* Allow wrapping on small screens */
        }

        .option-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option-btn.active {
            background: linear-gradient(45deg, #00c6ff, #0072ff);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .input-area {
            display: none;
        }

        .input-area.active {
            display: block;
        }

        .text-input, .focus-input {
            width: 100%;
            min-height: 120px;
            background: rgba(0, 0, 0, 0.2); /* Darker input */
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            padding: 15px;
            font-size: 16px;
            resize: vertical;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
        }
        html[dir="rtl"] .text-input, html[dir="rtl"] .focus-input {
            text-align: right;
        }

        .text-input::placeholder, .focus-input::placeholder {
            color: rgba(255, 255, 255, 0.5); /* Lighter placeholder */
        }
        html[dir="rtl"] .text-input::placeholder, html[dir="rtl"] .focus-input::placeholder {
            text-align: right;
        }


        .focus-input {
            height: 80px;
            font-size: 14px;
            margin-top: 10px;
        }

        .file-upload-area { /* Wrapper for file input and status */
             margin-bottom: 15px;
        }

        .file-upload {
            width: 100%;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2); /* Darker upload area */
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            background: rgba(0, 0, 0, 0.3);
            border-color: rgba(0, 198, 255, 0.7);
        }

        .file-upload input {
            display: none;
        }
        
        .file-status-display {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top:10px;
        }
        .file-status-display p {
            margin-bottom: 5px;
        }
        .file-status-display .file-name {
            font-weight: bold;
            color: #00c6ff;
        }
        .file-status-display .file-preview {
            font-size: 0.9em;
            opacity: 0.8;
            max-height: 60px;
            overflow-y: auto;
            background: rgba(0,0,0,0.2);
            padding: 5px;
            border-radius: 5px;
            margin-top:5px;
            border: 1px solid rgba(255,255,255,0.1);
        }


        .gemini-integration {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 25px;
            padding: 40px;
            margin: 40px 0;
            transform: translateZ(60px);
            box-shadow: 0 30px 60px rgba(102, 126, 234, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .gemini-chat {
            background: rgba(0,0,0, 0.2); /* Darker chat */
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            min-height: 400px;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.3);
        }
        html[dir="rtl"] .gemini-chat p {
            text-align: right;
        }
        
        .gemini-chat p {
            margin-bottom: 15px;
            line-height: 1.7;
        }
        .gemini-chat p strong { /* User/AI Name */
            color: #00c6ff;
            display: block;
            margin-bottom: 3px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .input-group input {
            flex: 1;
            min-width: 200px;
            padding: 15px;
            background: rgba(0,0,0, 0.3); /* Darker input */
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: white;
            font-size: 16px;
        }
        html[dir="rtl"] .input-group input {
            text-align: right;
        }


        .input-group input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        html[dir="rtl"] .input-group input::placeholder {
            text-align: right;
        }

        .btn {
            padding: 15px 25px;
            background: linear-gradient(45deg, #00c6ff, #0072ff);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            transform: translateZ(10px);
            white-space: nowrap;
            margin: 5px; /* Added for wrap spacing */
        }

        .btn:hover {
            transform: translateZ(20px) scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 114, 255, 0.4);
        }

        .export-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            font-size: 12px;
            padding: 10px 15px;
        }

        .export-btn:hover {
            box-shadow: 0 10px 20px rgba(40, 167, 69, 0.4);
        }

        .chart-container {
            background: rgba(0,0,0,0.15); /* Darker chart bg */
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            transform: translateZ(30px);
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.2);
            height: 300px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transform: translateZ(40px);
            transition: all 0.4s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-card:hover {
            transform: translateZ(60px) scale(1.05);
            background: rgba(255, 255, 255, 0.15);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 10px 0;
        }

        .recommendations { /* This class was present but not used in HTML. Retaining for potential future use. */
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            color: #333;
            border-radius: 25px;
            padding: 40px;
            margin: 40px 0;
            transform: translateZ(50px);
            box-shadow: 0 25px 50px rgba(255, 154, 158, 0.3);
        }
        html[dir="rtl"] .recommendations {
             text-align: right;
        }

        .solution-card {
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid rgba(76, 175, 80, 0.3);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            transform: translateZ(35px);
            transition: all 0.4s ease;
        }

        .solution-card:hover {
            transform: translateZ(55px);
            background: rgba(76, 175, 80, 0.2);
        }

        /* محسن - تصميم مخرجات النتائج */
        .results-section {
            background: rgba(10, 20, 30, 0.6); /* Darker, more distinct background */
            backdrop-filter: blur(30px); /* Increased blur */
            -webkit-backdrop-filter: blur(30px);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            border: 1px solid rgba(0, 198, 255, 0.4); /* Themed border */
            max-height: 700px; /* Consider increasing for desktop */
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5), inset 0 0 20px rgba(0, 198, 255, 0.15); /* Enhanced shadow */
            position: relative;
        }

        .results-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px; /* Thicker highlight bar */
            background: linear-gradient(90deg, #00c6ff, #0072ff, #ff6b6b);
            border-radius: 20px 20px 0 0;
        }
        html[dir="rtl"] .results-section::before {
            background: linear-gradient(-90deg, #00c6ff, #0072ff, #ff6b6b); /* Invert gradient for RTL */
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px; /* Increased margin */
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(0, 198, 255, 0.25); /* Themed border */
            flex-wrap: wrap;
            gap: 15px;
        }
        html[dir="rtl"] .results-header {
            flex-direction: row-reverse; /* Ensure controls are on the left */
        }


        .results-header h4 {
            font-size: 1.8em; /* Larger title */
            background: linear-gradient(45deg, #00c6ff, #4ecdc4);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 12px rgba(0, 198, 255, 0.6); /* Enhanced text shadow */
        }

        .export-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .api-status {
            position: fixed;
            top: 20px;
            right: 20px; 
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        html[dir="rtl"] .api-status {
            right: auto;
            left: 20px; 
        }

        .api-connected {
            background: rgba(76, 175, 80, 0.9);
            color: white;
        }

        .api-disconnected {
            background: rgba(244, 67, 54, 0.9);
            color: white;
        }

        .status-messages {
            background: rgba(0,0,0, 0.2); /* Darker status messages */
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            font-size: 14px;
            display: none;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        html[dir="rtl"] .status-messages {
            text-align: right;
        }


        .status-step {
            margin: 8px 0;
            opacity: 0.7;
            transition: all 0.3s ease;
            padding: 5px 0;
        }

        .status-step.active {
            opacity: 1;
            color: #00c6ff;
            font-weight: bold;
        }

        /* تحسين تنسيق المحتوى */
        .formatted-content {
            line-height: 1.8;
            font-size: 16px; /* Slightly larger base font for results */
        }
        html[dir="rtl"] .formatted-content {
            text-align: right;
        }

        .formatted-content h1 {
            color: #00c6ff;
            font-size: 2em; /* Larger H1 */
            margin: 30px 0 20px 0;
            padding: 15px 0;
            border-bottom: 2px solid rgba(0, 198, 255, 0.4);
            background: linear-gradient(45deg, #00c6ff, #4ecdc4);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 8px rgba(0, 198, 255, 0.3);
        }

        .formatted-content h2 {
            color: #4cecbc; /* Brighter H2 */
            font-size: 1.7em;
            margin: 25px 0 15px 0;
            padding: 12px 0 10px 0;
            border-left: 4px solid #4cecbc;
            padding-left: 15px;
        }
        html[dir="rtl"] .formatted-content h2 {
            border-left: none;
            border-right: 4px solid #4cecbc;
            padding-left: 0;
            padding-right: 15px;
        }


        .formatted-content h3 {
            color: #ff7b7b; /* Brighter H3 */
            font-size: 1.4em;
            margin: 20px 0 12px 0;
            padding: 10px 0;
        }

        .formatted-content h4 {
            color: #ffb74e; /* Brighter H4 */
            font-size: 1.2em;
            margin: 18px 0 10px 0;
        }

        .formatted-content ul, .formatted-content ol {
            margin: 18px 0;
            padding-left: 30px; /* More indent */
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 20px 30px; /* More padding inside list bg */
            border: 1px solid rgba(255,255,255,0.08);
        }
        html[dir="rtl"] .formatted-content ul, html[dir="rtl"] .formatted-content ol {
            padding-left: 0;
            padding-right: 30px;
        }


        .formatted-content li {
            margin: 10px 0; /* More spacing for li */
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .formatted-content li:last-child {
            border-bottom: none;
        }

        .formatted-content p {
            margin: 15px 0;
            text-align: justify; 
        }
        /* Removed empty ruleset: html[dir="rtl"] .formatted-content p */

        .formatted-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            background: rgba(0, 0, 0, 0.15); /* Darker table */
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .formatted-content th, .formatted-content td {
            border: 1px solid rgba(255, 255, 255, 0.15); /* Slightly more visible border */
            padding: 14px 18px; /* More padding */
            text-align: left; 
        }
        html[dir="rtl"] .formatted-content th, html[dir="rtl"] .formatted-content td {
            text-align: right;
        }

        .formatted-content th {
            background: rgba(0, 198, 255, 0.25); /* More prominent th */
            font-weight: bold;
            color: #00e0ff; /* Brighter th text */
        }

        .formatted-content td {
            background: rgba(255, 255, 255, 0.03); /* Slightly lighter td for contrast */
        }

        .formatted-content strong {
            color: #5effd1; /* Brighter strong */
            font-weight: bold;
        }

        .formatted-content em {
            color: #ff8b8b; /* Brighter em */
            font-style: italic;
        }

        .formatted-content blockquote {
            background: rgba(0, 0, 0, 0.1); /* Darker blockquote */
            border-left: 5px solid #00c6ff; 
            margin: 20px 0;
            padding: 20px 25px;
            border-radius: 0 10px 10px 0; 
            font-style: italic;
            box-shadow: inset 3px 0 8px rgba(0,0,0,0.2);
        }
        html[dir="rtl"] .formatted-content blockquote {
            border-left: none;
            border-right: 5px solid #00c6ff;
            border-radius: 10px 0 0 10px;
        }

        /* تحسين بطاقات النتائج المتخصصة */
        .analysis-result-card { /* Main container for a "section" of results */
            background: rgba(255, 255, 255, 0.04); /* Slightly lighter than section bg */
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.12);
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .analysis-result-card:hover {
            background: rgba(255, 255, 255, 0.07);
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .analysis-result-card h2, .analysis-result-card h3 { /* Titles within result cards */
            margin-top: 0; /* Remove default top margin for titles inside these cards */
            border-left: none; /* Remove default h2 border if it's inside */
            padding-left: 0;
        }
        html[dir="rtl"] .analysis-result-card h2, html[dir="rtl"] .analysis-result-card h3 {
            border-right: none;
            padding-right: 0;
        }


        .result-icon { /* Generic icon styling if needed */
            font-size: 2em;
            margin-bottom: 10px;
            display: block;
            color: #00c6ff; /* Example color */
        }

        .metric-card {
            background: linear-gradient(135deg, rgba(0, 198, 255, 0.15), rgba(76, 236, 196, 0.15)); /* Slightly stronger gradient */
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0; /* Increased margin */
            text-align: center;
            border: 1px solid rgba(0, 198, 255, 0.3); /* More visible border */
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .metric-value {
            font-size: 2.4em; /* Slightly larger */
            font-weight: bold;
            color: #00d2ff; /* Brighter */
            margin: 10px 0;
        }

        .metric-label {
            font-size: 1em; /* Larger label */
            opacity: 0.85;
            margin-top: 8px;
        }

        .quality-indicator {
            display: inline-block;
            padding: 6px 14px; /* More padding */
            border-radius: 20px;
            font-size: 0.9em; /* Slightly larger */
            font-weight: bold;
            margin: 5px; /* More margin */
            text-transform: uppercase; /* Make it stand out */
            letter-spacing: 0.5px;
        }

        .quality-excellent {
            background: rgba(76, 175, 80, 0.3);
            color: #66bb6a; /* Brighter green */
            border: 1px solid #66bb6a;
        }

        .quality-good {
            background: rgba(76, 236, 196, 0.3);
            color: #50e1c2; /* Brighter teal */
            border: 1px solid #50e1c2;
        }

        .quality-warning {
            background: rgba(255, 167, 38, 0.3);
            color: #ffb74d; /* Brighter orange */
            border: 1px solid #ffb74d;
        }

        .quality-critical {
            background: rgba(244, 67, 54, 0.3);
            color: #ef5350; /* Brighter red */
            border: 1px solid #ef5350;
        }

        .recommendation-box, .warning-box, .critical-box {
            border-left: 5px solid #4caf50; /* Thicker border */
            border-radius: 0 10px 10px 0;  
            padding: 25px; /* More padding */
            margin: 25px 0; /* More margin */
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        html[dir="rtl"] .recommendation-box, html[dir="rtl"] .warning-box, html[dir="rtl"] .critical-box {
            border-left: none;
            border-radius: 10px 0 0 10px;
            text-align: right;
        }

        .recommendation-box {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(139, 195, 74, 0.15));
            border-left-color: #4caf50;
        }
        html[dir="rtl"] .recommendation-box { border-right: 5px solid #4caf50; }


        .warning-box {
            background: linear-gradient(135deg, rgba(255, 167, 38, 0.15), rgba(255, 193, 7, 0.15));
            border-left-color: #ffa726;
        }
        html[dir="rtl"] .warning-box { border-right: 5px solid #ffa726; }

        .critical-box {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.15), rgba(229, 57, 53, 0.15));
            border-left-color: #f44336;
        }
        html[dir="rtl"] .critical-box { border-right: 5px solid #f44336; }

        .recommendation-box h4, .warning-box h4, .critical-box h4 {
            margin-top:0;
            margin-bottom: 10px;
            font-size: 1.3em;
        }
        .recommendation-box h4 { color: #4caf50; }
        .warning-box h4 { color: #ffa726; }
        .critical-box h4 { color: #f44336; }

        /* تحسين للهواتف المحمولة */
        @media (max-width: 768px) {
            .language-switcher {
                top: 10px;
                left: 10px;
                flex-wrap: wrap; /* Added for safety */
            }
            html[dir="rtl"] .language-switcher {
                left: auto;
                right: 10px;
            }
            .header {
                padding-top: 70px; /* More space if lang switcher wraps */
            }

            .container {
                padding: 10px; /* Slightly more padding */
            }
            .analysis-grid {
                grid-template-columns: 1fr;
            }
            .header h1 {
                font-size: 2.2em; /* Slightly larger for tablets */
            }
            
            .input-group {
                flex-direction: column;
                gap: 8px; /* Increased gap */
            }
            .navigation {
                gap: 8px; /* Increased gap */
            }
            .nav-btn {
                padding: 10px 18px; /* Slightly larger */
                font-size: 13px;
            }
            .input-options {
                flex-direction: column;
                gap: 10px;
            }
            .results-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            html[dir="rtl"] .results-header {
                align-items: flex-end;
            }
            .export-controls {
                width: 100%;
                justify-content: flex-start;
            }
            html[dir="rtl"] .export-controls {
                justify-content: flex-end;
            }
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); /* Larger minmax */
                gap: 10px;
            }
            .stat-value {
                font-size: 1.5em;
            }
            .formatted-content {
                font-size: 14px; /* Base for mobile */
            }
            .formatted-content h1 { font-size: 1.5em; }
            .formatted-content h2 { font-size: 1.3em; }
            .formatted-content h3 { font-size: 1.2em; }
            .formatted-content h4 { font-size: 1.1em; }

            .formatted-content table {
                font-size: 12px; /* Slightly larger table font */
            }
            .formatted-content th, .formatted-content td {
                padding: 8px 10px;
            }
            .metric-value {
                font-size: 1.8em; /* Larger metric value */
            }
            .results-section {
                max-height: 450px; /* Increased max-height */
                padding: 15px;
            }
            .api-status {
                position: relative; 
                top: auto; right: auto; left: auto;
                margin: 10px auto; 
                display: block;
                text-align: center;
                font-size: 13px;
                padding: 8px 12px;
                width: fit-content;
            }
            
            .card-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px; /* Increased gap */
            }
            html[dir="rtl"] .card-header {
                align-items: flex-end;
            }
            .analysis-card, .section-card { 
                padding: 20px; /* More padding */
            }
            .gemini-integration { padding: 25px; }
            .gemini-chat { min-height: 300px; max-height: 400px;}
        }

        /* تحسين للشاشات الصغيرة جداً */
        @media (max-width: 480px) {
             .language-switcher {
                top: 8px; /* More space */
                left: 8px;
                gap: 5px;
            }
            html[dir="rtl"] .language-switcher {
                left: auto;
                right: 8px;
            }
            .lang-btn {
                padding: 6px 12px; /* Slightly larger */
                font-size: 11px;
            }
            .header {
                padding-top: 60px; /* Adjust if lang switcher wraps */
            }

            .container {
                padding: 5px;
            }
            
            .header h1 {
                font-size: 1.8em; /* Readable size */
            }
             .header h2 { font-size: 1em; }
             .header p { font-size: 0.85em; }

            .nav-btn {
                padding: 8px 12px;
                font-size: 11px;
            }
            .analysis-card, .section-card {
                padding: 15px;
            }
            .input-section {
                padding: 10px;
            }
            .text-input, .focus-input {
                font-size: 13px;
                padding: 10px;
                min-height: 100px;
            }
            .focus-input { height: 70px; }
            .btn {
                padding: 10px 15px;
                font-size: 12px;
            }
            .results-section {
                padding: 10px;
                max-height: 350px; /* Increased */
            }
            .formatted-content ul, .formatted-content ol {
                padding: 10px 15px;
            }
            html[dir="rtl"] .formatted-content ul, html[dir="rtl"] .formatted-content ol {
                padding-left: 15px; 
                padding-right: 15px;
            }

            .stats-grid {
                grid-template-columns: 1fr; /* Single column for very small */
            }
            .stat-card { padding: 15px; }
            .stat-value { font-size: 1.8em; }

            .formatted-content { font-size: 13px; }
            .formatted-content h1 { font-size: 1.3em; }
            .formatted-content h2 { font-size: 1.15em; }
            .formatted-content h3 { font-size: 1.05em; }
            .formatted-content h4 { font-size: 1em; }
            .chart-container { height: 220px; padding: 10px;}
        }

        .floating-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .floating-element {
            position: absolute;
            background: rgba(255, 255, 255, 0.07); /* Slightly less visible */
            border-radius: 50%;
            animation: floatAround 20s infinite linear;
        }

        @keyframes floatAround {
            0% { transform: translateY(100vh) rotate(0deg) scale(0.8); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100px) rotate(360deg) scale(1.2); opacity: 0; }
        }

        .section-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            transform: translateZ(40px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.6s ease;
        }

        .section-card:hover {
            transform: translateZ(60px) scale(1.01); /* Subtle scale */
        }

        .results-section::-webkit-scrollbar { width: 10px; }
        .results-section::-webkit-scrollbar-track {
            background: rgba(0,0,0, 0.2);
            border-radius: 10px;
        }
        .results-section::-webkit-scrollbar-thumb {
            background: linear-gradient(0deg, #0072ff, #00c6ff); /* Vertical gradient */
            border-radius: 10px;
        }
        .results-section::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(0deg, #00c6ff, #0072ff);
        }
        
        .gemini-chat::-webkit-scrollbar { width: 8px; }
        .gemini-chat::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); border-radius: 10px; }
        .gemini-chat::-webkit-scrollbar-thumb { background: rgba(0, 198, 255, 0.5); border-radius: 10px; }
        .gemini-chat::-webkit-scrollbar-thumb:hover { background: rgba(0, 198, 255, 0.8); }


        .loading-enhanced {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 12px 18px; /* Adjusted padding */
            background: rgba(0, 198, 255, 0.15); /* Slightly more visible */
            border-radius: 10px;
            border: 1px solid rgba(0, 198, 255, 0.4); /* Stronger border */
            color: #00c6ff; /* Text color match */
            font-weight: 500;
        }

        .loading-dots {
            display: flex;
            gap: 5px; /* Increased gap */
        }

        .loading-dot {
            width: 10px; /* Larger dots */
            height: 10px;
            background: #00c6ff;
            border-radius: 50%;
            animation: loadingDots 1.4s infinite ease-in-out; /* Smoother animation */
        }

        .loading-dot:nth-child(2) { animation-delay: 0.2s; }
        .loading-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes loadingDots {
            0%, 80%, 100% { opacity: 0.4; transform: scale(0.7); }
            40% { opacity: 1; transform: scale(1.1); } /* More pronounced scale */
        }

        .input-guidance-note {
            font-size: 0.9em;
            color: #b0e0e6; /* Light cyan */
            background-color: rgba(0, 198, 255, 0.08); 
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 10px; 
            margin-bottom: 20px; 
            border: 1px solid rgba(0, 198, 255, 0.2);
            line-height: 1.5;
        }
        html[dir="rtl"] .input-guidance-note {
            text-align: right;
        }
    </style>
</head>
<body>
    <div class="language-switcher">
        <button id="lang-en" class="lang-btn" onclick="setLanguage('en')">English</button>
        <button id="lang-ar" class="lang-btn" onclick="setLanguage('ar')">العربية</button>
    </div>

    <div id="apiStatus" class="api-status api-disconnected">
        <span data-translate-key="apiStatusDisconnected">🔴 Not connected to Yazeed AI API</span>
    </div>

    <div class="floating-elements">
        <div class="floating-element" style="left: 10%; width: 60px; height: 60px; animation-delay: 0s; animation-duration: 25s;"></div>
        <div class="floating-element" style="left: 25%; width: 35px; height: 35px; animation-delay: 6s; animation-duration: 18s;"></div>
        <div class="floating-element" style="left: 75%; width: 50px; height: 50px; animation-delay: 12s; animation-duration: 30s;"></div>
        <div class="floating-element" style="left: 85%; width: 30px; height: 30px; animation-delay: 18s; animation-duration: 22s;"></div>
        <div class="floating-element" style="left: 50%; width: 45px; height: 45px; animation-delay: 3s; animation-duration: 20s;"></div>
    </div>

    <div class="container">
        <div class="header">
            <h1 data-translate-key="mainTitle">🔍 Smart Business Analytics</h1>
            <h2 data-translate-key="companyNameHeader">Saudi Mais Co. Medical Products</h2>
            <p data-translate-key="headerSubtitle">Advanced AI-powered analysis system for financial crisis resolution</p>
        </div>

        <div class="navigation">
            <button class="nav-btn active" onclick="showSection('overview')" data-translate-key="navOverview">🏠 Overview</button>
            <button class="nav-btn" onclick="showSection('advanced-analysis')" data-translate-key="navAdvancedAnalysis">📊 Advanced Analysis</button>
            <button class="nav-btn" onclick="showSection('quality-management')" data-translate-key="navQualityManagement">🏥 Quality Management</button>
            <button class="nav-btn" onclick="showSection('demand-forecasting')" data-translate-key="navDemandForecasting">📈 Demand Forecasting</button>
            <button class="nav-btn" onclick="showSection('competitor-analysis')" data-translate-key="navCompetitorAnalysis">🎯 Competitor Analysis</button>
            <button class="nav-btn" onclick="showSection('ai-chat')" data-translate-key="navAiAssistant">🤖 AI Assistant</button>
        </div>

        <!-- Overview -->
        <div id="overview" class="section active">
            <div class="company-info">
                <h3 data-translate-key="companyInfoTitle">📋 Company Information</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">1994</div>
                        <p data-translate-key="yearFounded">Year Founded</p>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" data-translate-key="riyadh">Riyadh</div>
                        <p data-translate-key="headquarters">Headquarters</p>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" data-translate-key="medical">Medical</div>
                        <p data-translate-key="specializedProducts">Specialized Products</p>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" data-translate-key="middleEast">Middle East</div>
                        <p data-translate-key="targetMarket">Target Market</p>
                    </div>
                </div>
                <p data-translate-key="overviewCompanyDesc" style="text-align: center; margin-top: 20px; opacity: 0.9;">Saudi Mais Co. is a leading provider of medical products, committed to enhancing healthcare standards in the region through innovation and quality.</p>
            </div>

            <!-- Crisis Indicator Removed -->

            <div class="analysis-grid">
                <div class="analysis-card">
                    <div class="card-header">
                        <span class="card-icon">📊</span>
                        <h3 data-translate-key="marketAnalysisTitle">Market Analysis</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="marketChart"></canvas>
                    </div>
                </div>

                <div class="analysis-card">
                    <div class="card-header">
                        <span class="card-icon">💰</span>
                        <h3 data-translate-key="financialAnalysisTitle">Financial Analysis</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="financialChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Analysis -->
        <div id="advanced-analysis" class="section">
            <div class="section-card">
                <div class="card-header">
                    <span class="card-icon">📊</span>
                    <h3 data-translate-key="advancedAnalyticsSystemTitle">Advanced Data Analytics System</h3>
                </div>
                <p data-translate-key="advancedAnalyticsSystemDesc">Comprehensive analysis of market trends and operational performance with strategic recommendations</p>
                
                <div class="input-section">
                    <div class="input-options">
                        <button class="option-btn active" onclick="toggleInputMode('advanced', 'text')" data-translate-key="textInputBtn">📝 Text Input</button>
                        <button class="option-btn" onclick="toggleInputMode('advanced', 'file')" data-translate-key="fileUploadBtn">📁 File Upload</button>
                    </div>
                    <p class="input-guidance-note" data-translate-key="guidanceAdvancedAnalysis"></p>
                    
                    <div id="advanced-text" class="input-area active">
                        <textarea id="advancedTextInput" class="text-input" data-translate-key="advancedTextInputPlaceholder" placeholder="Enter company data for advanced analysis (financial data, sales, production, etc...)"></textarea>
                        <textarea id="advancedFocusInput" class="focus-input" data-translate-key="advancedFocusInputPlaceholder" placeholder="Specific focus areas or questions (e.g., 'Analyze competitor impact in respiratory products sector', 'Evaluate new regulation effects')"></textarea>
                    </div>
                    
                    <div id="advanced-file" class="input-area">
                        <div class="file-upload-area">
                            <div class="file-upload" onclick="document.getElementById('advancedFileInput').click()">
                                <p data-translate-key="dragFileHere">📁 Drag file here or click to select</p>
                                <p style="font-size: 14px; opacity: 0.7;" data-translate-key="supportedFileTypes">Supports: Excel, CSV, PDF, Word, TXT</p>
                                <input type="file" id="advancedFileInput" accept=".xlsx,.xls,.csv,.pdf,.doc,.docx,.txt" onchange="handleFileUpload('advanced', this)">
                            </div>
                            <div id="advancedFileStatus" class="file-status-display" style="display:none;"></div>
                        </div>
                        <textarea id="advancedFocusInputFile" class="focus-input" data-translate-key="advancedFocusInputFilePlaceholder" placeholder="Specific focus areas for file analysis"></textarea>
                    </div>
                    
                    <button class="btn" onclick="startAdvancedAnalysis()" data-translate-key="startAdvancedAnalysisBtn">🚀 Start Advanced Analysis</button>
                </div>
                
                <div id="advancedStatus" class="status-messages">
                    <div class="status-step" id="advancedStep1" data-translate-key="advancedStep1Text">📄 Processing input/file...</div>
                    <div class="status-step" id="advancedStep2" data-translate-key="advancedStep2Text">🔄 Sending data to Yazeed AI...</div>
                    <div class="status-step" id="advancedStep3" data-translate-key="advancedStep3Text">🧠 AI analysis in progress...</div>
                    <div class="status-step" id="advancedStep4" data-translate-key="advancedStep4Text">📊 Formatting results...</div>
                </div>
                
                <div id="advancedResults" class="results-section" style="display: none;">
                    <div class="results-header">
                        <h4 data-translate-key="advancedAnalysisResultsTitle">📊 Advanced Analysis Results</h4>
                        <div class="export-controls">
                            <button class="btn export-btn" onclick="exportResults('advanced', 'txt')" data-translate-key="exportTxtBtn">📄 Export TXT</button>
                            <button class="btn export-btn" onclick="exportResults('advanced', 'md')" data-translate-key="exportMdBtn">📝 Export MD</button>
                            <button class="btn export-btn" onclick="exportResults('advanced', 'pdf')" data-translate-key="exportPdfBtn">📑 Export PDF</button>
                        </div>
                    </div>
                    <div id="advancedAnalysisContent" class="formatted-content"></div>
                </div>
            </div>
        </div>

        <!-- Quality Management -->
        <div id="quality-management" class="section">
            <div class="section-card">
                <div class="card-header">
                    <span class="card-icon">🏥</span>
                    <h3 data-translate-key="qualityManagementSystemTitle">Smart Quality Management System</h3>
                </div>
                <p data-translate-key="qualityManagementSystemDesc">Quality monitoring according to international standards ISO 13485 and FDA requirements</p>
                
                <div class="input-section">
                     <div class="input-options">
                        <button class="option-btn active" onclick="toggleInputMode('quality', 'text')" data-translate-key="textInputBtn">📝 Text Input</button>
                        <button class="option-btn" onclick="toggleInputMode('quality', 'file')" data-translate-key="fileUploadBtn">📁 File Upload</button>
                    </div>
                    <p class="input-guidance-note" data-translate-key="guidanceQualityManagement"></p>
                    
                    <div id="quality-text" class="input-area active">
                        <textarea id="qualityTextInput" class="text-input" data-translate-key="qualityTextInputPlaceholder" placeholder="Enter quality data (production defects, customer complaints, test results, etc...)"></textarea>
                        <textarea id="qualityFocusInput" class="focus-input" data-translate-key="qualityFocusInputPlaceholder" placeholder="Quality focus areas (e.g., 'ISO compliance assessment', 'Customer satisfaction analysis')"></textarea>
                    </div>
                    
                    <div id="quality-file" class="input-area">
                        <div class="file-upload-area">
                            <div class="file-upload" onclick="document.getElementById('qualityFileInput').click()">
                                <p data-translate-key="dragQualityFile">📁 Drag quality data file here</p>
                                <p style="font-size: 14px; opacity: 0.7;" data-translate-key="qualityFileTypes">Quality reports, inspection records, customer complaints</p>
                                <input type="file" id="qualityFileInput" accept=".xlsx,.xls,.csv,.pdf,.doc,.docx,.txt" onchange="handleFileUpload('quality', this)">
                            </div>
                            <div id="qualityFileStatus" class="file-status-display" style="display:none;"></div>
                        </div>
                        <textarea id="qualityFocusInputFile" class="focus-input" data-translate-key="qualityFocusInputFilePlaceholder" placeholder="Quality analysis focus areas"></textarea>
                    </div>
                    
                    <button class="btn" onclick="startQualityAnalysis()" data-translate-key="analyzeQualityBtn">🔍 Analyze Quality</button>
                </div>
                
                <div id="qualityStatus" class="status-messages">
                    <div class="status-step" id="qualityStep1" data-translate-key="qualityStep1Text">📄 Reading quality data...</div>
                    <div class="status-step" id="qualityStep2" data-translate-key="qualityStep2Text">🔄 Sending to AI analysis...</div>
                    <div class="status-step" id="qualityStep3" data-translate-key="qualityStep3Text">🏥 Quality assessment in progress...</div>
                    <div class="status-step" id="qualityStep4" data-translate-key="qualityStep4Text">📊 Generating quality report...</div>
                </div>
                
                <div id="qualityResults" class="results-section" style="display: none;">
                    <div class="results-header">
                        <h4 data-translate-key="qualityAnalysisResultsTitle">🏥 Quality Analysis Results</h4>
                        <div class="export-controls">
                            <button class="btn export-btn" onclick="exportResults('quality', 'txt')" data-translate-key="exportTxtBtn">📄 Export TXT</button>
                            <button class="btn export-btn" onclick="exportResults('quality', 'md')" data-translate-key="exportMdBtn">📝 Export MD</button>
                            <button class="btn export-btn" onclick="exportResults('quality', 'pdf')" data-translate-key="exportPdfBtn">📑 Export PDF</button>
                        </div>
                    </div>
                    <div id="qualityAnalysisContent" class="formatted-content"></div>
                </div>
            </div>
        </div>

        <!-- Demand Forecasting -->
        <div id="demand-forecasting" class="section">
            <div class="section-card">
                <div class="card-header">
                    <span class="card-icon">📈</span>
                    <h3 data-translate-key="demandForecastingSystemTitle">Demand Forecasting & Inventory System</h3>
                </div>
                <p data-translate-key="demandForecastingSystemDesc">Predict future demand and optimize inventory levels using artificial intelligence</p>
                
                <div class="input-section">
                    <div class="input-options">
                        <button class="option-btn active" onclick="toggleInputMode('demand', 'text')" data-translate-key="textInputBtn">📝 Text Input</button>
                        <button class="option-btn" onclick="toggleInputMode('demand', 'file')" data-translate-key="fileUploadBtn">📁 File Upload</button>
                    </div>
                    <p class="input-guidance-note" data-translate-key="guidanceDemandForecasting"></p>
                    
                    <div id="demand-text" class="input-area active">
                        <textarea id="demandTextInput" class="text-input" data-translate-key="demandTextInputPlaceholder" placeholder="Enter historical sales and inventory data (periods, quantities, seasons, etc...)"></textarea>
                        <textarea id="demandFocusInput" class="focus-input" data-translate-key="demandFocusInputPlaceholder" placeholder="Forecasting focus (e.g., 'Q4 seasonal trends', 'New product demand projection')"></textarea>
                    </div>
                    
                    <div id="demand-file" class="input-area">
                        <div class="file-upload-area">
                            <div class="file-upload" onclick="document.getElementById('demandFileInput').click()">
                                <p data-translate-key="dragDemandFile">📁 Drag sales and inventory data file</p>
                                <p style="font-size: 14px; opacity: 0.7;" data-translate-key="demandFileTypes">Historical sales data, inventory levels</p>
                                <input type="file" id="demandFileInput" accept=".xlsx,.xls,.csv,.pdf,.doc,.docx,.txt" onchange="handleFileUpload('demand', this)">
                            </div>
                            <div id="demandFileStatus" class="file-status-display" style="display:none;"></div>
                        </div>
                        <textarea id="demandFocusInputFile" class="focus-input" data-translate-key="demandFocusInputFilePlaceholder" placeholder="Demand forecasting focus areas"></textarea>
                    </div>
                    
                    <button class="btn" onclick="startDemandForecasting()" data-translate-key="forecastDemandBtn">📊 Forecast Demand</button>
                </div>
                
                <div id="demandStatus" class="status-messages">
                    <div class="status-step" id="demandStep1" data-translate-key="demandStep1Text">📄 Processing historical data...</div>
                    <div class="status-step" id="demandStep2" data-translate-key="demandStep2Text">🔄 AI model preparation...</div>
                    <div class="status-step" id="demandStep3" data-translate-key="demandStep3Text">📈 Generating forecasts...</div>
                    <div class="status-step" id="demandStep4" data-translate-key="demandStep4Text">📊 Creating inventory recommendations...</div>
                </div>
                
                <div id="demandResults" class="results-section" style="display: none;">
                    <div class="results-header">
                        <h4 data-translate-key="demandForecastingResultsTitle">📈 Demand Forecasting Results</h4>
                        <div class="export-controls">
                            <button class="btn export-btn" onclick="exportResults('demand', 'txt')" data-translate-key="exportTxtBtn">📄 Export TXT</button>
                            <button class="btn export-btn" onclick="exportResults('demand', 'md')" data-translate-key="exportMdBtn">📝 Export MD</button>
                            <button class="btn export-btn" onclick="exportResults('demand', 'pdf')" data-translate-key="exportPdfBtn">📑 Export PDF</button>
                        </div>
                    </div>
                    <div id="demandAnalysisContent" class="formatted-content"></div>
                </div>
            </div>
        </div>
        
        <!-- Competitor Analysis -->
        <div id="competitor-analysis" class="section">
            <div class="section-card">
                <div class="card-header">
                    <span class="card-icon">🎯</span>
                    <h3 data-translate-key="competitorAnalysisSystemTitle">Competitor Analysis System</h3>
                </div>
                <p data-translate-key="competitorAnalysisSystemDesc">Comprehensive competitive analysis in the medical equipment market and strategic opportunity identification</p>
                
                <div class="input-section">
                    <div class="input-options">
                        <button class="option-btn active" onclick="toggleInputMode('competitor', 'text')" data-translate-key="textInputBtn">📝 Text Input</button>
                        <button class="option-btn" onclick="toggleInputMode('competitor', 'file')" data-translate-key="fileUploadBtn">📁 File Upload</button>
                    </div>
                    <p class="input-guidance-note" data-translate-key="guidanceCompetitorAnalysis"></p>
                    
                    <div id="competitor-text" class="input-area active">
                        <textarea id="competitorTextInput" class="text-input" data-translate-key="competitorTextInputPlaceholder" placeholder="Enter competitor data (company names, prices, services, strengths and weaknesses, etc...)"></textarea>
                        <textarea id="competitorFocusInput" class="focus-input" data-translate-key="competitorFocusInputPlaceholder" placeholder="Competitive analysis focus (e.g., 'Pricing strategy comparison', 'Market positioning analysis')"></textarea>
                    </div>
                    
                    <div id="competitor-file" class="input-area">
                        <div class="file-upload-area">
                            <div class="file-upload" onclick="document.getElementById('competitorFileInput').click()">
                                <p data-translate-key="dragCompetitorFile">📁 Drag competitor data file</p>
                                <p style="font-size: 14px; opacity: 0.7;" data-translate-key="competitorFileTypes">Market reports, competitor information, comparison studies</p>
                                <input type="file" id="competitorFileInput" accept=".xlsx,.xls,.csv,.pdf,.doc,.docx,.txt" onchange="handleFileUpload('competitor', this)">
                            </div>
                            <div id="competitorFileStatus" class="file-status-display" style="display:none;"></div>
                        </div>
                        <textarea id="competitorFocusInputFile" class="focus-input" data-translate-key="competitorFocusInputFilePlaceholder" placeholder="Competitor analysis focus areas"></textarea>
                    </div>
                    
                    <button class="btn" onclick="startCompetitorAnalysis()" data-translate-key="analyzeCompetitionBtn">🔎 Analyze Competition</button>
                </div>
                
                <div id="competitorStatus" class="status-messages">
                    <div class="status-step" id="competitorStep1" data-translate-key="competitorStep1Text">📄 Processing competitor data...</div>
                    <div class="status-step" id="competitorStep2" data-translate-key="competitorStep2Text">🔄 Market analysis in progress...</div>
                    <div class="status-step" id="competitorStep3" data-translate-key="competitorStep3Text">🎯 Competitive positioning analysis...</div>
                    <div class="status-step" id="competitorStep4" data-translate-key="competitorStep4Text">📊 Strategic recommendations generation...</div>
                </div>
                
                <div id="competitorResults" class="results-section" style="display: none;">
                    <div class="results-header">
                        <h4 data-translate-key="competitorAnalysisResultsTitle">🎯 Competitor Analysis Results</h4>
                        <div class="export-controls">
                            <button class="btn export-btn" onclick="exportResults('competitor', 'txt')" data-translate-key="exportTxtBtn">📄 Export TXT</button>
                            <button class="btn export-btn" onclick="exportResults('competitor', 'md')" data-translate-key="exportMdBtn">📝 Export MD</button>
                            <button class="btn export-btn" onclick="exportResults('competitor', 'pdf')" data-translate-key="exportPdfBtn">📑 Export PDF</button>
                        </div>
                    </div>
                    <div id="competitorAnalysisContent" class="formatted-content"></div>
                </div>
            </div>
        </div>

        <!-- AI Assistant -->
        <div id="ai-chat" class="section">
            <div class="gemini-integration">
                <h3 data-translate-key="aiAssistantTitle">🤖 Yazeed AI Smart Assistant</h3>
                <div class="gemini-chat" id="chatContainer">
                    <div id="chatMessages">
                        <p><strong data-translate-key="aiAssistantName">Yazeed AI:</strong> <span data-translate-key="aiWelcomeMessage">Welcome! I'm your smart assistant for analyzing Saudi Mais Co.'s situation. I'll provide comprehensive analysis of the financial situation and strategies for crisis recovery.</span></p>
                    </div>
                </div>
                <div class="input-group">
                    <input type="text" id="userInput" data-translate-key="aiChatInputPlaceholder" placeholder="Ask about financial analysis or recovery strategies...">
                    <button class="btn" onclick="sendMessage()" data-translate-key="sendBtn">Send</button>
                    <button class="btn" onclick="startComprehensiveAnalysis()" data-translate-key="comprehensiveAnalysisBtn">Comprehensive Analysis</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        // System variables
        let currentSection = 'overview';
        let uploadedFiles = {}; // Stores File objects
        let fileContents = {}; // Stores extracted text content from files
        let analysisHistory = {};
        let currentLanguage = localStorage.getItem('maisLang') || 'en';
        let marketChartInstance, financialChartInstance;


        const translations = {
            en: {
                pageTitle: "Smart Business Analytics - Saudi Mais Co",
                apiStatusConnected: "🟢 Connected to Yazeed AI API",
                apiStatusDisconnected: "🔴 Not connected to Yazeed AI API",
                mainTitle: "🔍 Smart Business Analytics",
                companyNameHeader: "Saudi Mais Co. Medical Products",
                headerSubtitle: "Advanced AI-powered analysis system for financial crisis resolution",
                navOverview: "🏠 Overview",
                navAdvancedAnalysis: "📊 Advanced Analysis",
                navQualityManagement: "🏥 Quality Management",
                navDemandForecasting: "📈 Demand Forecasting",
                navCompetitorAnalysis: "🎯 Competitor Analysis",
                navAiAssistant: "🤖 AI Assistant",
                companyInfoTitle: "📋 Company Information",
                yearFounded: "Year Founded",
                riyadh: "Riyadh",
                headquarters: "Headquarters",
                medical: "Medical",
                specializedProducts: "Specialized Products",
                middleEast: "Middle East",
                targetMarket: "Target Market",
                overviewCompanyDesc: "Saudi Mais Co. is a leading provider of medical products, committed to enhancing healthcare standards in the region through innovation and quality.",
                marketAnalysisTitle: "Market Analysis",
                financialAnalysisTitle: "Financial Analysis",
                advancedAnalyticsSystemTitle: "Advanced Data Analytics System",
                advancedAnalyticsSystemDesc: "Comprehensive analysis of market trends and operational performance with strategic recommendations for Saudi Mais Co.",
                textInputBtn: "📝 Text Input",
                fileUploadBtn: "📁 File Upload",
                guidanceAdvancedAnalysis: "*For best results, provide specific financial statements, sales figures, production data, and market reports. Clearly state your primary analysis goals or questions in the 'focus areas' field.*",
                advancedTextInputPlaceholder: "Enter company data for advanced analysis (financial data, sales, production, etc...) specific to Saudi Mais Co.",
                advancedFocusInputPlaceholder: "Specific focus areas for Saudi Mais Co. (e.g., 'Analyze competitor impact in respiratory products sector', 'Evaluate new regulation effects on Saudi Mais Co.')",
                dragFileHere: "📁 Drag file here or click to select",
                supportedFileTypes: "Supports: Excel, CSV, PDF, Word, TXT",
                advancedFocusInputFilePlaceholder: "Specific focus areas for file analysis related to Saudi Mais Co.",
                startAdvancedAnalysisBtn: "🚀 Start Advanced Analysis",
                advancedStep1Text: "📄 Processing input/file for Saudi Mais Co. analysis...",
                advancedStep2Text: "🔄 Sending data to Yazeed AI for Saudi Mais Co. context...",
                advancedStep3Text: "🧠 AI analysis for Saudi Mais Co. in progress...",
                advancedStep4Text: "📊 Formatting results for Saudi Mais Co...",
                advancedAnalysisResultsTitle: "📊 Advanced Analysis Results for Saudi Mais Co.",
                exportTxtBtn: "📄 Export TXT",
                exportMdBtn: "📝 Export MD",
                exportPdfBtn: "📑 Export PDF",
                qualityManagementSystemTitle: "Smart Quality Management System for Saudi Mais Co.",
                qualityManagementSystemDesc: "Quality monitoring according to international standards (ISO 13485) and FDA requirements for Saudi Mais Co.",
                guidanceQualityManagement: "*For optimal quality analysis, please include defect reports, customer complaint logs, audit findings (ISO 13485/SFDA), CAPA documentation, and relevant QMS procedures. Specify the quality standards or areas of concern in the 'focus areas'.*",
                qualityTextInputPlaceholder: "Enter quality data for Saudi Mais Co. (production defects, customer complaints, test results, etc...)",
                qualityFocusInputPlaceholder: "Quality focus areas for Saudi Mais Co. (e.g., 'ISO compliance assessment', 'Customer satisfaction analysis')",
                dragQualityFile: "📁 Drag quality data file here for Saudi Mais Co.",
                qualityFileTypes: "Quality reports, inspection records, customer complaints (Saudi Mais Co.)",
                qualityFocusInputFilePlaceholder: "Quality analysis focus areas from file for Saudi Mais Co.",
                analyzeQualityBtn: "🔍 Analyze Quality for Saudi Mais Co.",
                qualityStep1Text: "📄 Reading quality data for Saudi Mais Co....",
                qualityStep2Text: "🔄 Sending to AI for Saudi Mais Co. quality analysis...",
                qualityStep3Text: "🏥 Quality assessment for Saudi Mais Co. in progress...",
                qualityStep4Text: "📊 Generating quality report for Saudi Mais Co....",
                qualityAnalysisResultsTitle: "🏥 Quality Analysis Results for Saudi Mais Co.",
                demandForecastingSystemTitle: "Demand Forecasting & Inventory System for Saudi Mais Co.",
                demandForecastingSystemDesc: "Predict future demand and optimize inventory levels for Saudi Mais Co. using artificial intelligence",
                guidanceDemandForecasting: "*To achieve accurate demand forecasts, provide detailed historical sales data (by SKU/product, period), inventory levels, promotional activity logs, and any known market events or seasonality factors. Clearly define the forecasting horizon and specific products in the 'focus areas'.*",
                demandTextInputPlaceholder: "Enter historical sales and inventory data for Saudi Mais Co. (periods, quantities, seasons, etc...)",
                demandFocusInputPlaceholder: "Forecasting focus for Saudi Mais Co. (e.g., 'Q4 seasonal trends', 'New product demand projection')",
                dragDemandFile: "📁 Drag sales and inventory data file for Saudi Mais Co.",
                demandFileTypes: "Historical sales data, inventory levels (Saudi Mais Co.)",
                demandFocusInputFilePlaceholder: "Demand forecasting focus areas from file for Saudi Mais Co.",
                forecastDemandBtn: "📊 Forecast Demand for Saudi Mais Co.",
                demandStep1Text: "📄 Processing historical data for Saudi Mais Co....",
                demandStep2Text: "🔄 AI model preparation for Saudi Mais Co. demand...",
                demandStep3Text: "📈 Generating forecasts for Saudi Mais Co....",
                demandStep4Text: "📊 Creating inventory recommendations for Saudi Mais Co....",
                demandForecastingResultsTitle: "📈 Demand Forecasting Results for Saudi Mais Co.",
                competitorAnalysisSystemTitle: "Competitor Analysis System for Saudi Mais Co.",
                competitorAnalysisSystemDesc: "Comprehensive competitive analysis in the medical equipment market for Saudi Mais Co. and strategic opportunity identification",
                guidanceCompetitorAnalysis: "*For a comprehensive competitor analysis, list key competitors, their product offerings, pricing strategies (if known), market share estimates, and any available public reports or news. Specify the markets and product segments for comparison in the 'focus areas'.*",
                competitorTextInputPlaceholder: "Enter competitor data relevant to Saudi Mais Co. (company names, prices, services, strengths and weaknesses, etc...)",
                competitorFocusInputPlaceholder: "Competitive analysis focus for Saudi Mais Co. (e.g., 'Pricing strategy comparison', 'Market positioning analysis')",
                dragCompetitorFile: "📁 Drag competitor data file for Saudi Mais Co. analysis",
                competitorFileTypes: "Market reports, competitor information, comparison studies (Saudi Mais Co.)",
                competitorFocusInputFilePlaceholder: "Competitor analysis focus areas from file for Saudi Mais Co.",
                analyzeCompetitionBtn: "🔎 Analyze Competition for Saudi Mais Co.",
                competitorStep1Text: "📄 Processing competitor data for Saudi Mais Co. context...",
                competitorStep2Text: "🔄 Market analysis in progress for Saudi Mais Co....",
                competitorStep3Text: "🎯 Competitive positioning analysis for Saudi Mais Co....",
                competitorStep4Text: "📊 Strategic recommendations generation for Saudi Mais Co....",
                competitorAnalysisResultsTitle: "🎯 Competitor Analysis Results for Saudi Mais Co.",
                aiAssistantTitle: "🤖 Yazeed AI Smart Assistant for Saudi Mais Co.",
                aiAssistantName: "Yazeed AI (Saudi Mais Co. Specialist):",
                aiWelcomeMessage: "Welcome! I'm your smart assistant for analyzing Saudi Mais Co.'s situation. I specialize in providing comprehensive analysis of its financial situation and strategies for crisis recovery, leveraging its unique profile.",
                aiChatInputPlaceholder: "Ask about Saudi Mais Co. financial analysis or recovery strategies...",
                sendBtn: "Send",
                comprehensiveAnalysisBtn: "Comprehensive Analysis for Saudi Mais Co.",
                fileProcessingMessage: "Reading file:", 
                fileReadSuccessMessage: "✅ File ready:", 
                fileSizeLabel: "Size:",
                fileContentPreviewLabel: "Content preview (first 200 chars):",
                removeFileBtn: "🗑️ Remove File",
                fileReadError: "❌ Error reading file:",
                alertNoData: "Please enter data or upload a file for analysis related to Saudi Mais Co.",
                alertPdfExport: "PDF export feature requires an additional library. Exporting as text instead.",
                analysisFailedMsg: '<div class="critical-box"><h4>Analysis Failed</h4><p>Apologies, the analysis for Saudi Mais Co. could not be completed. Please check your input or try again later. If the problem persists, contact support.</p></div>',
                marketChartLabelCurrent: 'Current Status',
                marketChartLabelTarget: 'Future Target',
                marketChartLabels: ['Market Size', 'Growth', 'Competition', 'Quality', 'Price', 'Distribution'],
                financialChartLabelRevenue: 'Revenue (Million SAR)',
                financialChartLabelProfit: 'Profit (Million SAR)',
                financialChartLabels: ['2020', '2021', '2022', '2023', '2024', '2025 (Planned)'],
                loadingAnalysisText: "Analysis for Saudi Mais Co. in progress...",
                loadingQueryText: "Analyzing your query regarding Saudi Mais Co....",
                loadingComprehensiveAnalysisText: "Generating comprehensive business analysis for Saudi Mais Co....",
                comprehensiveAnalysisResultTitle: "Comprehensive Analysis for Saudi Mais Co.:",
                defaultFileName: "Uploaded File",
                simulatedDocxMessage: "Simulated DOCX content. Full parsing requires a dedicated library.",
                simulatedPdfMessage: "Simulated PDF reference. Full parsing requires a dedicated library."
            },
            ar: {
                pageTitle: "تحليلات الأعمال الذكية - شركة ميس السعودية",
                apiStatusConnected: "🟢 متصل بـ Yazeed AI API",
                apiStatusDisconnected: "🔴 غير متصل بـ Yazeed AI API",
                mainTitle: "🔍 تحليلات الأعمال الذكية",
                companyNameHeader: "شركة ميس السعودية للمنتجات الطبية",
                headerSubtitle: "نظام تحليل متقدم مدعوم بالذكاء الاصطناعي لحل الأزمات المالية لشركة ميس السعودية",
                navOverview: "🏠 نظرة عامة",
                navAdvancedAnalysis: "📊 تحليل متقدم",
                navQualityManagement: "🏥 إدارة الجودة",
                navDemandForecasting: "📈 توقعات الطلب",
                navCompetitorAnalysis: "🎯 تحليل المنافسين",
                navAiAssistant: "🤖 مساعد الذكاء الاصطناعي",
                companyInfoTitle: "📋 معلومات الشركة",
                yearFounded: "سنة التأسيس",
                riyadh: "الرياض",
                headquarters: "المقر الرئيسي",
                medical: "طبية",
                specializedProducts: "منتجات متخصصة",
                middleEast: "الشرق الأوسط",
                targetMarket: "السوق المستهدف",
                overviewCompanyDesc: "شركة ميس السعودية هي إحدى الشركات الرائدة في مجال المنتجات الطبية، وتلتزم بتعزيز معايير الرعاية الصحية في المنطقة من خلال الابتكار والجودة.",
                marketAnalysisTitle: "تحليل السوق",
                financialAnalysisTitle: "التحليل المالي",
                advancedAnalyticsSystemTitle: "نظام تحليل البيانات المتقدم لشركة ميس السعودية",
                advancedAnalyticsSystemDesc: "تحليل شامل لاتجاهات السوق والأداء التشغيلي مع توصيات استراتيجية لشركة ميس السعودية",
                textInputBtn: "📝 إدخال نصي",
                fileUploadBtn: "📁 رفع ملف",
                guidanceAdvancedAnalysis: "*للحصول على أفضل النتائج، يرجى تقديم بيانات مالية محددة، أرقام مبيعات، بيانات إنتاج، وتقارير سوق. حدد بوضوح أهداف التحليل الرئيسية أو أسئلتك في حقل 'مجالات التركيز'.*",
                advancedTextInputPlaceholder: "أدخل بيانات شركة ميس السعودية للتحليل المتقدم (بيانات مالية، مبيعات، إنتاج، إلخ...)",
                advancedFocusInputPlaceholder: "مجالات تركيز لشركة ميس السعودية (مثال: 'تحليل تأثير المنافسين في قطاع منتجات الجهاز التنفسي'، 'تقييم آثار التنظيمات الجديدة على شركة ميس السعودية')",
                dragFileHere: "📁 اسحب الملف هنا أو انقر للاختيار",
                supportedFileTypes: "يدعم: Excel, CSV, PDF, Word, TXT",
                advancedFocusInputFilePlaceholder: "مجالات تركيز محددة لتحليل الملف الخاص بشركة ميس السعودية",
                startAdvancedAnalysisBtn: "🚀 بدء التحليل المتقدم لشركة ميس السعودية",
                advancedStep1Text: "📄 معالجة الإدخال/الملف لتحليل شركة ميس السعودية...",
                advancedStep2Text: "🔄 إرسال البيانات إلى Yazeed AI لسياق شركة ميس السعودية...",
                advancedStep3Text: "🧠 تحليل الذكاء الاصطناعي لشركة ميس السعودية قيد التقدم...",
                advancedStep4Text: "📊 تنسيق النتائج الخاصة بشركة ميس السعودية...",
                advancedAnalysisResultsTitle: "📊 نتائج التحليل المتقدم لشركة ميس السعودية",
                exportTxtBtn: "📄 تصدير TXT",
                exportMdBtn: "📝 تصدير MD",
                exportPdfBtn: "📑 تصدير PDF",
                qualityManagementSystemTitle: "نظام إدارة الجودة الذكي لشركة ميس السعودية",
                qualityManagementSystemDesc: "مراقبة الجودة وفقًا للمعايير الدولية (ISO 13485) ومتطلبات FDA لشركة ميس السعودية",
                guidanceQualityManagement: "*لتحليل جودة مثالي، يرجى تضمين تقارير العيوب، سجلات شكاوى العملاء، نتائج التدقيق (ISO 13485/SFDA)، وثائق الإجراءات التصحيحية والوقائية (CAPA)، وإجراءات نظام إدارة الجودة ذات الصلة. حدد معايير الجودة أو مجالات الاهتمام في 'مجالات التركيز'.*",
                qualityTextInputPlaceholder: "أدخل بيانات الجودة لشركة ميس السعودية (عيوب الإنتاج، شكاوى العملاء، نتائج الاختبارات، إلخ...)",
                qualityFocusInputPlaceholder: "مجالات تركيز الجودة لشركة ميس السعودية (مثال: 'تقييم الامتثال لـ ISO'، 'تحليل رضا العملاء')",
                dragQualityFile: "📁 اسحب ملف بيانات الجودة هنا لشركة ميس السعودية",
                qualityFileTypes: "تقارير الجودة، سجلات الفحص، شكاوى العملاء (شركة ميس السعودية)",
                qualityFocusInputFilePlaceholder: "مجالات تركيز تحليل الجودة من الملف لشركة ميس السعودية",
                analyzeQualityBtn: "🔍 تحليل الجودة لشركة ميس السعودية",
                qualityStep1Text: "📄 قراءة بيانات الجودة لشركة ميس السعودية...",
                qualityStep2Text: "🔄 الإرسال إلى تحليل الذكاء الاصطناعي لجودة شركة ميس السعودية...",
                qualityStep3Text: "🏥 تقييم الجودة لشركة ميس السعودية قيد التقدم...",
                qualityStep4Text: "📊 إنشاء تقرير الجودة لشركة ميس السعودية...",
                qualityAnalysisResultsTitle: "🏥 نتائج تحليل الجودة لشركة ميس السعودية",
                demandForecastingSystemTitle: "نظام توقعات الطلب والمخزون لشركة ميس السعودية",
                demandForecastingSystemDesc: "توقع الطلب المستقبلي وتحسين مستويات المخزون لشركة ميس السعودية باستخدام الذكاء الاصطناعي",
                guidanceDemandForecasting: "*لتحقيق توقعات طلب دقيقة، يرجى تقديم بيانات مبيعات تاريخية مفصلة (حسب المنتج/وحدة حفظ المخزون، الفترة)، مستويات المخزون، سجلات الأنشطة الترويجية، وأي أحداث سوق معروفة أو عوامل موسمية. حدد بوضوح أفق التنبؤ والمنتجات المحددة في 'مجالات التركيز'.*",
                demandTextInputPlaceholder: "أدخل بيانات المبيعات والمخزون التاريخية لشركة ميس السعودية (فترات، كميات، مواسم، إلخ...)",
                demandFocusInputPlaceholder: "تركيز التوقعات لشركة ميس السعودية (مثال: 'اتجاهات موسمية للربع الرابع'، 'توقع الطلب على منتج جديد')",
                dragDemandFile: "📁 اسحب ملف بيانات المبيعات والمخزون لشركة ميس السعودية",
                demandFileTypes: "بيانات المبيعات التاريخية، مستويات المخزون (شركة ميس السعودية)",
                demandFocusInputFilePlaceholder: "مجالات تركيز توقعات الطلب من الملف لشركة ميس السعودية",
                forecastDemandBtn: "📊 توقع الطلب لشركة ميس السعودية",
                demandStep1Text: "📄 معالجة البيانات التاريخية لشركة ميس السعودية...",
                demandStep2Text: "🔄 إعداد نموذج الذكاء الاصطناعي لطلب شركة ميس السعودية...",
                demandStep3Text: "📈 إنشاء التوقعات لشركة ميس السعودية...",
                demandStep4Text: "📊 إنشاء توصيات المخزون لشركة ميس السعودية...",
                demandForecastingResultsTitle: "📈 نتائج توقعات الطلب لشركة ميس السعودية",
                competitorAnalysisSystemTitle: "نظام تحليل المنافسين لشركة ميس السعودية",
                competitorAnalysisSystemDesc: "تحليل تنافسي شامل في سوق المعدات الطبية لشركة ميس السعودية وتحديد الفرص الاستراتيجية",
                guidanceCompetitorAnalysis: "*لتحليل تنافسي شامل، يرجى ذكر المنافسين الرئيسيين، عروض منتجاتهم، استراتيجيات التسعير (إن وجدت)، تقديرات الحصة السوقية، وأي تقارير عامة أو أخبار متاحة. حدد الأسواق وقطاعات المنتجات للمقارنة في 'مجالات التركيز'.*",
                competitorTextInputPlaceholder: "أدخل بيانات المنافسين ذات الصلة بشركة ميس السعودية (أسماء الشركات، الأسعار، الخدمات، نقاط القوة والضعف، إلخ...)",
                competitorFocusInputPlaceholder: "تركيز التحليل التنافسي لشركة ميس السعودية (مثال: 'مقارنة استراتيجية التسعير'، 'تحليل تحديد الموقع في السوق')",
                dragCompetitorFile: "📁 اسحب ملف بيانات المنافسين لتحليل شركة ميس السعودية",
                competitorFileTypes: "تقارير السوق، معلومات المنافسين، دراسات مقارنة (شركة ميس السعودية)",
                competitorFocusInputFilePlaceholder: "مجالات تركيز تحليل المنافسين من الملف لشركة ميس السعودية",
                analyzeCompetitionBtn: "🔎 تحليل المنافسة لشركة ميس السعودية",
                competitorStep1Text: "📄 معالجة بيانات المنافسين لسياق شركة ميس السعودية...",
                competitorStep2Text: "🔄 تحليل السوق قيد التقدم لشركة ميس السعودية...",
                competitorStep3Text: "🎯 تحليل تحديد الموقع التنافسي لشركة ميس السعودية...",
                competitorStep4Text: "📊 إنشاء التوصيات الاستراتيجية لشركة ميس السعودية...",
                competitorAnalysisResultsTitle: "🎯 نتائج تحليل المنافسين لشركة ميس السعودية",
                aiAssistantTitle: "🤖 مساعد يزيد الذكي لشركة ميس السعودية",
                aiAssistantName: "يزيد AI (متخصص شركة ميس السعودية):",
                aiWelcomeMessage: "مرحباً! أنا مساعدك الذكي لتحليل وضع شركة ميس السعودية. أنا متخصص في تقديم تحليل شامل لوضعها المالي واستراتيجيات التعافي من الأزمات، مع الاستفادة من ملفها التعريفي الفريد.",
                aiChatInputPlaceholder: "اسأل عن التحليل المالي أو استراتيجيات التعافي لشركة ميس السعودية...",
                sendBtn: "إرسال",
                comprehensiveAnalysisBtn: "تحليل شامل لشركة ميس السعودية",
                fileProcessingMessage: "قراءة الملف:",
                fileReadSuccessMessage: "✅ الملف جاهز:",
                fileSizeLabel: "الحجم:",
                fileContentPreviewLabel: "معاينة المحتوى (أول 200 حرف):",
                removeFileBtn: "🗑️ إزالة الملف",
                fileReadError: "❌ خطأ في قراءة الملف:",
                alertNoData: "الرجاء إدخال بيانات أو رفع ملف للتحليل الخاص بشركة ميس السعودية.",
                alertPdfExport: "ميزة تصدير PDF تتطلب مكتبة إضافية. سيتم التصدير كنص بدلاً من ذلك.",
                analysisFailedMsg: '<div class="critical-box"><h4>فشل التحليل</h4><p>عذراً، لم يتم إكمال التحليل الخاص بشركة ميس السعودية. يرجى التحقق من مدخلاتك أو المحاولة مرة أخرى لاحقاً. إذا استمرت المشكلة، يرجى الاتصال بالدعم.</p></div>',
                marketChartLabelCurrent: 'الوضع الحالي',
                marketChartLabelTarget: 'الهدف المستقبلي',
                marketChartLabels: ['حجم السوق', 'النمو', 'المنافسة', 'الجودة', 'السعر', 'التوزيع'],
                financialChartLabelRevenue: 'الإيرادات (مليون ريال)',
                financialChartLabelProfit: 'الأرباح (مليون ريال)',
                financialChartLabels: ['2020', '2021', '2022', '2023', '2024', '2025 (مخطط)'],
                loadingAnalysisText: "التحليل الخاص بشركة ميس السعودية قيد التقدم...",
                loadingQueryText: "تحليل استفسارك بخصوص شركة ميس السعودية...",
                loadingComprehensiveAnalysisText: "إنشاء تحليل شامل للأعمال لشركة ميس السعودية...",
                comprehensiveAnalysisResultTitle: "التحليل الشامل لشركة ميس السعودية:",
                defaultFileName: "ملف مرفوع",
                simulatedDocxMessage: "محتوى DOCX محاكى. التحليل الكامل يتطلب مكتبة متخصصة.",
                simulatedPdfMessage: "إشارة لملف PDF محاكاة. التحليل الكامل يتطلب مكتبة متخصصة."
            }
        };

        function setLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('maisLang', lang);
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

            document.querySelectorAll('[data-translate-key]').forEach(el => {
                const key = el.getAttribute('data-translate-key');
                if (translations[lang] && translations[lang][key]) {
                    if (el.tagName === 'TEXTAREA' || (el.tagName === 'INPUT' && (el.type === 'text' || el.type === 'search' /* for AI input */))) {
                        el.placeholder = translations[lang][key];
                    } else {
                        el.innerHTML = translations[lang][key];
                    }
                }
            });
            
            document.getElementById('lang-en').classList.toggle('active', lang === 'en');
            document.getElementById('lang-ar').classList.toggle('active', lang === 'ar');
            
            initializeCharts();
            checkAPIConnection(); 
            Object.keys(uploadedFiles).forEach(section => {
                if (uploadedFiles[section]) {
                    updateFileStatusDisplay(section, uploadedFiles[section].name, fileContents[section] || "");
                }
            });
        }

        const GEMINI_API_KEY = 'AIzaSyAquNVYw6VOmAKTtKtTPU7Tl3PVIG0sKhg'; 
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent';

        function checkAPIConnection() {
            const statusElement = document.getElementById('apiStatus');
            const isConnected = GEMINI_API_KEY !== 'YOUR_GEMINI_API_KEY_HERE' && GEMINI_API_KEY.startsWith('AIza');
            const statusTextKey = isConnected ? 'apiStatusConnected' : 'apiStatusDisconnected';
            
            statusElement.className = `api-status ${isConnected ? 'api-connected' : 'api-disconnected'}`;
            const span = statusElement.querySelector('span') || document.createElement('span');
            span.setAttribute('data-translate-key', statusTextKey);
            span.innerHTML = translations[currentLanguage][statusTextKey];
            if (!statusElement.querySelector('span')) {
                statusElement.appendChild(span);
            }
        }

        function initializeCharts() {
            const currentLangTranslations = translations[currentLanguage];
            if (marketChartInstance) marketChartInstance.destroy();
            if (financialChartInstance) financialChartInstance.destroy();
            
            const chartLabelColor = 'rgba(255, 255, 255, 0.8)';
            const gridColor = 'rgba(255, 255, 255, 0.15)';
            const tickColor = 'rgba(255, 255, 255, 0.7)';

            const marketCtx = document.getElementById('marketChart');
            if (marketCtx) {
                marketChartInstance = new Chart(marketCtx.getContext('2d'), {
                    type: 'radar',
                    data: {
                        labels: currentLangTranslations.marketChartLabels,
                        datasets: [{
                            label: currentLangTranslations.marketChartLabelCurrent,
                            data: [40, 30, 25, 70, 60, 45],
                            backgroundColor: 'rgba(255, 99, 132, 0.3)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(255, 99, 132, 1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(255, 99, 132, 1)'
                        }, {
                            label: currentLangTranslations.marketChartLabelTarget,
                            data: [80, 75, 70, 90, 85, 80],
                            backgroundColor: 'rgba(54, 162, 235, 0.3)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(54, 162, 235, 1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(54, 162, 235, 1)'
                        }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: chartLabelColor, font: { size: 13 } } } },
                        scales: {
                            r: {
                                angleLines: { color: gridColor },
                                grid: { color: gridColor },
                                pointLabels: { color: chartLabelColor, font: { size: currentLanguage === 'ar' ? 11 : 12} },
                                ticks: { backdropColor: 'transparent', color: tickColor, stepSize: 20 }
                            }
                        },
                        elements: { line: { tension: 0.1 } }
                    }
                });
            }

            const financialCtx = document.getElementById('financialChart');
            if (financialCtx) {
                financialChartInstance = new Chart(financialCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: currentLangTranslations.financialChartLabels,
                        datasets: [{
                            label: currentLangTranslations.financialChartLabelRevenue,
                            data: [50, 45, 40, 35, 30, 60],
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.3)',
                            tension: 0.4, fill: true,
                            pointRadius: 4, pointHoverRadius: 6
                        }, {
                            label: currentLangTranslations.financialChartLabelProfit,
                            data: [10, 5, 0, -5, -10, 15],
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.3)',
                            tension: 0.4, fill: true,
                            pointRadius: 4, pointHoverRadius: 6
                        }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: chartLabelColor, font: {size: 13} } } },
                        scales: {
                            y: { grid: { color: gridColor }, ticks: { color: tickColor } },
                            x: { grid: { color: gridColor }, ticks: { color: tickColor } }
                        },
                        interaction: { intersect: false, mode: 'index' }
                    }
                });
            }
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            const activeSection = document.getElementById(sectionId);
            if (activeSection) activeSection.classList.add('active');
            
            const activeButton = document.querySelector(`.nav-btn[onclick*="showSection('${sectionId}')"]`);
            if (activeButton) activeButton.classList.add('active');
            
            currentSection = sectionId;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function toggleInputMode(section, mode) {
            const textInputArea = document.getElementById(`${section}-text`);
            const fileInputArea = document.getElementById(`${section}-file`);
            const buttons = document.querySelectorAll(`#${section}.section .input-options .option-btn`);
            
            buttons.forEach(btn => btn.classList.remove('active'));
            
            if (mode === 'text') {
                if(textInputArea) textInputArea.classList.add('active');
                if(fileInputArea) fileInputArea.classList.remove('active');
                if(buttons[0]) buttons[0].classList.add('active');
            } else {
                if(textInputArea) textInputArea.classList.remove('active');
                if(fileInputArea) fileInputArea.classList.add('active');
                if(buttons[1]) buttons[1].classList.add('active');
            }
        }

        function updateFileStatusDisplay(section, fileName, fileContentPreview) {
            const fileStatusDiv = document.getElementById(`${section}FileStatus`);
            if (!fileStatusDiv) return;

            fileStatusDiv.style.display = 'block';
            fileStatusDiv.innerHTML = `
                <p><span class="file-name">${translations[currentLanguage].fileReadSuccessMessage} ${fileName || translations[currentLanguage].defaultFileName}</span></p>
                <p style="font-size: 0.9em;">${translations[currentLanguage].fileSizeLabel} ${(uploadedFiles[section]?.size / 1024).toFixed(2)} KB</p>
                <div class="file-preview" lang="${currentLanguage}" dir="${currentLanguage === 'ar' ? 'rtl' : 'ltr'}">
                    <strong>${translations[currentLanguage].fileContentPreviewLabel}</strong><br>
                    ${fileContentPreview.substring(0, 200).replace(/</g, "&lt;").replace(/>/g, "&gt;")}${fileContentPreview.length > 200 ? '...' : ''}
                </div>
                <button class="btn" onclick="clearFile('${section}')" style="margin-top: 10px; padding: 8px 12px; font-size: 12px;">${translations[currentLanguage].removeFileBtn}</button>
            `;
        }

        async function handleFileUpload(section, inputElement) {
            const file = inputElement.files[0];
            if (!file) return;

            uploadedFiles[section] = file;
            const fileStatusDiv = document.getElementById(`${section}FileStatus`);
            if (fileStatusDiv) {
                 fileStatusDiv.style.display = 'block';
                 fileStatusDiv.innerHTML = `<div class="loading-enhanced" style="margin: 0 auto; width: fit-content;"><div class="loading-dots"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div> ${translations[currentLanguage].fileProcessingMessage} ${file.name}</div>`;
            }

            try {
                let content = '';
                if (file.type === 'text/plain' || file.name.endsWith('.txt') || file.type === 'text/csv' || file.name.endsWith('.csv')) {
                    content = await readTextFile(file);
                } else if (file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' || file.name.endsWith('.docx')) {
                    content = `${translations[currentLanguage].simulatedDocxMessage} (File: ${file.name})`; 
                } else if (file.type === 'application/pdf' || file.name.endsWith('.pdf')) {
                    content = `${translations[currentLanguage].simulatedPdfMessage} (File: ${file.name})`;
                } else {
                    content = `Binary file or unsupported type: ${file.name}`;
                }
                fileContents[section] = content;
                updateFileStatusDisplay(section, file.name, content);

            } catch (error) {
                if (fileStatusDiv) {
                    fileStatusDiv.innerHTML = `
                        <div style="background: rgba(244, 67, 54, 0.2); border: 1px solid rgba(244, 67, 54, 0.5); padding: 15px; border-radius: 10px;">
                            <p>${translations[currentLanguage].fileReadError} ${error.message}</p>
                            <button class="btn" onclick="clearFile('${section}')" style="margin-top: 10px;">${translations[currentLanguage].removeFileBtn}</button>
                        </div>`;
                }
                console.error("Error reading file:", error);
            }
        }

        function readTextFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = e => reject(new Error('Failed to read file content.'));
                reader.readAsText(file);
            });
        }

        function clearFile(section) {
            delete uploadedFiles[section];
            delete fileContents[section];
            const fileInput = document.getElementById(`${section}FileInput`);
            if (fileInput) fileInput.value = ''; 
            
            const fileStatusDiv = document.getElementById(`${section}FileStatus`);
            if (fileStatusDiv) {
                fileStatusDiv.style.display = 'none';
                fileStatusDiv.innerHTML = '';
            }
        }

        function showAnalysisStatus(section, stepsKeys) {
            const statusElement = document.getElementById(`${section}Status`);
            if (!statusElement) return;
            statusElement.style.display = 'block';
            
            stepsKeys.forEach((key, index) => {
                const stepEl = document.getElementById(`${section}Step${index + 1}`);
                if (stepEl) {
                    stepEl.classList.remove('active');
                    stepEl.innerHTML = `⏳ ${translations[currentLanguage][key] || `Step ${index + 1}...`}`;
                }
            });
            
            let delay = 0;
            stepsKeys.forEach((key, index) => {
                setTimeout(() => {
                    const stepEl = document.getElementById(`${section}Step${index + 1}`);
                    if (stepEl) {
                         stepEl.classList.add('active');
                         if (index < stepsKeys.length -1 ) {
                            stepEl.innerHTML = `✅ ${translations[currentLanguage][key] || `Step ${index + 1} Done`}`;
                         } else {
                            stepEl.innerHTML = `🏁 ${translations[currentLanguage][key] || `Step ${index + 1} Done`}`;
                         }
                    }
                }, delay);
                delay += 700; 
            });
            
            setTimeout(() => {
                 if (statusElement) statusElement.style.display = 'none';
            }, delay + 1500);
        }

        async function callGeminiAPI(prompt, dataToConsider = "") {
            const langInstruction = currentLanguage === 'ar' ? "الرجاء الرد باللغة العربية الفصحى بشكل كامل ومفصل ومنسق." : "Please respond in English fully, in detail, and well-formatted.";
            
            let contextDataInfo = "";
            if (dataToConsider) {
                contextDataInfo = currentLanguage === 'ar' ? 
                    `\n\nخذ في الاعتبار البيانات التالية (معاينة من الملف المرفق: "${dataToConsider.substring(0, 100).replace(/\n/g, " ")}...") في تحليلك، مع التركيز على هذه البيانات بشكل أساسي.` :
                    `\n\nConsider the following data (preview from attached file: "${dataToConsider.substring(0, 100).replace(/\n/g, " ")}...") in your analysis, focusing primarily on this data.`;
            }

            const fullPrompt = `${langInstruction}${contextDataInfo}\n\n${prompt}`;

            if (GEMINI_API_KEY === 'YOUR_GEMINI_API_KEY_HERE' || !GEMINI_API_KEY.startsWith('AIza')) {
                console.warn("Using simulated API response.");
                return await simulateGeminiResponse(prompt, dataToConsider);
            }

            try {
                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: fullPrompt }] }]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('Gemini API Error:', errorData);
                    throw new Error(`API Error: ${errorData.error?.message || response.statusText}`);
                }
                
                const data = await response.json();
                if (data.candidates && data.candidates[0]?.content?.parts?.[0]?.text) {
                    return data.candidates[0].content.parts[0].text;
                } else {
                     console.error('Unexpected API response structure:', data);
                     throw new Error('Invalid API response structure.');
                }
            } catch (error) {
                console.error('Error calling Gemini API:', error);
                return await simulateGeminiResponse(prompt, dataToConsider); 
            }
        }
        
        function formatContent(content) {
            let formatted = content;
            // Basic Markdown to HTML (Headings, Lists, Bold, Italic)
            // More robust parsing would require a dedicated library
            formatted = formatted.replace(/^#\s(.*?)$/gm, (match, p1) => p1.includes('<') ? match : `<h1>${p1}</h1>`);
            formatted = formatted.replace(/^##\s(.*?)$/gm, (match, p1) => p1.includes('<') ? match : `<h2>${p1}</h2>`);
            formatted = formatted.replace(/^###\s(.*?)$/gm, (match, p1) => p1.includes('<') ? match : `<h3>${p1}</h3>`);
            formatted = formatted.replace(/^####\s(.*?)$/gm, (match, p1) => p1.includes('<') ? match : `<h4>${p1}</h4>`);

            formatted = formatted.replace(/^\s*-\s(.*?)$/gm, (match, p1) => p1.includes('<') ? match : `<li>${p1}</li>`);
            formatted = formatted.replace(/^\s*\*\s(.*?)$/gm, (match, p1) => p1.includes('<') ? match : `<li>${p1}</li>`);
            // Wrap consecutive LIs in UL
            formatted = formatted.replace(/(<li>.*?<\/li>(?:\s*<li>.*?<\/li>)*)/gs, (match) => {
                if (match.startsWith('<ul>') || match.startsWith('<ol>')) return match; // Avoid double wrapping
                return `<ul>${match}</ul>`;
            });
             // Numbered lists
            formatted = formatted.replace(/^\s*\d+\.\s(.*?)$/gm, (match, p1) => p1.includes('<') ? match : `<li>${p1}</li>`);
            formatted = formatted.replace(/(<li>.*?<\/li>(?:\s*<li>.*?<\/li>)*)/gs, (match, innerContent) => {
                 // Check if it's already wrapped or if it's a numbered list item
                if (match.startsWith('<ol>') || match.startsWith('<ul>')) return match;
                if (match.match(/^\s*<li>/)) { // Basic check for list items
                    // Heuristic: if the first item looks like a numbered list, wrap in <ol>
                    const firstLiContent = match.match(/<li>(.*?)<\/li>/);
                    if (firstLiContent && firstLiContent[1] && /^\s*\d+\./.test(firstLiContent[1])) {
                         // This is a bit tricky, as the number is already part of the content.
                         // For simplicity, we'll just wrap in OL. A true MD parser would handle this better.
                        return `<ol>${match}</ol>`;
                    }
                    // Default to UL if not clearly numbered or already wrapped
                    return `<ul>${match}</ul>`;
                }
                return match;
            });


            formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // Paragraphs - wrap lines that aren't already part of other HTML structures
            const lines = formatted.split('\n');
            const newLines = lines.map(line => {
                const trimmedLine = line.trim();
                if (trimmedLine.length === 0) return ''; // Keep empty lines for spacing if desired, or remove
                // Check if it's already an HTML element or part of one
                if (trimmedLine.startsWith('<') && trimmedLine.endsWith('>')) { // Simple check
                    // More specific checks for block elements
                    if (trimmedLine.match(/^<(ul|ol|li|h[1-6]|p|div|table|blockquote|pre|hr|br)/i) ||
                        trimmedLine.match(/<\/(ul|ol|li|h[1-6]|p|div|table|blockquote|pre)>$/i)) {
                        return line;
                    }
                }
                // If not an HTML element, wrap in <p>
                if (!trimmedLine.startsWith('<p>') && !trimmedLine.endsWith('</p>')) {
                     return `<p>${line}</p>`;
                }
                return line;
            });
            formatted = newLines.join('\n');

            // Clean up multiple newlines that might result from paragraph wrapping
            formatted = formatted.replace(/\n\s*\n/g, '\n');


            return formatted;
        }

        async function simulateGeminiResponse(prompt, dataContent = "") {
            await new Promise(resolve => setTimeout(resolve, 1200)); 
            
            let dataMention = "";
            if (dataContent) {
                const preview = dataContent.substring(0, 70).replace(/\n/g, " ").replace(/</g, "&lt;");
                dataMention = currentLanguage === 'ar' ? 
                    `<div class="analysis-result-card" style="background: rgba(255,255,0,0.05); border-left-color: #ffeb3b;"><p><em>(ملاحظة: يستند هذا التحليل المحاكى إلى البيانات المقدمة من الملف الذي يبدأ بـ: "${preview}..." مع التركيز عليها بشكل أساسي.)</em></p></div>` :
                    `<div class="analysis-result-card" style="background: rgba(255,255,0,0.05); border-left-color: #ffeb3b;"><p><em>(Note: This simulated analysis is primarily based on the provided file data starting with: "${preview}...")</em></p></div>`;
            }

            const lowerPrompt = prompt.toLowerCase();
            if (lowerPrompt.includes('advanced business analysis') || lowerPrompt.includes('تحليل أعمال متقدم')) {
                return dataMention + (currentLanguage === 'ar' ? generateAdvancedAnalysisResponseAr(dataContent) : generateAdvancedAnalysisResponseEn(dataContent));
            } else if (lowerPrompt.includes('quality management system') || lowerPrompt.includes('نظام إدارة الجودة')) {
                return dataMention + (currentLanguage === 'ar' ? generateQualityAnalysisResponseAr(dataContent) : generateQualityAnalysisResponseEn(dataContent));
            } else if (lowerPrompt.includes('demand forecasting') || lowerPrompt.includes('توقعات الطلب')) {
                return dataMention + (currentLanguage === 'ar' ? generateDemandForecastResponseAr(dataContent) : generateDemandForecastResponseEn(dataContent));
            } else if (lowerPrompt.includes('competitor analysis') || lowerPrompt.includes('تحليل تنافسي')) {
                return dataMention + (currentLanguage === 'ar' ? generateCompetitorAnalysisResponseAr(dataContent) : generateCompetitorAnalysisResponseEn(dataContent));
            } else if (lowerPrompt.includes('comprehensive strategic business analysis') || lowerPrompt.includes('تحليل أعمال استراتيجي شامل')) { 
                return dataMention + (currentLanguage === 'ar' ? generateComprehensiveAnalysisResponseAr() : generateComprehensiveAnalysisResponseEn());
            }
             else { 
                return dataMention + (currentLanguage === 'ar' ? generateDefaultResponseAr(prompt) : generateDefaultResponseEn(prompt));
            }
        }

        // --- English Simulated Responses (NEW - More Detailed) ---
        function generateAdvancedAnalysisResponseEn(data) {
            return `
                <h1>Advanced Business Analysis for Saudi Mais Co.</h1>
                ${data ? `<div class="analysis-result-card"><p><strong>Data Insight:</strong> Analysis incorporates provided data points from the uploaded file for Saudi Mais Co.</p></div>` : '<div class="analysis-result-card"><p><strong>Data Insight:</strong> Analysis based on general knowledge of Saudi Mais Co. and the medical device market.</p></div>'}
                
                <div class="analysis-result-card">
                    <h2>1. Market Environment Analysis</h2>
                    <p>The Saudi Arabian medical consumables market is experiencing robust growth, driven by government healthcare expenditure under Vision 2030, an aging population, and increased health awareness. Key trends include a shift towards local manufacturing (IKTVA program), demand for high-quality sterile single-use products, and digitalization in procurement.</p>
                    <p><strong>Regulatory Landscape:</strong> Strict adherence to Saudi Food and Drug Authority (SFDA) regulations and international standards like ISO 13485 is paramount. Saudi Mais Co.'s established compliance is a strength.</p>
                    <p><strong>Competition:</strong> The market features multinational corporations (MNCs) with broad portfolios, other local manufacturers, and international importers. Differentiation through quality, specialized products, and strong local relationships is crucial for Saudi Mais Co.</p>
                    <div class="metric-card">
                        <div class="metric-label">Projected KSA Medical Consumables Market Growth (CAGR 2024-2028)</div>
                        <div class="metric-value">8.5% <span class="quality-indicator quality-excellent">Strong Growth</span></div>
                    </div>
                </div>

                <div class="analysis-result-card">
                    <h2>2. In-depth Financial Health Assessment</h2>
                    <p>Based on general industry knowledge (or specific data if provided), Saudi Mais Co. likely faces pressures on margins due to competition and raw material cost fluctuations. Key areas for assessment:</p>
                    <ul>
                        <li><strong>Profitability:</strong> Gross Profit Margin on key product lines (e.g., surgical gloves, catheters, dressing kits) should be benchmarked. Net Profit Margin needs to support reinvestment and growth.</li>
                        <li><strong>Liquidity:</strong> Current Ratio and Quick Ratio indicate ability to meet short-term obligations. Efficient management of receivables and inventory is vital.</li>
                        <li><strong>Solvency:</strong> Debt-to-Equity ratio should be monitored to ensure long-term financial stability.</li>
                        <li><strong>Efficiency:</strong> Inventory Turnover Rate and Days Sales Outstanding (DSO) impact working capital.</li>
                    </ul>
                    ${data ? `<p><em>Specific financial ratios from the uploaded data (e.g., Current Ratio: 1.8, GPM: 35%) would provide a more precise assessment.</em></p>` : `<div class="warning-box"><h4>Financial Data Needed</h4><p>Uploading detailed financial statements would enable a more granular analysis of Saudi Mais Co.'s financial health, including specific ratio calculations.</p></div>`}
                </div>

                <div class="analysis-result-card">
                    <h2>3. Operational Performance Review</h2>
                    <p>Saudi Mais Co.'s commitment to "highest international quality standards" is a core operational tenet.</p>
                    <ul>
                        <li><strong>Manufacturing:</strong> Focus on lean manufacturing principles to optimize production of single-use devices, reduce waste, and improve throughput. Capacity utilization should be assessed (e.g., current 75%, target 85%).</li>
                        <li><strong>Supply Chain:</strong> Diversification of raw material suppliers (especially for critical polymers and sterile packaging) can mitigate risks. Efficient logistics for distribution across KSA and potentially GCC. Evaluate supplier lead times and reliability.</li>
                        <li><strong>Quality Control:</strong> Robust QMS (ISO 13485 certified) is essential. Tracking metrics like First Pass Yield (FPY), defect rates (PPM), CAPA effectiveness, and internal/external audit outcomes.</li>
                    </ul>
                </div>

                <div class="analysis-result-card">
                    <h2>4. Strategic Growth Recommendations</h2>
                    <ol>
                        <li><strong>Maximize IKTVA Contribution:</strong> Actively pursue higher IKTVA scores by increasing local content in products and supply chain to gain preference in government tenders and align with national objectives. Target specific IKTVA-favored product categories.</li>
                        <li><strong>Product Portfolio Optimization & Innovation:</strong> Focus on high-margin, high-demand single-use consumables. Invest in R&D or partnerships for niche segments like advanced wound care, specialized infection control products, or biodegradable medical plastics.</li>
                        <li><strong>Regional Expansion (Phased Approach):</strong> Target select GCC (e.g., UAE, Kuwait) and MENA markets where Saudi-made quality products have a competitive edge. Start with distributor partnerships.</li>
                        <li><strong>Digital Transformation:</strong> Implement/upgrade ERP and SCM systems for better planning, real-time visibility, and efficiency. Explore e-procurement platform integration with major hospital groups.</li>
                        <li><strong>Strategic Partnerships & Alliances:</strong> Collaborate with major hospital groups, Group Purchasing Organizations (GPOs), and potentially research institutions for co-development or clinical validation of new products.</li>
                    </ol>
                </div>

                <div class="analysis-result-card">
                    <h2>5. Comprehensive Risk Assessment and Mitigation Strategies</h2>
                    <p><strong>Market Risks:</strong>
                        <ul>
                            <li>Intense price competition from low-cost imports. <em>Mitigation:</em> Focus on value differentiation (quality, service, local support), cost optimization through operational excellence.</li>
                            <li>Changes in SFDA regulations or reimbursement policies. <em>Mitigation:</em> Continuous regulatory monitoring, proactive engagement with authorities, agile adaptation of QMS.</li>
                        </ul>
                    </p>
                    <p><strong>Operational Risks:</strong>
                        <ul>
                            <li>Supply chain disruptions (geopolitical, supplier failure). <em>Mitigation:</em> Supplier diversification, strategic stockpiling of critical components, robust S&OP process.</li>
                            <li>Manufacturing defects leading to recalls. <em>Mitigation:</em> Stringent QMS, preventative maintenance, continuous employee training, investment in inspection technologies.</li>
                        </ul>
                    </p>
                    <p><strong>Financial Risks:</strong>
                        <ul>
                            <li>Liquidity shortfalls due to extended payment cycles from customers. <em>Mitigation:</em> Prudent cash flow management, exploring factoring or supply chain financing options.</li>
                            <li>Currency fluctuations for imported raw materials. <em>Mitigation:</em> Hedging strategies where appropriate, negotiating longer-term contracts in local currency.</li>
                        </ul>
                    </p>
                </div>
                <div class="recommendation-box">
                    <h4>Key Strategic Imperative for Saudi Mais Co.</h4>
                    <p>Saudi Mais Co. should solidify its position as a leader in high-quality, locally manufactured medical consumables within KSA by leveraging its IKTVA potential and operational strengths. Simultaneously, a cautious yet deliberate regional expansion, coupled with product innovation in niche areas, will drive sustainable growth. This requires a dual focus on operational excellence to manage costs and innovation to meet evolving healthcare needs, all underpinned by strong financial discipline and proactive risk management.</p>
                </div>
            `;
        }

        function generateQualityAnalysisResponseEn(data) {
            return `
                <h1>Quality Management System Review for Saudi Mais Co.</h1>
                ${data ? `<div class="analysis-result-card"><p><strong>Data Insight:</strong> Quality metrics and documentation from the provided file for Saudi Mais Co. (e.g., audit reports, CAPA logs, defect rates) have been central to this assessment.</p></div>` : '<div class="analysis-result-card"><p><strong>Data Insight:</strong> Assessment based on general QMS principles for medical device manufacturers like Saudi Mais Co., adhering to ISO 13485 and SFDA guidelines.</p></div>'}
                
                <div class="analysis-result-card">
                    <h2>1. Overall QMS Effectiveness and Compliance Status</h2>
                    <p>Saudi Mais Co.'s QMS, presumably certified to ISO 13485, forms the backbone of its commitment to producing safe and effective single-use medical consumables. Effectiveness is gauged by its ability to consistently meet customer expectations and stringent regulatory requirements, particularly those set by the Saudi Food and Drug Authority (SFDA).</p>
                    <p><strong>Compliance Checklist Highlights (ISO 13485:2016 & SFDA):</strong>
                        <ul>
                            <li><strong>Management Responsibility:</strong> Clear commitment from top management, defined quality policy and objectives.</li>
                            <li><strong>Resource Management:</strong> Adequate infrastructure, competent personnel, and controlled work environment.</li>
                            <li><strong>Product Realization:</strong> Robust processes for design and development (if applicable), purchasing controls, production and service provision (including sterilization validation, process validation for critical processes like sealing, molding).</li>
                            <li><strong>Measurement, Analysis, and Improvement:</strong> Effective systems for monitoring and measuring processes/products, internal audits, control of nonconforming product, corrective and preventive actions (CAPA), and post-market surveillance.</li>
                            <li><strong>SFDA Specifics:</strong> Medical Device Marketing Authorization (MDMA) requirements, Unique Device Identification (UDI) implementation, adverse event reporting.</li>
                        </ul>
                    </p>
                    <div class="metric-card">
                        <div class="metric-label">External Audit Findings (SFDA/Notified Body - Major NCs - Last 2 Years)</div>
                        <div class="metric-value">${data ? '0 (Example)' : 'N/A (Data Dependant)'} <span class="quality-indicator ${data ? 'quality-excellent' : 'quality-warning'}">${data ? 'Excellent' : 'Awaiting Data'}</span></div>
                        <p style="font-size:0.8em; opacity:0.7;">(Illustrative metric; actual audit outcomes would be used)</p>
                    </div>
                </div>

                <div class="analysis-result-card">
                    <h2>2. Detailed Defect Analysis and Non-Conformance Trends</h2>
                    <p>A systematic review of internal defect data (e.g., scrap rates, rework percentages, incoming material rejection rates) and external data (customer complaints, field corrective actions) is essential.
                    ${data ? `<em>The provided data (e.g., Pareto charts of defects, complaint logs) would allow for specific trend identification, such as 'X% of defects related to packaging seals for product Y' or 'recurring non-conformance in supplier Z's components'.</em>` : `<em>Detailed defect and non-conformance data is needed for precise trend analysis and root cause identification.</em>`}
                    </p>
                    <p><strong>Key Performance Indicators (KPIs) for Monitoring:</strong>
                        <ol>
                            <li>First Pass Yield (FPY) for critical manufacturing steps.</li>
                            <li>Out-of-Specification (OOS) rate for finished products.</li>
                            <li>Number of open CAPAs and average CAPA cycle time.</li>
                            <li>Supplier defect rate (PPM).</li>
                        </ol>
                    </p>
                </div>

                <div class="analysis-result-card">
                    <h2>3. Evaluation of Customer Complaint Handling & Post-Market Surveillance</h2>
                    <p>An effective complaint handling system (as per ISO 13485 and SFDA requirements) is vital for identifying product issues, ensuring patient safety, and driving continuous improvement. This includes timely intake, investigation, root cause analysis, reporting (if necessary), and implementation of corrective/preventive actions.</p>
                    <p><strong>Post-Market Surveillance (PMS) Activities for Saudi Mais Co.:</strong>
                        <ul>
                            <li>Systematic collection of feedback from users, distributors.</li>
                            <li>Monitoring of scientific literature and competitor recalls.</li>
                            <li>Periodic Safety Update Reports (PSURs) if applicable.</li>
                            <li>Proactive trend analysis of PMS data to detect early warning signals.</li>
                        </ul>
                    </p>
                    <div class="critical-box">
                        <h4>Focus Area: CAPA System Effectiveness</h4>
                        <p>The CAPA system should not just address symptoms but effectively eliminate root causes to prevent recurrence. Regular effectiveness checks of implemented CAPAs are crucial. If data shows high recurrence rates for similar issues, the CAPA system needs strengthening.</p>
                    </div>
                </div>
                
                <div class="analysis-result-card">
                    <h2>4. Actionable Quality Improvement Plan for Saudi Mais Co.</h2>
                    <p>Based on a comprehensive QMS assessment, the following prioritized recommendations are proposed:</p>
                    <ol>
                        <li><strong>Strengthen Risk-Based Thinking (ISO 14971 & ISO 13485):</strong> Ensure risk management is not a standalone activity but fully integrated into all QMS processes, from design and supplier selection to production and post-market activities for all medical consumables.</li>
                        <li><strong>Enhance Supplier Quality Management Program:</strong> Implement a tiered supplier classification based on risk. Conduct more rigorous on-site audits for critical suppliers. Establish robust quality agreements detailing specifications and change control.</li>
                        <li><strong>Invest in Digital QMS (eQMS) Solutions:</strong> Transition from paper-based or disparate systems to an integrated eQMS for streamlined document control, training records, CAPA management, audit scheduling, and change control. This improves efficiency, traceability, and data integrity.</li>
                        <li><strong>Competency-Based Training Program:</strong> Develop and implement a role-specific training matrix. Ensure regular refresher training on QMS procedures, GDP, GMP, and regulatory updates (SFDA, ISO). Measure training effectiveness.</li>
                        <li><strong>Proactive Quality Culture:</strong> Foster a culture where quality is everyone's responsibility. Implement quality circles or continuous improvement teams. Encourage reporting of potential issues without fear of reprisal.</li>
                        <li><strong>Data Analytics for Quality Intelligence:</strong> Utilize statistical process control (SPC) where applicable. Implement dashboards to monitor key quality KPIs in real-time, enabling data-driven decision-making for proactive improvements.</li>
                    </ol>
                </div>
                <div class="recommendation-box">
                    <h4>Core Quality Philosophy for Saudi Mais Co.</h4>
                    <p>Saudi Mais Co. should strive for a "Right First Time" quality philosophy, moving beyond mere compliance to a state of proactive quality assurance and continuous improvement. This involves empowering employees, leveraging data, and fully integrating risk management into all operations to ensure the consistent delivery of safe, effective, and high-quality single-use medical consumables to the Saudi and regional markets.</p>
                </div>
            `;
        }

        function generateDemandForecastResponseEn(data) {
             return `
                <h1>Demand Forecasting & Inventory Optimization for Saudi Mais Co.</h1>
                ${data ? `<div class="analysis-result-card"><p><strong>Data Insight:</strong> Historical sales, inventory levels, and market data from the provided file for Saudi Mais Co.'s single-use medical consumables have shaped this forecast and inventory strategy.</p></div>` : '<div class="analysis-result-card"><p><strong>Data Insight:</strong> Forecast and inventory strategy based on general market trends for medical consumables in the Middle East, applied to Saudi Mais Co., considering factors like Vision 2030 healthcare expansion.</p></div>'}
                
                <div class="analysis-result-card">
                    <h2>1. Comprehensive Demand Analysis</h2>
                    <p>Analysis of historical sales data (e.g., last 3-5 years) for Saudi Mais Co.'s product lines (e.g., surgical gloves, IV sets, syringes, wound dressings) is crucial. This involves identifying:</p>
                    <ul>
                        <li><strong>Base Demand:</strong> Underlying demand level for each product category.</li>
                        <li><strong>Trends:</strong> Upward, downward, or stable trends in demand.</li>
                        <li><strong>Seasonality:</strong> Predictable fluctuations (e.g., increased demand for respiratory products during flu season).</li>
                        <li><strong>Cyclicality:</strong> Longer-term economic or market cycles.</li>
                        <li><strong>Impact of External Factors:</strong> Influence of public health initiatives (e.g., vaccination campaigns), new hospital openings (driven by Vision 2030), competitor activities, and regulatory changes.</li>
                    </ul>
                    ${data ? `<p><em>The provided data would enable quantitative analysis, e.g., identifying a 10% YoY growth trend for Product X, or a Q4 seasonal peak for Product Y.</em></p>` : `<p><em>Detailed historical sales data by SKU/category is essential for accurate quantitative analysis.</em></p>`}
                </div>

                <div class="analysis-result-card">
                    <h2>2. Forecasting Results (Next 12-18 Months)</h2>
                    <p>Based on the demand analysis, statistical forecasting models (e.g., ARIMA, Exponential Smoothing) combined with qualitative inputs (market intelligence, sales team feedback) can generate projections. Below is an illustrative forecast for key product categories:</p>
                    <h4>Illustrative Demand Forecast for Saudi Mais Co. (Units)</h4>
                    <table>
                        <thead><tr><th>Product Category</th><th>Next 6 Months</th><th>Next 12 Months</th><th>Key Assumptions</th></tr></thead>
                        <tbody>
                            <tr><td>Sterile Surgical Gloves (Pairs)</td><td>${data ? '2,800,000' : '2,500,000'}</td><td>${data ? '5,800,000' : '5,200,000'}</td><td>Continued hospital activity, moderate market share growth.</td></tr>
                            <tr><td>Disposable Syringes (Units)</td><td>${data ? '12,000,000' : '10,000,000'}</td><td>${data ? '25,000,000' : '22,000,000'}</td><td>Public health programs, stable institutional demand.</td></tr>
                            <tr><td>Advanced Wound Dressings (Units)</td><td>${data ? '300,000' : '250,000'}</td><td>${data ? '650,000' : '550,000'}</td><td>Increased adoption, new product introductions by Mais Co.</td></tr>
                        </tbody>
                    </table>
                    <div class="metric-card">
                        <div class="metric-label">Overall Forecast Accuracy (Target MAPE)</div>
                        <div class="metric-value">&lt; 15% <span class="quality-indicator quality-good">Good Target</span></div>
                        <p style="font-size:0.8em; opacity:0.7;">(Achieving this requires robust data and models)</p>
                    </div>
                </div>

                <div class="analysis-result-card">
                    <h2>3. Inventory Optimization Strategy</h2>
                    <p>The goal is to balance inventory holding costs with service levels (minimizing stockouts). Recommendations for Saudi Mais Co.:</p>
                    <ul>
                        <li><strong>ABC Analysis:</strong> Classify inventory items based on value/volume (A-items: high value, B-items: medium, C-items: low). Apply tighter control and more frequent review for A-items.</li>
                        <li><strong>Safety Stock Calculation:</strong> Determine appropriate safety stock levels for each SKU based on demand variability, supplier lead time variability, and desired service level (e.g., 98% for critical items).</li>
                        <li><strong>Reorder Point (ROP) & Economic Order Quantity (EOQ):</strong> Calculate ROPs to trigger replenishment orders. Use EOQ models (with caution, considering shelf-life for sterile products) to determine optimal order sizes.</li>
                        <li><strong>Inventory Monitoring:</strong> Implement regular cycle counting and periodic full stock takes to ensure inventory accuracy. Track KPIs like Inventory Turnover, Days of Inventory on Hand (DOH).</li>
                        <li><strong>Slow-Moving & Obsolete Stock (SLOB):</strong> Establish a process for identifying and managing SLOB to minimize write-offs.</li>
                    </ul>
                    ${data ? `<div class="warning-box"><h4>Potential SLOB Identified (Example from Data)</h4><p>If data shows Product Z has not sold in 12 months and has 5000 units in stock, a disposition plan (e.g., discount, donation, disposal) is needed.</p></div>` : ''}
                </div>

                <div class="analysis-result-card">
                    <h2>4. Implementation Roadmap</h2>
                    <ol>
                        <li><strong>Data Cleansing & System Integration (Months 1-3):</strong> Ensure accuracy of historical sales and inventory data. Integrate forecasting module with ERP/SCM systems.</li>
                        <li><strong>Model Selection & Parameter Tuning (Months 2-4):</strong> Select appropriate forecasting models for different product segments. Train planning team on forecasting software.</li>
                        <li><strong>Pilot Program (Months 4-6):</strong> Implement new forecasting and inventory policies for a select group of products. Monitor results and refine processes.</li>
                        <li><strong>Full Rollout & Continuous Improvement (Months 7+):</strong> Extend new processes across all product lines. Establish a regular Sales & Operations Planning (S&OP) cycle to review forecasts, inventory, and align with business objectives.</li>
                    </ol>
                </div>
                <div class="recommendation-box">
                    <h4>Strategic Inventory Management for Saudi Mais Co.</h4>
                    <p>Saudi Mais Co. should transition towards a data-driven, proactive demand forecasting and inventory management system. This will not only reduce costs associated with overstocking or stockouts but also improve customer satisfaction and operational efficiency, positioning the company for scalable growth in the dynamic medical consumables market.</p>
                </div>
            `;
        }

        function generateCompetitorAnalysisResponseEn(data) {
            return `
                <h1>Competitive Landscape Analysis for Saudi Mais Co.</h1>
                ${data ? `<div class="analysis-result-card"><p><strong>Data Insight:</strong> Competitor information, market reports, and pricing data from the provided file have been integrated into this analysis of Saudi Mais Co.'s market position in single-use medical consumables.</p></div>` : '<div class="analysis-result-card"><p><strong>Data Insight:</strong> Analysis based on general knowledge of the medical consumables market in Saudi Arabia and the Middle East, focusing on players relevant to Saudi Mais Co.</p></div>'}
                
                <div class="analysis-result-card">
                    <h2>1. Detailed Market Landscape Overview (KSA & Key GCC Markets)</h2>
                    <p>The single-use medical consumables market in KSA is valued at approximately SAR X.X billion (2023 estimate) and projected to grow at a CAGR of Y.Y% through 2028. Key segments include:
                        <ul>
                            <li>General supplies (gloves, masks, syringes, catheters)</li>
                            <li>Wound care products</li>
                            <li>Infection control products</li>
                            <li>IV and drug delivery consumables</li>
                        </ul>
                    Drivers include Vision 2030 healthcare investments, increasing surgical volumes, and a growing emphasis on infection prevention. The IKTVA program favors local manufacturers like Saudi Mais Co.
                    </p>
                </div>

                <div class="analysis-result-card">
                    <h2>2. In-depth Competitive Assessment</h2>
                    <p>Saudi Mais Co. (established 1994, Riyadh) competes against a mix of players:</p>
                    <h4>Key Competitor Profiles (Illustrative):</h4>
                    <ol>
                        <li>
                            <strong>GlobalMed Inc. (MNC):</strong>
                            <ul>
                                <li><strong>Strengths:</strong> Broad product portfolio, strong R&D, global brand recognition, established distribution.</li>
                                <li><strong>Weaknesses:</strong> Potentially higher price points, less agility in responding to local market needs compared to local players.</li>
                                <li><strong>Strategy:</strong> Focus on premium segments, innovation, and large institutional contracts.</li>
                            </ul>
                        </li>
                        <li>
                            <strong>Arabian Healthcare Solutions (Large Regional Distributor/Importer):</strong>
                            <ul>
                                <li><strong>Strengths:</strong> Extensive distribution network, diverse product sourcing (including lower-cost options), strong relationships with private sector.</li>
                                <li><strong>Weaknesses:</strong> Reliance on import logistics, variable quality perception for some sourced products.</li>
                                <li><strong>Strategy:</strong> Price competitiveness, one-stop-shop for a wide range of consumables.</li>
                            </ul>
                        </li>
                        <li>
                            <strong>FutureTech Medical KSA (Emerging Local Manufacturer):</strong>
                            <ul>
                                <li><strong>Strengths:</strong> Focus on specific high-volume consumables, potential IKTVA benefits, agile operations.</li>
                                <li><strong>Weaknesses:</strong> Limited product range, newer brand, smaller scale compared to Mais Co.</li>
                                <li><strong>Strategy:</strong> Niche market focus, cost-effective local production.</li>
                            </ul>
                        </li>
                    </ol>
                    ${data ? `<p><em>Specific competitor data from the uploaded file (e.g., their market share estimates, pricing for comparable products) would refine these profiles.</em></p>` : ''}
                </div>

                <div class="analysis-result-card">
                    <h2>3. Comparative Analysis: Saudi Mais Co. vs. Competitors</h2>
                    <table>
                        <thead><tr><th>Factor</th><th>Saudi Mais Co.</th><th>GlobalMed Inc.</th><th>Arabian Healthcare</th><th>FutureTech Medical</th></tr></thead>
                        <tbody>
                            <tr><td><strong>Product Quality (ISO 13485)</strong></td><td>High</td><td>Very High</td><td>Variable</td><td>Moderate-High</td></tr>
                            <tr><td><strong>Price Point</strong></td><td>Mid-Range</td><td>Premium</td><td>Low-Mid</td><td>Competitive</td></tr>
                            <tr><td><strong>Local Manufacturing (IKTVA)</strong></td><td>Strong</td><td>Limited/None</td><td>None</td><td>Strong</td></tr>
                            <tr><td><strong>Product Range</strong></td><td>Moderate</td><td>Extensive</td><td>Very Extensive</td><td>Narrow</td></tr>
                            <tr><td><strong>Distribution Network (KSA)</strong></td><td>Good</td><td>Strong</td><td>Very Strong</td><td>Developing</td></tr>
                            <tr><td><strong>Innovation/R&D</strong></td><td>Developing</td><td>High</td><td>Low (Sourcing)</td><td>Low-Moderate</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="analysis-result-card">
                    <h2>4. Opportunity and Threat Identification for Saudi Mais Co.</h2>
                    <p><strong>Opportunities:</strong>
                        <ul>
                            <li>Leverage IKTVA for preferential access to government tenders.</li>
                            <li>Expand into underserved niche consumable segments.</li>
                            <li>Develop export markets in GCC/MENA.</li>
                            <li>Form strategic alliances with local healthcare providers for long-term contracts.</li>
                            <li>Innovate in eco-friendly/sustainable medical consumables.</li>
                        </ul>
                    </p>
                    <p><strong>Threats:</strong>
                        <ul>
                            <li>Intense price competition, especially from importers of low-cost Asian products.</li>
                            <li>Rapid technological advancements by MNCs requiring continuous investment.</li>
                            <li>Changes in SFDA regulations impacting product registration or compliance costs.</li>
                            <li>Consolidation among healthcare providers increasing their bargaining power.</li>
                        </ul>
                    </p>
                </div>

                <div class="analysis-result-card">
                    <h2>5. Strategic Recommendations for Saudi Mais Co.</h2>
                    <ol>
                        <li><strong>Strengthen Value Proposition:</strong> Emphasize "Saudi-made quality, reliability, and responsiveness." Develop clear messaging around IKTVA benefits for customers.</li>
                        <li><strong>Segmented Market Approach:</strong>
                            <ul>
                                <li>For high-volume, commoditized products: Focus on cost optimization and competitive pricing while maintaining quality.</li>
                                <li>For specialized/niche products: Focus on differentiation, clinical benefits, and value-added services.</li>
                            </ul>
                        </li>
                        <li><strong>Enhance Sales & Marketing:</strong> Invest in a skilled sales team with strong clinical knowledge. Develop digital marketing strategies to reach a wider audience. Participate in key regional healthcare exhibitions.</li>
                        <li><strong>Monitor Competitive Intelligence:</strong> Establish a system for regularly tracking competitor activities, new product launches, pricing changes, and market trends.</li>
                        <li><strong>Build Customer Loyalty:</strong> Implement programs for key accounts, offer excellent after-sales support, and gather customer feedback for continuous improvement.</li>
                    </ol>
                </div>
                <div class="recommendation-box">
                    <h4>Competitive Edge for Saudi Mais Co.</h4>
                    <p>Saudi Mais Co.'s path to sustained competitive advantage lies in a trifecta of: 1) Unwavering commitment to SFDA-compliant quality and local manufacturing excellence (IKTVA). 2) Agile responsiveness to the specific needs of the Saudi and regional healthcare markets. 3) Strategic product portfolio management that balances volume with value. By focusing on these pillars, Mais Co. can effectively compete against both global giants and nimble local players.</p>
                </div>
            `;
        }

        function generateComprehensiveAnalysisResponseEn() {
            return `
                <h1>Comprehensive Strategic Analysis: Saudi Mais Co. for Medical Products</h1>
                <div class="analysis-result-card">
                    <h2>1. Executive Summary</h2>
                    <p>Saudi Mais Co. for Medical Products, a Riyadh-based manufacturer of single-use medical consumables since 1994, is a significant local entity committed to high international quality standards (ISO 13485, SFDA compliance). The company operates within a dynamic and growing Saudi and Middle Eastern healthcare market, shaped by Vision 2030, the IKTVA program, and evolving competitive pressures. While possessing a solid foundation in local manufacturing and quality, Saudi Mais Co. faces challenges related to financial performance, operational efficiency, and strategic positioning. This analysis provides a comprehensive roadmap for navigating these challenges, capitalizing on opportunities, and ensuring sustainable growth and enhanced market leadership.</p>
                </div>

                <div class="analysis-result-card">
                    <h2>2. Current Financial Situation & Viable Recovery Strategies</h2>
                    <p>The company is likely experiencing pressures on profitability due to rising input costs and price competition, and potential liquidity constraints from working capital inefficiencies. A robust recovery plan must focus on:</p>
                    <ul>
                        <li><strong>Aggressive Cost Optimization:</strong> Implement lean manufacturing principles across all production lines for medical consumables. Target a 10-15% reduction in Cost of Goods Sold (COGS) over 18-24 months through waste reduction, process improvement, and energy efficiency. Scrutinize SG&A expenses.</li>
                        <li><strong>Working Capital Management:</strong>
                            <ul>
                                <li><strong>Inventory:</strong> Reduce Days of Inventory on Hand (DOH) by 15-20% through better demand forecasting and JIT principles for non-critical items. Implement SLOB reduction program.</li>
                                <li><strong>Receivables:</strong> Reduce Days Sales Outstanding (DSO) by tightening credit policies (where feasible) and improving collection efforts. Target DSO of <60 days.</li>
                                <li><strong>Payables:</strong> Negotiate favorable payment terms with key suppliers without jeopardizing relationships.</li>
                            </ul>
                        </li>
                        <li><strong>Profitability Enhancement:</strong> Review pricing strategy for key product lines. Focus on higher-margin consumables. Explore value-added services (e.g., custom kits, inventory management for hospitals).</li>
                        <li><strong>Debt Restructuring (if applicable):</strong> If debt levels are high, explore options for refinancing at better terms or negotiating with lenders for more flexible repayment schedules.</li>
                    </ul>
                    <div class="critical-box">
                        <h4>Urgent Action: Cash Flow Fortification & Profitability Drive</h4>
                        <p>Implement immediate measures to improve the cash conversion cycle. Conduct a thorough profitability analysis by SKU and customer segment. Discontinue or reprice unprofitable products/services. Establish a monthly cash flow forecasting and monitoring system.</p>
                    </div>
                </div>

                <div class="analysis-result-card">
                    <h2>3. Market Position & Competitive Landscape (Medical Consumables)</h2>
                    <p>Saudi Mais Co. benefits from its "Saudi-made" status, quality reputation, and established presence. However, it faces intense competition.
                    <ul>
                        <li><strong>Strengths:</strong> Local manufacturing (IKTVA advantage), ISO 13485/SFDA compliance, understanding of regional needs, established relationships.</li>
                        <li><strong>Weaknesses:</strong> Potentially higher cost structure than some importers, limited R&D for breakthrough innovations, brand visibility challenges against MNCs.</li>
                        <li><strong>Opportunities:</strong> Vision 2030 healthcare expansion, growing demand for local content, export potential to GCC/MENA, niche product segments.</li>
                        <li><strong>Threats:</strong> Price wars, rapid technological changes, new entrants (local/international), regulatory shifts.</li>
                    </ul>
                    Key strategies include strengthening brand positioning around "Trusted Saudi Quality & Reliability," focusing on product categories where local manufacturing offers distinct advantages (e.g., responsiveness, customization), and developing deeper strategic partnerships with key public (NUPCO) and private healthcare procurement bodies.
                    </p>
                    <div class="metric-card">
                        <div class="metric-label">Target KSA Market Share (Selected Consumables - Next 3 Years)</div>
                        <div class="metric-value">18-20% <span class="quality-indicator quality-good">Ambitious but Achievable</span></div>
                    </div>
                </div>

                <div class="analysis-result-card">
                    <h2>4. Operational Efficiency Assessment & Enhancement Plan</h2>
                    <p>Saudi Mais Co.'s commitment to "highest international quality standards" must be complemented by operational excellence.</p>
                    <ul>
                        <li><strong>QMS Digitization & Enhancement:</strong> Implement/upgrade to an eQMS for improved efficiency in document control, CAPA, audits, training, and change management. Focus on data analytics from QMS for proactive improvements.</li>
                        <li><strong>Supply Chain Resilience & Optimization:</strong> Diversify supplier base for critical raw materials. Implement a robust S&OP process. Optimize logistics and warehousing to reduce costs and improve delivery times.</li>
                        <li><strong>Manufacturing Excellence:</strong> Continue lean initiatives. Invest in automation for repetitive tasks where ROI is clear. Implement a Total Productive Maintenance (TPM) program. Focus on reducing cycle times and improving FPY.</li>
                        <li><strong>Human Capital Development:</strong> Invest in training and development for staff in areas like lean manufacturing, advanced quality techniques, and new technologies. Foster a culture of continuous improvement.</li>
                    </ul>
                </div>

                <div class="analysis-result-card">
                    <h2>5. Strategic Growth Opportunities for Saudi Mais Co.</h2>
                    <ol>
                        <li><strong>Maximize IKTVA & Local Content:</strong> Strategically align product development and sourcing to maximize IKTVA scores, enhancing competitiveness in governmental tenders.</li>
                        <li><strong>Targeted Product Line Expansion:</strong> Cautiously expand into adjacent, high-demand medical consumable categories where Mais Co. can leverage existing capabilities (e.g., specialized sterile kits, advanced infection control solutions). Conduct thorough market research before new launches.</li>
                        <li><strong>Phased Regional Export Development:</strong>
                            <ul>
                                <li><strong>Phase 1 (1-2 years):</strong> Target UAE, Kuwait, Oman with core products via strong local distributors.</li>
                                <li><strong>Phase 2 (3-5 years):</strong> Expand to other promising MENA markets (e.g., Egypt, Jordan) and consider establishing regional sales offices.</li>
                            </ul>
                        </li>
                        <li><strong>Digital Health Integration (Long-term):</strong> Explore how Saudi Mais Co.'s consumables can integrate with or support emerging digital health solutions (e.g., smart packaging, consumables for remote patient monitoring devices).</li>
                        <li><strong>Strategic Alliances & JVs:</strong> Consider partnerships with international MedTech companies for technology transfer or co-manufacturing of more advanced consumables in KSA.</li>
                    </ol>
                </div>
                
                <div class="analysis-result-card">
                    <h2>6. Detailed Strategic Roadmap & Key Performance Indicators (KPIs)</h2>
                    <p><strong>Phase 1 (0-12 Months): Stabilization & Foundation Building</strong>
                        <ul>
                            <li><strong>Focus:</strong> Cash flow improvement, cost reduction, QMS enhancement, strengthening core KSA market position.</li>
                            <li><strong>KPIs:</strong> Positive operating cash flow, 10% COGS reduction, DSO < 75 days, 5% increase in KSA sales of core products.</li>
                        </ul>
                    </p>
                    <p><strong>Phase 2 (12-36 Months): Growth & Optimization</strong>
                        <ul>
                            <li><strong>Focus:</strong> Profitable growth in KSA, initial export success, product portfolio optimization, operational efficiency gains.</li>
                            <li><strong>KPIs:</strong> Net Profit Margin > 8%, successful launch of 2 new product lines, exports contributing 10% of revenue, IKTVA score improvement by X points.</li>
                        </ul>
                    </p>
                    <p><strong>Phase 3 (36+ Months): Market Leadership & Diversification</strong>
                        <ul>
                            <li><strong>Focus:</strong> Establishing regional market presence, exploring strategic JVs/alliances, investing in R&D for next-gen consumables.</li>
                            <li><strong>KPIs:</strong> Top 3 player in KSA for key consumable categories, exports > 20% of revenue, successful JV or technology acquisition.</li>
                        </ul>
                    </p>
                </div>

                <div class="recommendation-box">
                    <h4>Overarching Strategic Vision for Saudi Mais Co.</h4>
                    <p>Saudi Mais Co. is to become the premier Saudi-based manufacturer and regional supplier of high-quality, innovative single-use medical consumables, recognized for its operational excellence, customer-centricity, and significant contribution to the healthcare objectives of Saudi Vision 2030 and the broader Middle East. This vision requires decisive leadership, a commitment to continuous improvement, and strategic investments in people, processes, and technology.</p>
                </div>
            `;
        }

        function generateDefaultResponseEn(query) {
             return `
                <div class="analysis-result-card">
                    <h2>Regarding your query for Saudi Mais Co.: "${query.substring(0,100)}${query.length > 100 ? '...' : ''}"</h2>
                    <p>As Yazeed AI, your dedicated consultant for Saudi Mais Co. (a Riyadh-based manufacturer of single-use medical consumables since 1994, committed to high quality and currently addressing business challenges), I'm here to assist.</p>
                    <p>Saudi Mais Co.'s operations are significantly influenced by the Saudi Vision 2030 healthcare transformation, stringent quality standards (ISO 13485, SFDA requirements), the competitive medical device market, and the drive for local content (IKTVA program). My capabilities include providing detailed analyses on:</p>
                    <ul>
                        <li>Advanced Business Strategy</li>
                        <li>Quality Management Systems (ISO 13485, SFDA)</li>
                        <li>Demand Forecasting and Inventory Optimization</li>
                        <li>Competitor Analysis in the medical consumables sector</li>
                    </ul>
                    <p>For specific data-driven analysis, please utilize the dedicated sections on this platform or upload relevant documents. Alternatively, you can ask me for a "Comprehensive Analysis" for a holistic overview.</p>
                    <p>How can I further assist you today regarding Saudi Mais Co.'s specific situation, its market for medical consumables, or strategies for growth and recovery?</p>
                </div>
            `;
        }

        // --- Arabic Simulated Responses (NEW - More Detailed) ---
        function generateAdvancedAnalysisResponseAr(data) {
            return `
                <h1>تحليل الأعمال المتقدم لشركة ميس السعودية</h1>
                ${data ? `<div class="analysis-result-card"><p><strong>رؤية من البيانات:</strong> يتضمن التحليل نقاط بيانات من الملف المرفوع الخاص بشركة ميس السعودية.</p></div>` : '<div class="analysis-result-card"><p><strong>رؤية من البيانات:</strong> تحليل مبني على المعرفة العامة بشركة ميس السعودية وسوق الأجهزة الطبية.</p></div>'}
                
                <div class="analysis-result-card">
                    <h2>1. تحليل بيئة السوق</h2>
                    <p>يشهد سوق المستهلكات الطبية في المملكة العربية السعودية نموًا قويًا، مدفوعًا بالإنفاق الحكومي على الرعاية الصحية ضمن رؤية 2030، وشيخوخة السكان، وزيادة الوعي الصحي. تشمل الاتجاهات الرئيسية التحول نحو التصنيع المحلي (برنامج اكتفاء)، والطلب على المنتجات المعقمة عالية الجودة ذات الاستخدام الواحد، والرقمنة في عمليات الشراء.</p>
                    <p><strong>المشهد التنظيمي:</strong> يعد الالتزام الصارم بلوائح الهيئة العامة للغذاء والدواء (SFDA) والمعايير الدولية مثل ISO 13485 أمرًا بالغ الأهمية. يُعتبر امتثال شركة ميس السعودية الراسخ نقطة قوة.</p>
                    <p><strong>المنافسة:</strong> يتميز السوق بوجود شركات متعددة الجنسيات (MNCs) ذات محافظ منتجات واسعة، ومصنعين محليين آخرين، ومستوردين دوليين. يعد التمايز من خلال الجودة والمنتجات المتخصصة والعلاقات المحلية القوية أمرًا حاسمًا لشركة ميس السعودية.</p>
                    <div class="metric-card">
                        <div class="metric-label">نمو سوق المستهلكات الطبية المتوقع في المملكة (CAGR 2024-2028)</div>
                        <div class="metric-value">8.5% <span class="quality-indicator quality-excellent">نمو قوي</span></div>
                    </div>
                </div>

                <div class="analysis-result-card">
                    <h2>2. تقييم متعمق للصحة المالية</h2>
                    <p>بناءً على المعرفة العامة بالصناعة (أو بيانات محددة إذا تم توفيرها)، من المحتمل أن تواجه شركة ميس السعودية ضغوطًا على هوامش الربح بسبب المنافسة وتقلبات تكاليف المواد الخام. مجالات التقييم الرئيسية:</p>
                    <ul>
                        <li><strong>الربحية:</strong> يجب قياس هامش الربح الإجمالي على خطوط الإنتاج الرئيسية (مثل القفازات الجراحية، القساطر، مجموعات الضمادات). يجب أن يدعم هامش الربح الصافي إعادة الاستثمار والنمو.</li>
                        <li><strong>السيولة:</strong> تشير نسبة التداول الحالية ونسبة السيولة السريعة إلى القدرة على الوفاء بالالتزامات قصيرة الأجل. الإدارة الفعالة للمستحقات والمخزون أمر حيوي.</li>
                        <li><strong>الملاءة المالية:</strong> يجب مراقبة نسبة الدين إلى حقوق الملكية لضمان الاستقرار المالي على المدى الطويل.</li>
                        <li><strong>الكفاءة:</strong> يؤثر معدل دوران المخزون ومتوسط فترة التحصيل (DSO) على رأس المال العامل.</li>
                    </ul>
                    ${data ? `<p><em>النسب المالية المحددة من البيانات المرفوعة (مثال: نسبة التداول: 1.8، هامش الربح الإجمالي: 35%) ستوفر تقييمًا أكثر دقة.</em></p>` : `<div class="warning-box"><h4>الحاجة إلى بيانات مالية</h4><p>إن تحميل البيانات المالية التفصيلية سيمكن من إجراء تحليل أكثر تفصيلاً للصحة المالية لشركة ميس السعودية، بما في ذلك حسابات نسب محددة.</p></div>`}
                </div>

                <div class="analysis-result-card">
                    <h2>3. مراجعة الأداء التشغيلي</h2>
                    <p>إن التزام شركة ميس السعودية "بأعلى معايير الجودة العالمية" هو مبدأ تشغيلي أساسي.</p>
                    <ul>
                        <li><strong>التصنيع:</strong> التركيز على مبادئ التصنيع الخالي من الهدر لتحسين إنتاج الأجهزة ذات الاستخدام الواحد، وتقليل الفاقد، وتحسين الإنتاجية. يجب تقييم استخدام الطاقة الإنتاجية (مثال: حاليًا 75%، المستهدف 85%).</li>
                        <li><strong>سلسلة التوريد:</strong> يمكن أن يؤدي تنويع موردي المواد الخام (خاصة للبوليمرات الحيوية والتعبئة والتغليف المعقم) إلى تخفيف المخاطر. لوجستيات فعالة للتوزيع في جميع أنحاء المملكة ودول مجلس التعاون الخليجي المحتملة. تقييم مهل التوريد وموثوقية الموردين.</li>
                        <li><strong>مراقبة الجودة:</strong> نظام إدارة الجودة القوي (معتمد وفقًا لـ ISO 13485) ضروري. تتبع المقاييس مثل الإنتاجية من المرة الأولى (FPY)، ومعدلات العيوب (PPM)، وفعالية الإجراءات التصحيحية والوقائية (CAPA)، ونتائج التدقيق الداخلي/الخارجي.</li>
                    </ul>
                </div>

                <div class="analysis-result-card">
                    <h2>4. توصيات النمو الاستراتيجي</h2>
                    <ol>
                        <li><strong>تعظيم مساهمة اكتفاء:</strong> السعي بنشاط للحصول على درجات أعلى في اكتفاء من خلال زيادة المحتوى المحلي في المنتجات وسلسلة التوريد للحصول على الأفضلية في المناقصات الحكومية والتوافق مع الأهداف الوطنية. استهداف فئات منتجات محددة مفضلة لدى اكتفاء.</li>
                        <li><strong>تحسين وتطوير محفظة المنتجات:</strong> التركيز على المستهلكات ذات الاستخدام الواحد ذات الهامش المرتفع والطلب العالي. الاستثمار في البحث والتطوير أو الشراكات للقطاعات المتخصصة مثل العناية المتقدمة بالجروح، أو منتجات مكافحة العدوى المتخصصة، أو المواد البلاستيكية الطبية القابلة للتحلل.</li>
                        <li><strong>التوسع الإقليمي (نهج مرحلي):</strong> استهداف أسواق مختارة في دول مجلس التعاون الخليجي (مثل الإمارات العربية المتحدة، الكويت) ومنطقة الشرق الأوسط وشمال أفريقيا حيث تتمتع المنتجات السعودية عالية الجودة بميزة تنافسية. البدء بشراكات مع الموزعين.</li>
                        <li><strong>التحول الرقمي:</strong> تنفيذ/ترقية أنظمة تخطيط موارد المؤسسات (ERP) وإدارة سلسلة التوريد (SCM) لتحسين التخطيط والرؤية في الوقت الفعلي والكفاءة. استكشاف تكامل منصات الشراء الإلكتروني مع مجموعات المستشفيات الكبرى.</li>
                        <li><strong>الشراكات والتحالفات الاستراتيجية:</strong> التعاون مع مجموعات المستشفيات الكبرى، ومنظمات الشراء الجماعي (GPOs)، وربما المؤسسات البحثية للتطوير المشترك أو التحقق السريري للمنتجات الجديدة.</li>
                    </ol>
                </div>

                <div class="analysis-result-card">
                    <h2>5. تقييم شامل للمخاطر واستراتيجيات التخفيف</h2>
                    <p><strong>مخاطر السوق:</strong>
                        <ul>
                            <li>منافسة سعرية شديدة من الواردات منخفضة التكلفة. <em>التخفيف:</em> التركيز على تمايز القيمة (الجودة، الخدمة، الدعم المحلي)، تحسين التكاليف من خلال التميز التشغيلي.</li>
                            <li>تغييرات في لوائح الهيئة العامة للغذاء والدواء أو سياسات السداد. <em>التخفيف:</em> المراقبة التنظيمية المستمرة، المشاركة الاستباقية مع السلطات، التكيف السريع لنظام إدارة الجودة.</li>
                        </ul>
                    </p>
                    <p><strong>المخاطر التشغيلية:</strong>
                        <ul>
                            <li>اضطرابات سلسلة التوريد (جيوسياسية، فشل الموردين). <em>التخفيف:</em> تنويع الموردين، التخزين الاستراتيجي للمكونات الحيوية، عملية تخطيط مبيعات وعمليات قوية.</li>
                            <li>عيوب التصنيع المؤدية إلى عمليات سحب المنتجات. <em>التخفيف:</em> نظام إدارة جودة صارم، صيانة وقائية، تدريب مستمر للموظفين، الاستثمار في تقنيات الفحص.</li>
                        </ul>
                    </p>
                    <p><strong>المخاطر المالية:</strong>
                        <ul>
                            <li>نقص السيولة بسبب دورات الدفع الممتدة من العملاء. <em>التخفيف:</em> إدارة حكيمة للتدفقات النقدية، استكشاف خيارات التخصيم أو تمويل سلسلة التوريد.</li>
                            <li>تقلبات أسعار العملات للمواد الخام المستوردة. <em>التخفيف:</em> استراتيجيات التحوط عند الاقتضاء، التفاوض على عقود طويلة الأجل بالعملة المحلية.</li>
                        </ul>
                    </p>
                </div>
                <div class="recommendation-box">
                    <h4>الضرورة الاستراتيجية الرئيسية لشركة ميس السعودية</h4>
                    <p>يجب على شركة ميس السعودية ترسيخ مكانتها كشركة رائدة في مجال المستهلكات الطبية عالية الجودة والمصنعة محليًا داخل المملكة من خلال الاستفادة من إمكانات برنامج اكتفاء وقوتها التشغيلية. وفي الوقت نفسه، فإن التوسع الإقليمي الحذر والمدروس، إلى جانب ابتكار المنتجات في المجالات المتخصصة، سيدفع النمو المستدام. يتطلب هذا تركيزًا مزدوجًا على التميز التشغيلي لإدارة التكاليف والابتكار لتلبية احتياجات الرعاية الصحية المتطورة، وكل ذلك مدعومًا بانضباط مالي قوي وإدارة استباقية للمخاطر.</p>
                </div>
            `;
        }

        function generateQualityAnalysisResponseAr(data) {
             return `
                <h1>مراجعة نظام إدارة الجودة لشركة ميس السعودية</h1>
                ${data ? `<div class="analysis-result-card"><p><strong>رؤية من البيانات:</strong> كانت مقاييس الجودة والوثائق من الملف المقدم لشركة ميس السعودية (مثل تقارير التدقيق، سجلات CAPA، معدلات العيوب) محورية في هذا التقييم.</p></div>` : '<div class="analysis-result-card"><p><strong>رؤية من البيانات:</strong> تقييم مبني على مبادئ QMS العامة لمصنعي الأجهزة الطبية مثل شركة ميس السعودية، مع الالتزام بـ ISO 13485 وإرشادات الهيئة العامة للغذاء والدواء.</p></div>'}
                
                <div class="analysis-result-card">
                    <h2>1. الفعالية الإجمالية لنظام إدارة الجودة وحالة الامتثال</h2>
                    <p>يشكل نظام إدارة الجودة الخاص بشركة ميس السعودية، والذي يُفترض أنه معتمد وفقًا لمعيار ISO 13485، العمود الفقري لالتزامها بإنتاج مستهلكات طبية آمنة وفعالة ذات استخدام واحد. تُقيّم الفعالية بناءً على قدرته على تلبية توقعات العملاء والمتطلبات التنظيمية الصارمة باستمرار، لا سيما تلك التي وضعتها الهيئة العامة للغذاء والدواء السعودية (SFDA).</p>
                    <p><strong>أبرز نقاط التحقق من الامتثال (ISO 13485:2016 و SFDA):</strong>
                        <ul>
                            <li><strong>مسؤولية الإدارة:</strong> التزام واضح من الإدارة العليا، سياسة وأهداف جودة محددة.</li>
                            <li><strong>إدارة الموارد:</strong> بنية تحتية كافية، موظفون أكفاء، وبيئة عمل خاضعة للرقابة.</li>
                            <li><strong>تحقيق المنتج:</strong> عمليات قوية للتصميم والتطوير (إذا انطبق)، ضوابط الشراء، توفير الإنتاج والخدمة (بما في ذلك التحقق من صحة التعقيم، التحقق من صحة العمليات الحرجة مثل الختم والقولبة).</li>
                            <li><strong>القياس والتحليل والتحسين:</strong> أنظمة فعالة لرصد وقياس العمليات/المنتجات، التدقيق الداخلي، التحكم في المنتج غير المطابق، الإجراءات التصحيحية والوقائية (CAPA)، والمراقبة بعد التسويق.</li>
                            <li><strong>متطلبات SFDA الخاصة:</strong> متطلبات إذن تسويق الأجهزة الطبية (MDMA)، تطبيق نظام التعريف الفريد للجهاز (UDI)، الإبلاغ عن الأحداث السلبية.</li>
                        </ul>
                    </p>
                    <div class="metric-card">
                        <div class="metric-label">نتائج التدقيق الخارجي (SFDA/جهة معتمدة - حالات عدم مطابقة كبرى - آخر عامين)</div>
                        <div class="metric-value">${data ? '0 (مثال)' : 'غير متوفر (يعتمد على البيانات)'} <span class="quality-indicator ${data ? 'quality-excellent' : 'quality-warning'}">${data ? 'ممتاز' : 'بانتظار البيانات'}</span></div>
                        <p style="font-size:0.8em; opacity:0.7;">(مقياس توضيحي؛ سيتم استخدام نتائج التدقيق الفعلية)</p>
                    </div>
                </div>

                <div class="analysis-result-card">
                    <h2>2. تحليل مفصل للعيوب واتجاهات عدم المطابقة</h2>
                    <p>تُعد المراجعة المنهجية لبيانات العيوب الداخلية (مثل معدلات الخردة، نسب إعادة العمل، معدلات رفض المواد الواردة) والبيانات الخارجية (شكاوى العملاء، الإجراءات التصحيحية الميدانية) أمرًا ضروريًا.
                    ${data ? `<em>ستسمح البيانات المقدمة (مثل مخططات باريتو للعيوب، سجلات الشكاوى) بتحديد اتجاهات محددة، مثل 'X% من العيوب المتعلقة بأختام التعبئة والتغليف للمنتج Y' أو 'عدم مطابقة متكررة في مكونات المورد Z'.</em>` : `<em>البيانات التفصيلية للعيوب وعدم المطابقة ضرورية لتحليل الاتجاهات بدقة وتحديد الأسباب الجذرية.</em>`}
                    </p>
                    <p><strong>مؤشرات الأداء الرئيسية (KPIs) للمراقبة:</strong>
                        <ol>
                            <li>الإنتاجية من المرة الأولى (FPY) لخطوات التصنيع الحرجة.</li>
                            <li>معدل الخروج عن المواصفات (OOS) للمنتجات النهائية.</li>
                            <li>عدد الإجراءات التصحيحية والوقائية المفتوحة ومتوسط دورة الإجراءات التصحيحية والوقائية.</li>
                            <li>معدل عيوب الموردين (PPM).</li>
                        </ol>
                    </p>
                </div>

                <div class="analysis-result-card">
                    <h2>3. تقييم التعامل مع شكاوى العملاء والمراقبة بعد التسويق</h2>
                    <p>يُعد نظام معالجة الشكاوى الفعال (وفقًا لمتطلبات ISO 13485 و SFDA) أمرًا حيويًا لتحديد مشكلات المنتج وضمان سلامة المرضى ودفع التحسين المستمر. ويشمل ذلك الاستلام في الوقت المناسب، والتحقيق، وتحليل الأسباب الجذرية، والإبلاغ (إذا لزم الأمر)، وتنفيذ الإجراءات التصحيحية/الوقائية.</p>
                    <p><strong>أنشطة المراقبة بعد التسويق (PMS) لشركة ميس السعودية:</strong>
                        <ul>
                            <li>جمع منهجي للملاحظات من المستخدمين والموزعين.</li>
                            <li>مراقبة الأدبيات العلمية وعمليات سحب المنتجات المنافسة.</li>
                            <li>تقارير تحديث السلامة الدورية (PSURs) إذا انطبق.</li>
                            <li>تحليل استباقي لاتجاهات بيانات PMS للكشف عن إشارات الإنذار المبكر.</li>
                        </ul>
                    </p>
                    <div class="critical-box">
                        <h4>مجال التركيز: فعالية نظام CAPA</h4>
                        <p>يجب ألا يعالج نظام CAPA الأعراض فحسب، بل يجب أن يزيل الأسباب الجذرية بفعالية لمنع تكرارها. تُعد عمليات التحقق المنتظمة من فعالية الإجراءات التصحيحية والوقائية المنفذة أمرًا بالغ الأهمية. إذا أظهرت البيانات معدلات تكرار عالية لمشكلات مماثلة، فإن نظام CAPA بحاجة إلى تعزيز.</p>
                    </div>
                </div>
                
                <div class="analysis-result-card">
                    <h2>4. خطة تحسين جودة عملية وقابلة للتنفيذ لشركة ميس السعودية</h2>
                    <p>بناءً على تقييم شامل لنظام إدارة الجودة، تُقترح التوصيات التالية ذات الأولوية:</p>
                    <ol>
                        <li><strong>تعزيز التفكير القائم على المخاطر (ISO 14971 و ISO 13485):</strong> ضمان دمج إدارة المخاطر بشكل كامل في جميع عمليات نظام إدارة الجودة، من التصميم واختيار الموردين إلى الإنتاج وأنشطة ما بعد التسويق لجميع المستهلكات الطبية. مراجعة وتحديث ملفات إدارة المخاطر بانتظام.</li>
                        <li><strong>تحسين برنامج إدارة جودة الموردين:</strong> تطبيق تصنيف متدرج للموردين بناءً على المخاطر. إجراء عمليات تدقيق ميدانية أكثر صرامة للموردين الحرجين. وضع اتفاقيات جودة واضحة تحدد المواصفات ومراقبة التغيير.</li>
                        <li><strong>الاستثمار في حلول نظام إدارة الجودة الرقمي (eQMS):</strong> الانتقال من الأنظمة الورقية أو المتباينة إلى نظام eQMS متكامل لتبسيط التحكم في المستندات، وإدارة التدريب، وتتبع CAPA، وجدولة التدقيق، وإدارة التغيير. هذا يحسن الكفاءة والتتبع وسلامة البيانات.</li>
                        <li><strong>برنامج تدريب قائم على الكفاءة:</strong> تطوير وتنفيذ مصفوفة تدريب خاصة بكل دور وظيفي. ضمان تدريب تنشيطي منتظم على إجراءات نظام إدارة الجودة، والممارسات التوزيعية الجيدة (GDP)، والممارسات التصنيعية الجيدة (GMP)، والتحديثات التنظيمية (SFDA، ISO). قياس فعالية التدريب.</li>
                        <li><strong>ثقافة الجودة الاستباقية:</strong> تعزيز ثقافة تكون فيها الجودة مسؤولية الجميع. تنفيذ دوائر الجودة أو فرق التحسين المستمر. تشجيع الإبلاغ عن المشكلات المحتملة دون خوف من العقاب.</li>
                        <li><strong>تحليلات البيانات لاستخبارات الجودة:</strong> استخدام التحكم الإحصائي في العمليات (SPC) عند الاقتضاء. تنفيذ لوحات معلومات لمراقبة مؤشرات الأداء الرئيسية للجودة في الوقت الفعلي، مما يتيح اتخاذ قرارات تعتمد على البيانات لإجراء تحسينات استباقية.</li>
                    </ol>
                </div>
                <div class="recommendation-box">
                    <h4>فلسفة الجودة الأساسية لشركة ميس السعودية</h4>
                    <p>يجب أن تسعى شركة ميس السعودية جاهدة لتبني فلسفة جودة "صحيح من المرة الأولى"، والانتقال من مجرد الامتثال إلى حالة من ضمان الجودة الاستباقي والتحسين المستمر. يتضمن ذلك تمكين الموظفين، والاستفادة من البيانات، ودمج إدارة المخاطر بشكل كامل في جميع العمليات لضمان التسليم المتسق لمستهلكات طبية آمنة وفعالة وعالية الجودة للأسواق السعودية والإقليمية.</p>
                </div>
            `;
        }

        function generateDemandForecastResponseAr(data) {
            return `
                <h1>توقعات الطلب وتحسين المخزون لشركة ميس السعودية</h1>
                ${data ? `<div class="analysis-result-card"><p><strong>رؤية من البيانات:</strong> ساهمت بيانات المبيعات التاريخية ومستويات المخزون وبيانات السوق من الملف المقدم لمستهلكات شركة ميس السعودية الطبية ذات الاستخدام الواحد في تشكيل هذه التوقعات واستراتيجية المخزون.</p></div>` : '<div class="analysis-result-card"><p><strong>رؤية من البيانات:</strong> توقعات واستراتيجية مخزون مبنية على اتجاهات السوق العامة للمستهلكات الطبية في الشرق الأوسط، مطبقة على شركة ميس السعودية، مع مراعاة عوامل مثل توسع الرعاية الصحية ضمن رؤية 2030.</p></div>'}
                
                <div class="analysis-result-card">
                    <h2>1. تحليل شامل للطلب</h2>
                    <p>يُعد تحليل بيانات المبيعات التاريخية (مثل آخر 3-5 سنوات) لخطوط إنتاج شركة ميس السعودية (مثل القفازات الجراحية، أطقم الحقن الوريدي، المحاقن، ضمادات الجروح) أمرًا بالغ الأهمية. يتضمن ذلك تحديد:</p>
                    <ul>
                        <li><strong>الطلب الأساسي:</strong> مستوى الطلب الأساسي لكل فئة منتج.</li>
                        <li><strong>الاتجاهات:</strong> اتجاهات تصاعدية أو تنازلية أو مستقرة في الطلب.</li>
                        <li><strong>الموسمية:</strong> التقلبات المتوقعة (مثل زيادة الطلب على منتجات الجهاز التنفسي خلال موسم الأنفلونزا).</li>
                        <li><strong>الدورية:</strong> الدورات الاقتصادية أو السوقية طويلة الأجل.</li>
                        <li><strong>تأثير العوامل الخارجية:</strong> تأثير مبادرات الصحة العامة (مثل حملات التطعيم)، افتتاح مستشفيات جديدة (مدفوعة برؤية 2030)، أنشطة المنافسين، والتغييرات التنظيمية.</li>
                    </ul>
                    ${data ? `<p><em>ستمكّن البيانات المقدمة من إجراء تحليل كمي، على سبيل المثال، تحديد اتجاه نمو سنوي بنسبة 10% للمنتج X، أو ذروة موسمية في الربع الرابع للمنتج Y.</em></p>` : `<p><em>البيانات التاريخية التفصيلية للمبيعات حسب وحدة حفظ المخزون/الفئة ضرورية لإجراء تحليل كمي دقيق.</em></p>`}
                </div>

                <div class="analysis-result-card">
                    <h2>2. نتائج التوقعات (للأشهر الـ 12-18 القادمة)</h2>
                    <p>بناءً على تحليل الطلب، يمكن للنماذج الإحصائية للتنبؤ (مثل ARIMA، التمهيد الأسي) جنبًا إلى جنب مع المدخلات النوعية (معلومات السوق، ملاحظات فريق المبيعات) أن تولد توقعات. فيما يلي توقعات توضيحية لفئات المنتجات الرئيسية:</p>
                    <h4>توقعات طلب توضيحية لشركة ميس السعودية (وحدات)</h4>
                    <table>
                        <thead><tr><th>فئة المنتج</th><th>الـ 6 أشهر القادمة</th><th>الـ 12 شهرًا القادمة</th><th>الافتراضات الرئيسية</th></tr></thead>
                        <tbody>
                            <tr><td>قفازات جراحية معقمة (أزواج)</td><td>${data ? '2,800,000' : '2,500,000'}</td><td>${data ? '5,800,000' : '5,200,000'}</td><td>استمرار نشاط المستشفيات، نمو معتدل في الحصة السوقية.</td></tr>
                            <tr><td>محاقن للاستخدام مرة واحدة (وحدات)</td><td>${data ? '12,000,000' : '10,000,000'}</td><td>${data ? '25,000,000' : '22,000,000'}</td><td>برامج الصحة العامة، طلب مؤسسي مستقر.</td></tr>
                            <tr><td>ضمادات جروح متقدمة (وحدات)</td><td>${data ? '300,000' : '250,000'}</td><td>${data ? '650,000' : '550,000'}</td><td>زيادة الاعتماد، إطلاق منتجات جديدة من قبل شركة ميس.</td></tr>
                        </tbody>
                    </table>
                    <div class="metric-card">
                        <div class="metric-label">دقة التوقعات الإجمالية (متوسط الخطأ المطلق المئوي المستهدف)</div>
                        <div class="metric-value">&lt; 15% <span class="quality-indicator quality-good">هدف جيد</span></div>
                        <p style="font-size:0.8em; opacity:0.7;">(تحقيق هذا يتطلب بيانات ونماذج قوية)</p>
                    </div>
                </div>

                <div class="analysis-result-card">
                    <h2>3. استراتيجية تحسين المخزون</h2>
                    <p>الهدف هو تحقيق التوازن بين تكاليف الاحتفاظ بالمخزون ومستويات الخدمة (تقليل حالات نفاد المخزون). توصيات لشركة ميس السعودية:</p>
                    <ul>
                        <li><strong>تحليل ABC:</strong> تصنيف مواد المخزون بناءً على القيمة/الحجم (مواد A: قيمة عالية، مواد B: متوسطة، مواد C: منخفضة). تطبيق رقابة أكثر صرامة ومراجعة أكثر تكرارًا لمواد A.</li>
                        <li><strong>حساب مخزون الأمان:</strong> تحديد مستويات مخزون الأمان المناسبة لكل وحدة حفظ مخزون بناءً على تقلب الطلب، وتقلب مهلة التوريد من المورد، ومستوى الخدمة المطلوب (مثل 98% للمواد الحرجة).</li>
                        <li><strong>نقطة إعادة الطلب (ROP) والكمية الاقتصادية للطلب (EOQ):</strong> حساب نقاط إعادة الطلب لتشغيل أوامر التجديد. استخدام نماذج EOQ (بحذر، مع مراعاة مدة الصلاحية للمنتجات المعقمة) لتحديد أحجام الطلبات المثلى.</li>
                        <li><strong>مراقبة المخزون:</strong> تنفيذ جرد دوري منتظم وجرد كامل دوري لضمان دقة المخزون. تتبع مؤشرات الأداء الرئيسية مثل دوران المخزون، وأيام المخزون المتاح (DOH).</li>
                        <li><strong>المخزون بطيء الحركة والمتقادم (SLOB):</strong> إنشاء عملية لتحديد وإدارة المخزون بطيء الحركة والمتقادم لتقليل عمليات الشطب.</li>
                    </ul>
                    ${data ? `<div class="warning-box"><h4>تحديد محتمل لمخزون بطيء الحركة (مثال من البيانات)</h4><p>إذا أظهرت البيانات أن المنتج Z لم يتم بيعه خلال 12 شهرًا ويوجد منه 5000 وحدة في المخزون، فإن خطة للتصرف (مثل الخصم، التبرع، التخلص) ضرورية.</p></div>` : ''}
                </div>

                <div class="analysis-result-card">
                    <h2>4. خارطة طريق التنفيذ</h2>
                    <ol>
                        <li><strong>تنقية البيانات وتكامل الأنظمة (الأشهر 1-3):</strong> ضمان دقة بيانات المبيعات والمخزون التاريخية. دمج وحدة التنبؤ مع أنظمة تخطيط موارد المؤسسات/إدارة سلسلة التوريد.</li>
                        <li><strong>اختيار النماذج وضبط المعلمات (الأشهر 2-4):</strong> اختيار نماذج التنبؤ المناسبة لقطاعات المنتجات المختلفة. تدريب فريق التخطيط على برامج التنبؤ.</li>
                        <li><strong>البرنامج التجريبي (الأشهر 4-6):</strong> تنفيذ سياسات التنبؤ والمخزون الجديدة لمجموعة مختارة من المنتجات. مراقبة النتائج وتحسين العمليات.</li>
                        <li><strong>التطبيق الكامل والتحسين المستمر (الأشهر 7+):</strong> توسيع العمليات الجديدة لتشمل جميع خطوط الإنتاج. إنشاء دورة تخطيط مبيعات وعمليات (S&OP) منتظمة لمراجعة التوقعات والمخزون والمواءمة مع أهداف العمل.</li>
                    </ol>
                </div>
                <div class="recommendation-box">
                    <h4>الإدارة الاستراتيجية للمخزون لشركة ميس السعودية</h4>
                    <p>يجب أن تنتقل شركة ميس السعودية نحو نظام تنبؤ بالطلب وإدارة مخزون استباقي يعتمد على البيانات. لن يؤدي هذا إلى تقليل التكاليف المرتبطة بالتخزين المفرط أو نفاد المخزون فحسب، بل سيؤدي أيضًا إلى تحسين رضا العملاء والكفاءة التشغيلية، مما يهيئ الشركة للنمو القابل للتطوير في سوق المستهلكات الطبية الديناميكي.</p>
                </div>
            `;
        }

        function generateCompetitorAnalysisResponseAr(data) {
            return `
                <h1>تحليل المشهد التنافسي لشركة ميس السعودية</h1>
                ${data ? `<div class="analysis-result-card"><p><strong>رؤية من البيانات:</strong> تم دمج معلومات المنافسين وتقارير السوق وبيانات التسعير من الملف المقدم في هذا التحليل لوضع شركة ميس السعودية في سوق المستهلكات الطبية ذات الاستخدام الواحد.</p></div>` : '<div class="analysis-result-card"><p><strong>رؤية من البيانات:</strong> تحليل مبني على المعرفة العامة بسوق المستهلكات الطبية في المملكة العربية السعودية والشرق الأوسط، مع التركيز على اللاعبين ذوي الصلة بشركة ميس السعودية.</p></div>'}
                
                <div class="analysis-result-card">
                    <h2>1. نظرة عامة مفصلة على المشهد السوقي (المملكة وأسواق دول مجلس التعاون الرئيسية)</h2>
                    <p>تقدر قيمة سوق المستهلكات الطبية ذات الاستخدام الواحد في المملكة العربية السعودية بحوالي X.X مليار ريال سعودي (تقديرات 2023) ومن المتوقع أن ينمو بمعدل نمو سنوي مركب Y.Y% حتى عام 2028. تشمل القطاعات الرئيسية:
                        <ul>
                            <li>اللوازم العامة (القفازات، الكمامات، المحاقن، القساطر)</li>
                            <li>منتجات العناية بالجروح</li>
                            <li>منتجات مكافحة العدوى</li>
                            <li>مستهلكات الحقن الوريدي وإيصال الأدوية</li>
                        </ul>
                    تشمل الدوافع استثمارات رؤية 2030 في الرعاية الصحية، وزيادة أحجام العمليات الجراحية، والتركيز المتزايد على الوقاية من العدوى. يفضل برنامج اكتفاء المصنعين المحليين مثل شركة ميس السعودية.
                    </p>
                </div>

                <div class="analysis-result-card">
                    <h2>2. تقييم تنافسي متعمق</h2>
                    <p>تنافس شركة ميس السعودية (تأسست عام 1994، الرياض) ضد مزيج من اللاعبين:</p>
                    <h4>ملفات تعريف المنافسين الرئيسيين (توضيحي):</h4>
                    <ol>
                        <li>
                            <strong>شركة جلوبال ميد (شركة متعددة الجنسيات):</strong>
                            <ul>
                                <li><strong>نقاط القوة:</strong> محفظة منتجات واسعة، بحث وتطوير قوي، اعتراف عالمي بالعلامة التجارية، توزيع راسخ.</li>
                                <li><strong>نقاط الضعف:</strong> نقاط سعر أعلى محتملة، مرونة أقل في الاستجابة لاحتياجات السوق المحلية مقارنة باللاعبين المحليين.</li>
                                <li><strong>الاستراتيجية:</strong> التركيز على القطاعات المتميزة، الابتكار، والعقود المؤسسية الكبيرة.</li>
                            </ul>
                        </li>
                        <li>
                            <strong>شركة الحلول الصحية العربية (موزع/مستورد إقليمي كبير):</strong>
                            <ul>
                                <li><strong>نقاط القوة:</strong> شبكة توزيع واسعة، مصادر منتجات متنوعة (بما في ذلك خيارات منخفضة التكلفة)، علاقات قوية مع القطاع الخاص.</li>
                                <li><strong>نقاط الضعف:</strong> الاعتماد على لوجستيات الاستيراد، تصور جودة متغير لبعض المنتجات المستوردة.</li>
                                <li><strong>الاستراتيجية:</strong> القدرة التنافسية السعرية، متجر شامل لمجموعة واسعة من المستهلكات.</li>
                            </ul>
                        </li>
                        <li>
                            <strong>شركة فيوتشرتك الطبية السعودية (مصنع محلي ناشئ):</strong>
                            <ul>
                                <li><strong>نقاط القوة:</strong> التركيز على مستهلكات معينة ذات حجم كبير، فوائد محتملة من برنامج اكتفاء، عمليات مرنة.</li>
                                <li><strong>نقاط الضعف:</strong> نطاق منتجات محدود، علامة تجارية أحدث، نطاق أصغر مقارنة بشركة ميس.</li>
                                <li><strong>الاستراتيجية:</strong> التركيز على سوق متخصص، إنتاج محلي فعال من حيث التكلفة.</li>
                            </ul>
                        </li>
                    </ol>
                    ${data ? `<p><em>بيانات المنافسين المحددة من الملف المرفوع (مثل تقديرات حصصهم السوقية، أسعار المنتجات المماثلة) ستعمل على تحسين هذه الملفات التعريفية.</em></p>` : ''}
                </div>

                <div class="analysis-result-card">
                    <h2>3. تحليل مقارن: شركة ميس السعودية مقابل المنافسين</h2>
                    <table>
                        <thead><tr><th>العامل</th><th>شركة ميس السعودية</th><th>شركة جلوبال ميد</th><th>الحلول الصحية العربية</th><th>فيوتشرتك الطبية</th></tr></thead>
                        <tbody>
                            <tr><td><strong>جودة المنتج (ISO 13485)</strong></td><td>عالية</td><td>عالية جدًا</td><td>متغيرة</td><td>متوسطة-عالية</td></tr>
                            <tr><td><strong>نقطة السعر</strong></td><td>متوسطة المدى</td><td>متميزة</td><td>منخفضة-متوسطة</td><td>تنافسية</td></tr>
                            <tr><td><strong>التصنيع المحلي (اكتفاء)</strong></td><td>قوي</td><td>محدود/لا يوجد</td><td>لا يوجد</td><td>قوي</td></tr>
                            <tr><td><strong>نطاق المنتج</strong></td><td>متوسط</td><td>واسع</td><td>واسع جدًا</td><td>ضيق</td></tr>
                            <tr><td><strong>شبكة التوزيع (السعودية)</strong></td><td>جيدة</td><td>قوية</td><td>قوية جدًا</td><td>قيد التطوير</td></tr>
                            <tr><td><strong>الابتكار/البحث والتطوير</strong></td><td>قيد التطوير</td><td>عالي</td><td>منخفض (توفير مصادر)</td><td>منخفض-متوسط</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="analysis-result-card">
                    <h2>4. تحديد الفرص والتهديدات لشركة ميس السعودية</h2>
                    <p><strong>الفرص:</strong>
                        <ul>
                            <li>الاستفادة من برنامج اكتفاء للوصول التفضيلي إلى المناقصات الحكومية.</li>
                            <li>التوسع في قطاعات المستهلكات المتخصصة غير المخدومة بشكل كافٍ.</li>
                            <li>تطوير أسواق التصدير في دول مجلس التعاون الخليجي/الشرق الأوسط وشمال أفريقيا.</li>
                            <li>تشكيل تحالفات استراتيجية مع مقدمي الرعاية الصحية المحليين لعقود طويلة الأجل.</li>
                            <li>الابتكار في المستهلكات الطبية الصديقة للبيئة/المستدامة.</li>
                        </ul>
                    </p>
                    <p><strong>التهديدات:</strong>
                        <ul>
                            <li>منافسة سعرية شديدة، خاصة من مستوردي المنتجات الآسيوية منخفضة التكلفة.</li>
                            <li>التطورات التكنولوجية السريعة من قبل الشركات متعددة الجنسيات التي تتطلب استثمارًا مستمرًا.</li>
                            <li>التغييرات في لوائح الهيئة العامة للغذاء والدواء التي تؤثر على تسجيل المنتجات أو تكاليف الامتثال.</li>
                            <li>اندماج مقدمي الرعاية الصحية مما يزيد من قوتهم التفاوضية.</li>
                        </ul>
                    </p>
                </div>

                <div class="analysis-result-card">
                    <h2>5. توصيات استراتيجية لشركة ميس السعودية</h2>
                    <ol>
                        <li><strong>تعزيز عرض القيمة:</strong> التأكيد على "الجودة السعودية الموثوقة، والموثوقية، والاستجابة". تطوير رسائل واضحة حول فوائد برنامج اكتفاء للعملاء.</li>
                        <li><strong>نهج سوقي مجزأ:</strong>
                            <ul>
                                <li>للمنتجات ذات الحجم الكبير والموحدة: التركيز على تحسين التكاليف والتسعير التنافسي مع الحفاظ على الجودة.</li>
                                <li>للمنتجات المتخصصة/الفريدة: التركيز على التمايز، والفوائد السريرية، والخدمات ذات القيمة المضافة.</li>
                            </ul>
                        </li>
                        <li><strong>تحسين المبيعات والتسويق:</strong> الاستثمار في فريق مبيعات ماهر يتمتع بمعرفة سريرية قوية. تطوير استراتيجيات تسويق رقمي للوصول إلى جمهور أوسع. المشاركة في المعارض الصحية الإقليمية الرئيسية.</li>
                        <li><strong>مراقبة المعلومات التنافسية:</strong> إنشاء نظام لتتبع أنشطة المنافسين بانتظام، وإطلاق المنتجات الجديدة، وتغييرات الأسعار، واتجاهات السوق.</li>
                        <li><strong>بناء ولاء العملاء:</strong> تنفيذ برامج للحسابات الرئيسية، وتقديم دعم ممتاز لما بعد البيع، وجمع ملاحظات العملاء للتحسين المستمر.</li>
                    </ol>
                </div>
                <div class="recommendation-box">
                    <h4>الميزة التنافسية لشركة ميس السعودية</h4>
                    <p>يكمن طريق شركة ميس السعودية نحو ميزة تنافسية مستدامة في ثلاثية: 1) الالتزام الثابت بالجودة المتوافقة مع الهيئة العامة للغذاء والدواء والتميز في التصنيع المحلي (اكتفاء). 2) الاستجابة السريعة للاحتياجات المحددة لأسواق الرعاية الصحية السعودية والإقليمية. 3) إدارة استراتيجية لمحفظة المنتجات توازن بين الحجم والقيمة. من خلال التركيز على هذه الركائز، يمكن لشركة ميس أن تنافس بفعالية ضد كل من الشركات العالمية العملاقة واللاعبين المحليين المرنين.</p>
                </div>
            `;
        }

        function generateComprehensiveAnalysisResponseAr() {
            return `
                <h1>تحليل استراتيجي شامل: شركة ميس السعودية للمنتجات الطبية</h1>
                <div class="analysis-result-card">
                    <h2>1. ملخص تنفيذي</h2>
                    <p>تُعتبر شركة ميس السعودية للمنتجات الطبية، وهي شركة مصنعة للمستهلكات الطبية ذات الاستخدام الواحد مقرها الرياض منذ عام 1994، كيانًا محليًا هامًا ملتزمًا بمعايير الجودة العالمية العالية (ISO 13485، الامتثال لمتطلبات الهيئة العامة للغذاء والدواء). تعمل الشركة ضمن سوق رعاية صحية سعودي وشرق أوسطي ديناميكي ومتنامٍ، يتشكل بفعل رؤية 2030، وبرنامج اكتفاء، والضغوط التنافسية المتطورة. ورغم امتلاكها أساسًا متينًا في التصنيع المحلي والجودة، تواجه شركة ميس السعودية تحديات تتعلق بالأداء المالي، والكفاءة التشغيلية، والتموضع الاستراتيجي. يقدم هذا التحليل خارطة طريق شاملة لمواجهة هذه التحديات، والاستفادة من الفرص، وضمان النمو المستدام وتعزيز الريادة في السوق.</p>
                </div>

                <div class="analysis-result-card">
                    <h2>2. الوضع المالي الحالي واستراتيجيات التعافي الممكنة</h2>
                    <p>من المرجح أن الشركة تعاني من ضغوط على الربحية بسبب ارتفاع تكاليف المدخلات والمنافسة السعرية، وقيود سيولة محتملة بسبب عدم كفاءة رأس المال العامل. يجب أن تركز خطة التعافي القوية على:</p>
                    <ul>
                        <li><strong>تحسين التكاليف بشكل صارم:</strong> تطبيق مبادئ التصنيع الخالي من الهدر عبر جميع خطوط إنتاج المستهلكات الطبية. استهداف خفض تكلفة البضائع المباعة (COGS) بنسبة 10-15٪ على مدى 18-24 شهرًا من خلال تقليل الفاقد، وتحسين العمليات، وكفاءة الطاقة. التدقيق في المصروفات البيعية والإدارية والعامة.</li>
                        <li><strong>إدارة رأس المال العامل:</strong>
                            <ul>
                                <li><strong>المخزون:</strong> خفض أيام المخزون المتاح (DOH) بنسبة 15-20٪ من خلال تحسين توقعات الطلب ومبادئ الإنتاج في الوقت المناسب (JIT) للمواد غير الحرجة. تنفيذ برنامج لخفض المخزون بطيء الحركة والمتقادم (SLOB).</li>
                                <li><strong>الذمم المدينة:</strong> خفض متوسط فترة التحصيل (DSO) من خلال تشديد سياسات الائتمان (حيثما أمكن) وتحسين جهود التحصيل. استهداف متوسط فترة تحصيل أقل من 60 يومًا.</li>
                                <li><strong>الذمم الدائنة:</strong> التفاوض على شروط دفع مواتية مع الموردين الرئيسيين دون تعريض العلاقات للخطر.</li>
                            </ul>
                        </li>
                        <li><strong>تعزيز الربحية:</strong> مراجعة استراتيجية التسعير لخطوط الإنتاج الرئيسية. التركيز على المستهلكات ذات الهامش الأعلى. استكشاف خدمات ذات قيمة مضافة (مثل الأطقم المخصصة، إدارة المخزون للمستشفيات).</li>
                        <li><strong>إعادة هيكلة الديون (إن وجدت):</strong> إذا كانت مستويات الديون مرتفعة، استكشاف خيارات لإعادة التمويل بشروط أفضل أو التفاوض مع المقرضين لجداول سداد أكثر مرونة.</li>
                    </ul>
                    <div class="critical-box">
                        <h4>إجراء عاجل: تعزيز التدفق النقدي ودفع الربحية</h4>
                        <p>تنفيذ تدابير فورية لتحسين دورة تحويل النقد. إجراء تحليل ربحية شامل حسب وحدة حفظ المخزون وشريحة العملاء. إيقاف أو إعادة تسعير المنتجات/الخدمات غير المربحة. إنشاء نظام شهري لتوقعات ومراقبة التدفق النقدي.</p>
                    </div>
                </div>

                <div class="analysis-result-card">
                    <h2>3. المركز السوقي والمشهد التنافسي (المستهلكات الطبية)</h2>
                    <p>تستفيد شركة ميس السعودية من وضعها "صنع في السعودية"، وسمعتها في الجودة، ووجودها الراسخ. ومع ذلك، تواجه منافسة شديدة.
                    <ul>
                        <li><strong>نقاط القوة:</strong> التصنيع المحلي (ميزة اكتفاء)، الامتثال لـ ISO 13485/SFDA، فهم الاحتياجات الإقليمية، علاقات راسخة.</li>
                        <li><strong>نقاط الضعف:</strong> هيكل تكلفة أعلى محتمل من بعض المستوردين، بحث وتطوير محدود للابتكارات الخارقة، تحديات وضوح العلامة التجارية مقابل الشركات متعددة الجنسيات.</li>
                        <li><strong>الفرص:</strong> توسع الرعاية الصحية ضمن رؤية 2030، زيادة الطلب على المحتوى المحلي، إمكانات التصدير إلى دول مجلس التعاون الخليجي/الشرق الأوسط وشمال أفريقيا، قطاعات المنتجات المتخصصة.</li>
                        <li><strong>التهديدات:</strong> حروب الأسعار، التغيرات التكنولوجية السريعة، الداخلون الجدد (محليون/دوليون)، التحولات التنظيمية.</li>
                    </ul>
                    تشمل الاستراتيجيات الرئيسية تعزيز مكانة العلامة التجارية حول "الجودة والموثوقية السعودية الموثوقة"، والتركيز على فئات المنتجات التي يوفر فيها التصنيع المحلي مزايا واضحة (مثل الاستجابة، التخصيص)، وتطوير شراكات استراتيجية أعمق مع هيئات شراء الرعاية الصحية العامة (نوبكو) والخاصة الرئيسية.
                    </p>
                    <div class="metric-card">
                        <div class="metric-label">الحصة السوقية المستهدفة في المملكة (مستهلكات مختارة - السنوات الثلاث القادمة)</div>
                        <div class="metric-value">18-20% <span class="quality-indicator quality-good">طموح ولكنه قابل للتحقيق</span></div>
                    </div>
                </div>

                <div class="analysis-result-card">
                    <h2>4. تقييم الكفاءة التشغيلية وخطة التحسين</h2>
                    <p>يجب أن يُستكمل التزام شركة ميس السعودية "بأعلى معايير الجودة العالمية" بالتميز التشغيلي.</p>
                    <ul>
                        <li><strong>رقمنة وتعزيز نظام إدارة الجودة:</strong> تنفيذ/ترقية إلى نظام إدارة جودة إلكتروني (eQMS) لتحسين الكفاءة في التحكم في المستندات، والإجراءات التصحيحية والوقائية، والتدقيق، والتدريب، وإدارة التغيير. التركيز على تحليلات البيانات من نظام إدارة الجودة لإجراء تحسينات استباقية.</li>
                        <li><strong>مرونة وتحسين سلسلة التوريد:</strong> تنويع قاعدة الموردين للمواد الخام الحيوية. تنفيذ عملية تخطيط مبيعات وعمليات قوية. تحسين الخدمات اللوجستية والتخزين لخفض التكاليف وتحسين أوقات التسليم.</li>
                        <li><strong>التميز في التصنيع:</strong> مواصلة مبادرات التصنيع الخالي من الهدر. الاستثمار في الأتمتة للمهام المتكررة حيث يكون عائد الاستثمار واضحًا. تنفيذ برنامج صيانة إنتاجية شاملة (TPM). التركيز على تقليل أوقات الدورات وتحسين الإنتاجية من المرة الأولى.</li>
                        <li><strong>تنمية رأس المال البشري:</strong> الاستثمار في تدريب وتطوير الموظفين في مجالات مثل التصنيع الخالي من الهدر، وتقنيات الجودة المتقدمة، والتقنيات الجديدة. تعزيز ثقافة التحسين المستمر.</li>
                    </ul>
                </div>

                <div class="analysis-result-card">
                    <h2>5. فرص النمو الاستراتيجية لشركة ميس السعودية</h2>
                    <ol>
                        <li><strong>تعظيم اكتفاء والمحتوى المحلي:</strong> مواءمة تطوير المنتجات وتوفير المصادر بشكل استراتيجي لتعظيم درجات اكتفاء، مما يعزز القدرة التنافسية في المناقصات الحكومية.</li>
                        <li><strong>توسيع خط الإنتاج بشكل مستهدف:</strong> التوسع بحذر في فئات المستهلكات الطبية المجاورة ذات الطلب المرتفع حيث يمكن لشركة ميس الاستفادة من القدرات الحالية (مثل الأطقم المعقمة المتخصصة، حلول مكافحة العدوى المتقدمة). إجراء أبحاث سوق شاملة قبل إطلاق منتجات جديدة.</li>
                        <li><strong>تنمية الصادرات الإقليمية المرحلية:</strong>
                            <ul>
                                <li><strong>المرحلة الأولى (1-2 سنوات):</strong> استهداف الإمارات العربية المتحدة والكويت وعمان بالمنتجات الأساسية عبر موزعين محليين أقوياء.</li>
                                <li><strong>المرحلة الثانية (3-5 سنوات):</strong> التوسع إلى أسواق واعدة أخرى في الشرق الأوسط وشمال أفريقيا (مثل مصر والأردن) والنظر في إنشاء مكاتب مبيعات إقليمية.</li>
                            </ul>
                        </li>
                        <li><strong>تكامل الصحة الرقمية (على المدى الطويل):</strong> استكشاف كيف يمكن لمستهلكات شركة ميس السعودية أن تتكامل مع حلول الصحة الرقمية الناشئة أو تدعمها (مثل التعبئة والتغليف الذكي، المستهلكات لأجهزة مراقبة المرضى عن بعد).</li>
                        <li><strong>التحالفات الاستراتيجية والمشاريع المشتركة:</strong> النظر في شراكات مع شركات تكنولوجيا طبية دولية لنقل التكنولوجيا أو التصنيع المشترك لمستهلكات أكثر تقدمًا في المملكة.</li>
                    </ol>
                </div>
                
                <div class="analysis-result-card">
                    <h2>6. خارطة طريق استراتيجية مفصلة ومؤشرات الأداء الرئيسية (KPIs)</h2>
                    <p><strong>المرحلة الأولى (0-12 شهرًا): الاستقرار وبناء الأساس</strong>
                        <ul>
                            <li><strong>التركيز:</strong> تحسين التدفق النقدي، خفض التكاليف، تعزيز نظام إدارة الجودة، تقوية المركز في السوق السعودي الأساسي.</li>
                            <li><strong>مؤشرات الأداء الرئيسية:</strong> تدفق نقدي تشغيلي إيجابي، خفض تكلفة البضائع المباعة بنسبة 10%، متوسط فترة تحصيل أقل من 75 يومًا، زيادة مبيعات المنتجات الأساسية في المملكة بنسبة 5%.</li>
                        </ul>
                    </p>
                    <p><strong>المرحلة الثانية (12-36 شهرًا): النمو والتحسين</strong>
                        <ul>
                            <li><strong>التركيز:</strong> نمو مربح في المملكة، نجاح تصدير أولي، تحسين محفظة المنتجات، مكاسب كفاءة تشغيلية.</li>
                            <li><strong>مؤشرات الأداء الرئيسية:</strong> هامش ربح صافي > 8%، إطلاق ناجح لخطين إنتاج جديدين، مساهمة الصادرات بنسبة 10% من الإيرادات، تحسين درجة اكتفاء بمقدار X نقطة.</li>
                        </ul>
                    </p>
                    <p><strong>المرحلة الثالثة (36+ شهرًا): الريادة في السوق والتنويع</strong>
                        <ul>
                            <li><strong>التركيز:</strong> تأسيس وجود إقليمي في السوق، استكشاف مشاريع مشتركة/تحالفات استراتيجية، الاستثمار في البحث والتطوير للجيل القادم من المستهلكات.</li>
                            <li><strong>مؤشرات الأداء الرئيسية:</strong> ضمن أفضل 3 لاعبين في المملكة لفئات المستهلكات الرئيسية، مساهمة الصادرات بأكثر من 20% من الإيرادات، مشروع مشترك ناجح أو استحواذ على تكنولوجيا.</li>
                        </ul>
                    </p>
                </div>

                <div class="recommendation-box">
                    <h4>الرؤية الاستراتيجية الشاملة لشركة ميس السعودية</h4>
                    <p>أن تصبح شركة ميس السعودية الشركة المصنعة السعودية الرائدة والمورد الإقليمي للمستهلكات الطبية عالية الجودة والمبتكرة ذات الاستخدام الواحد، معترف بها لتميزها التشغيلي، وتركيزها على العملاء، ومساهمتها الكبيرة في أهداف الرعاية الصحية لرؤية السعودية 2030 والشرق الأوسط الأوسع. تتطلب هذه الرؤية قيادة حاسمة، والتزامًا بالتحسين المستمر، واستثمارات استراتيجية في الأفراد والعمليات والتكنولوجيا.</p>
                </div>
            `;
        }

        function generateDefaultResponseAr(query) {
            return `
                <div class="analysis-result-card">
                    <h2>بخصوص استفسارك لشركة ميس السعودية: "${query.substring(0,100)}${query.length > 100 ? '...' : ''}"</h2>
                    <p>بصفتي يزيد AI، مستشارك الذكي المخصص لشركة ميس السعودية (شركة مصنعة للمستهلكات الطبية ذات الاستخدام الواحد مقرها الرياض منذ عام 1994، ملتزمة بالجودة العالية وتواجه حاليًا تحديات في الأعمال)، أنا هنا للمساعدة.</p>
                    <p>تتأثر عمليات شركة ميس السعودية بشكل كبير بتحول الرعاية الصحية ضمن رؤية السعودية 2030، ومعايير الجودة الصارمة (ISO 13485، متطلبات الهيئة العامة للغذاء والدواء)، وسوق الأجهزة الطبية التنافسي، والتوجه نحو المحتوى المحلي (برنامج اكتفاء). تشمل قدراتي تقديم تحليلات مفصلة حول:</p>
                    <ul>
                        <li>استراتيجية الأعمال المتقدمة</li>
                        <li>أنظمة إدارة الجودة (ISO 13485، SFDA)</li>
                        <li>توقعات الطلب وتحسين المخزون</li>
                        <li>تحليل المنافسين في قطاع المستهلكات الطبية</li>
                    </ul>
                    <p>لتحليل محدد يعتمد على البيانات، يرجى استخدام الأقسام المخصصة في هذه المنصة أو تحميل المستندات ذات الصلة. بدلاً من ذلك، يمكنك أن تطلب مني "تحليل شامل" للحصول على نظرة عامة كلية.</p>
                    <p>كيف يمكنني مساعدتك بشكل أكبر اليوم فيما يتعلق بوضع شركة ميس السعودية المحدد، أو سوقها للمستهلكات الطبية، أو استراتيجيات النمو والتعافي؟</p>
                </div>
            `;
        }


        function exportResults(section, format) {
            const contentElement = document.getElementById(`${section}AnalysisContent`);
            if (!contentElement) return;
            
            const rawHtmlContent = contentElement.innerHTML; 
            let textContent = new DOMParser().parseFromString(rawHtmlContent, "text/html").documentElement.textContent; 

            const timestamp = new Date().toISOString().replace(/:/g, '-').split('.')[0];
            const filename = `${section}_analysis_SaudiMaisCo_${timestamp}.${format}`;
            
            let exportContent = textContent;
            if (format === 'md') {
                exportContent = convertToMarkdown(rawHtmlContent); 
            } else if (format === 'pdf') {
                exportToPDF(rawHtmlContent, filename);
                return;
            }
            
            const blob = new Blob([exportContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function convertToMarkdown(htmlContent) {
            let md = htmlContent;
            // Convert headings
            md = md.replace(/<h1>(.*?)<\/h1>/gi, "# $1\n\n")
                   .replace(/<h2>(.*?)<\/h2>/gi, "## $1\n\n")
                   .replace(/<h3>(.*?)<\/h3>/gi, "### $1\n\n")
                   .replace(/<h4>(.*?)<\/h4>/gi, "#### $1\n\n");

            // Convert paragraphs
            md = md.replace(/<p>(.*?)<\/p>/gi, "$1\n\n");

            // Convert lists (basic)
            md = md.replace(/<ul>/gi, "").replace(/<\/ul>/gi, "")
                   .replace(/<ol>/gi, "").replace(/<\/ol>/gi, "")
                   .replace(/<li>(.*?)<\/li>/gi, (match, p1) => {
                       // Check if it's inside an OL by looking at the original structure (this is a heuristic)
                       // A more robust solution would parse the DOM structure.
                       // For now, we assume if the content starts with a number and dot, it's an ordered list item.
                       if (/^\s*\d+\.\s*/.test(p1.trim())) {
                           return p1.trim() + "\n"; // Keep the number if it's already there
                       }
                       return "- " + p1.trim() + "\n";
                   });
            
            // Convert bold and italic
            md = md.replace(/<strong>(.*?)<\/strong>/gi, "**$1**")
                   .replace(/<em>(.*?)<\/em>/gi, "*$1*");

            // Convert tables (very basic, assumes simple structure)
            md = md.replace(/<table>/gi, "\n").replace(/<\/table>/gi, "\n")
                   .replace(/<thead>/gi, "").replace(/<\/thead>/gi, "")
                   .replace(/<tbody>/gi, "").replace(/<\/tbody>/gi, "")
                   .replace(/<tr>/gi, "").replace(/<\/tr>/gi, "\n")
                   .replace(/<th>(.*?)<\/th>/gi, (match, p1) => `| ${p1.trim()} `)
                   .replace(/<td>(.*?)<\/td>/gi, (match, p1) => `| ${p1.trim()} `)
                   .replace(/(\n\|.*?)\n/g, (match, p1) => { // Add table header separator
                       const columns = (p1.match(/\|/g) || []).length -1;
                       if (columns > 0 && !match.includes('| --- |')) { // crude check if it's a header row
                           let separator = "\n";
                           for(let i=0; i<columns; i++) separator += "| --- ";
                           separator += "|\n";
                           return p1 + separator;
                       }
                       return p1 + "\n";
                   });
            
            // Convert divs with specific classes (like metric-card, recommendation-box) to blockquotes or styled sections
            md = md.replace(/<div class="metric-card">([\s\S]*?)<\/div>/gi, (match, content) => {
                const label = (content.match(/<div class="metric-label">([\s\S]*?)<\/div>/) || ["",""])[1].trim();
                const value = (content.match(/<div class="metric-value">([\s\S]*?)<\/div>/) || ["",""])[1].replace(/<span.*?>.*?<\/span>/gi, '').trim();
                return `> **${label}:** ${value}\n\n`;
            });
             md = md.replace(/<div class="recommendation-box">([\s\S]*?)<\/div>/gi, (match, content) => {
                const title = (content.match(/<h4>(.*?)<\/h4>/) || ["","Recommendation"])[1].trim();
                const text = content.replace(/<h4>.*?<\/h4>/, '').replace(/<[^>]+>/g, ' ').trim();
                return `> **${title}**\n> ${text}\n\n`;
            });
            md = md.replace(/<div class="warning-box">([\s\S]*?)<\/div>/gi, (match, content) => {
                const title = (content.match(/<h4>(.*?)<\/h4>/) || ["","Warning"])[1].trim();
                const text = content.replace(/<h4>.*?<\/h4>/, '').replace(/<[^>]+>/g, ' ').trim();
                return `> **⚠️ ${title}**\n> ${text}\n\n`;
            });
            md = md.replace(/<div class="critical-box">([\s\S]*?)<\/div>/gi, (match, content) => {
                const title = (content.match(/<h4>(.*?)<\/h4>/) || ["","Critical"])[1].trim();
                const text = content.replace(/<h4>.*?<\/h4>/, '').replace(/<[^>]+>/g, ' ').trim();
                return `> **‼️ ${title}**\n> ${text}\n\n`;
            });


            // Clean up remaining HTML tags
            md = md.replace(/<br\s*\/?>/gi, "\n")
                   .replace(/<[^>]+>/g, '') // Remove any other tags
                   .replace(/&lt;/g, '<').replace(/&gt;/g, '>') // Restore < and >
                   .replace(/&amp;/g, '&'); // Restore &

            // Normalize newlines and spacing
            md = md.replace(/\n{3,}/g, '\n\n').trim();
            
            md = `# ${translations[currentLanguage].pageTitle}\n## ${translations[currentLanguage].companyNameHeader}\n\n${md}`;
            md += `\n\n---\n*${translations[currentLanguage].generatedOn || 'Generated on'} ${new Date().toLocaleString(currentLanguage === 'ar' ? 'ar-SA' : 'en-US')}*`;
            return md;
        }


        function exportToPDF(htmlContent, filename) {
            alert(translations[currentLanguage].alertPdfExport);
            // Fallback to text export
            const section = filename.split('_')[0]; // Extract section name
            const textContent = new DOMParser().parseFromString(htmlContent, "text/html").documentElement.textContent;
            const blob = new Blob([textContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${section}_analysis_SaudiMaisCo_fallback.txt`; // Ensure fallback has .txt
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        async function startAnalysis(sectionName, promptBuilder) {
            const textInputEl = document.getElementById(`${sectionName}TextInput`);
            const textInput = textInputEl ? textInputEl.value : '';
            
            const focusInputEl = document.getElementById(`${sectionName}FocusInput`);
            const focusInputFileEl = document.getElementById(`${sectionName}FocusInputFile`);
            // Determine which focus input is active or has content
            let focusInput = '';
            if (document.getElementById(`${sectionName}-text`)?.classList.contains('active')) {
                focusInput = focusInputEl ? focusInputEl.value : '';
            } else if (document.getElementById(`${sectionName}-file`)?.classList.contains('active')) {
                focusInput = focusInputFileEl ? focusInputFileEl.value : '';
            }
            
            const fileDataContent = fileContents[sectionName] || ""; 
            const resultsContainer = document.getElementById(`${sectionName}Results`);
            const contentContainer = document.getElementById(`${sectionName}AnalysisContent`);

            if (!textInput && !fileDataContent && sectionName !== 'ai-chat') { // ai-chat doesn't require initial data
                alert(translations[currentLanguage].alertNoData);
                return;
            }

            const statusKeysMap = {
                'advanced': ['advancedStep1Text', 'advancedStep2Text', 'advancedStep3Text', 'advancedStep4Text'],
                'quality': ['qualityStep1Text', 'qualityStep2Text', 'qualityStep3Text', 'qualityStep4Text'],
                'demand': ['demandStep1Text', 'demandStep2Text', 'demandStep3Text', 'demandStep4Text'],
                'competitor': ['competitorStep1Text', 'competitorStep2Text', 'competitorStep3Text', 'competitorStep4Text']
            };
            
            if (statusKeysMap[sectionName]) {
                showAnalysisStatus(sectionName, statusKeysMap[sectionName]);
            }
            
            if (resultsContainer) resultsContainer.style.display = 'block';
            if (contentContainer) contentContainer.innerHTML = `<div class="loading-enhanced" style="margin: 20px auto; width: fit-content;"><div class="loading-dots"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div>${translations[currentLanguage].loadingAnalysisText}</div>`;
            
            const primaryDataForAnalysis = fileDataContent || textInput; // Prefer file content if available
            const prompt = promptBuilder(primaryDataForAnalysis, focusInput, currentLanguage); 
            
            try {
                const response = await callGeminiAPI(prompt, primaryDataForAnalysis); 
                if (contentContainer) contentContainer.innerHTML = formatContent(response); 
                saveAnalysisResults(sectionName, response);
            } catch (error) {
                if (contentContainer) contentContainer.innerHTML = translations[currentLanguage].analysisFailedMsg;
                console.error("Analysis failed:", error);
            }
        }
        
        function startAdvancedAnalysis() {
            startAnalysis('advanced', (data, focus, lang) => {
                const companyContextEn = "As an expert business analyst for Saudi Mais Co. for Medical Products (a leading manufacturer of single-use medical consumables in the Middle East, founded in 1994 in Riyadh, committed to highest international quality standards):";
                const companyContextAr = "بصفتك خبير تحليل أعمال لشركة ميس السعودية للمنتجات الطبية (شركة رائدة في تصنيع المستهلكات الطبية ذات الاستخدام الواحد في الشرق الأوسط، تأسست عام 1994 في الرياض، وملتزمة بأعلى معايير الجودة العالمية):";
                
                const fileInfoEn = data ? "Based *primarily* on the provided data/document content for Saudi Mais Co., and supplementing with your general knowledge where appropriate:" : "Based on your general knowledge of Saudi Mais Co. and the medical device market:";
                const fileInfoAr = data ? "بالاعتماد *بشكل أساسي* على محتوى البيانات/المستند المقدم الخاص بشركة ميس السعودية، مع الاستعانة بمعرفتك العامة عند الاقتضاء:" : "بناءً على معرفتك العامة بشركة ميس السعودية وسوق الأجهزة الطبية:";

                if (lang === 'ar') {
                    return `
                        ${companyContextAr}
                        ${fileInfoAr}
                        قم بإجراء تحليل أعمال متقدم وشامل.
                        يجب أن تشمل الاعتبارات الرئيسية اتجاهات السوق الحالية، والأداء المالي للشركة، والكفاءة التشغيلية، وفرص النمو الاستراتيجية، لا سيما في سياق خطط تطوير الرعاية الصحية ضمن رؤية السعودية 2030، وتخصص الشركة في الأجهزة الطبية ذات الاستخدام الواحد، وبرنامج اكتفاء لتعزيز المحتوى المحلي.
                        ${focus ? `يجب إيلاء تركيز خاص على: ${focus}\n` : ''}
                        يرجى تقديم تقرير مفصل منظم بالأقسام التالية:
                        1.  تحليل بيئة السوق (بما في ذلك الاتجاهات، المنافسة، المشهد التنظيمي المتعلق بالمستهلكات الطبية، وتأثير رؤية 2030).
                        2.  تقييم متعمق للصحة المالية (تقييم الربحية، السيولة، الملاءة، الكفاءة، مع الإشارة إلى النسب الرئيسية إذا أمكن).
                        3.  مراجعة الأداء التشغيلي (التصنيع، سلسلة التوريد، أنظمة مراقبة الجودة ISO 13485، كفاءة الإنتاج).
                        4.  توصيات نمو استراتيجية (قابلة للتنفيذ، ذات أولوية، ومرتبطة برؤية 2030 وبرنامج اكتفاء، بما في ذلك تحسين محفظة المنتجات والتوسع الإقليمي المحتمل).
                        5.  تقييم شامل للمخاطر (السوقية، التشغيلية، المالية، التنظيمية) واستراتيجيات التخفيف منها.
                        تأكد من أن التحليل قابل للتنفيذ ومصمم خصيصًا لشركة مصنعة للمنتجات الطبية مثل شركة ميس السعودية، مع التركيز على الاستدامة والنمو طويل الأجل.
                    `;
                }
                return `
                    ${companyContextEn}
                    ${fileInfoEn}
                    Conduct a comprehensive advanced business analysis.
                    Key considerations should include current market trends, the company's financial performance, operational efficiency, and strategic growth opportunities, particularly within the context of Saudi Vision 2030's healthcare development plans, the company's specialization in single-use medical devices, and the IKTVA program for local content enhancement.
                    ${focus ? `Specific focus should be given to: ${focus}\n` : ''}
                    Please provide a detailed report structured with the following sections:
                    1.  Market Environment Analysis (including trends, competition, regulatory landscape for medical consumables, and Vision 2030 impact).
                    2.  In-depth Financial Health Assessment (evaluating profitability, liquidity, solvency, efficiency, referencing key ratios if possible).
                    3.  Operational Performance Review (manufacturing, supply chain, ISO 13485 quality control systems, production efficiency).
                    4.  Strategic Growth Recommendations (actionable, prioritized, linked to Vision 2030 and IKTVA, including product portfolio optimization and potential regional expansion).
                    5.  Comprehensive Risk Assessment (market, operational, financial, regulatory) and Mitigation Strategies.
                    Ensure the analysis is actionable and tailored to a medical products manufacturer like Saudi Mais Co., focusing on sustainability and long-term growth.
                `;
            });
        }

        function startQualityAnalysis() {
             startAnalysis('quality', (data, focus, lang) => {
                const companyContextEn = "As a specialized quality assurance consultant for Saudi Mais Co. for Medical Products (a leading manufacturer of single-use medical consumables in the Middle East, founded in 1994 in Riyadh, committed to highest international quality standards and adhering to standards like ISO 13485 and SFDA regulations):";
                const companyContextAr = "بصفتك استشاري ضمان جودة متخصص لشركة ميس السعودية للمنتجات الطبية (شركة رائدة في تصنيع المستهلكات الطبية ذات الاستخدام الواحد في الشرق الأوسط، تأسست عام 1994 في الرياض، وملتزمة بأعلى معايير الجودة العالمية وتطبيق معايير مثل ISO 13485 ولوائح الهيئة العامة للغذاء والدواء):";

                const fileInfoEn = data ? "Based *primarily* on the provided quality data/documentation for Saudi Mais Co. (e.g., audit reports, CAPA logs, defect rates), and supplementing with your expertise:" : "Based on your expertise in medical device quality management systems (QMS) and general knowledge of Saudi Mais Co.:";
                const fileInfoAr = data ? "بالاعتماد *بشكل أساسي* على بيانات/وثائق الجودة المقدمة الخاصة بشركة ميس السعودية (مثل تقارير التدقيق، سجلات الإجراءات التصحيحية والوقائية، معدلات العيوب)، مع الاستعانة بخبرتك:" : "بناءً على خبرتك في أنظمة إدارة جودة الأجهزة الطبية (QMS) ومعرفتك العامة بشركة ميس السعودية:";
                
                if (lang === 'ar') {
                    return `
                        ${companyContextAr}
                        ${fileInfoAr}
                        قم بإجراء تحليل شامل لنظام إدارة الجودة (QMS) بالشركة.
                        قيّم فعاليته وامتثاله، خاصةً لمعيار ISO 13485، ولوائح الهيئة العامة للغذاء والدواء السعودية (SFDA) ذات الصلة، والمعايير الدولية الأخرى المطبقة على الأجهزة الطبية ذات الاستخدام الواحد.
                        يجب أن يركز التحليل على: معدلات العيوب الداخلية والخارجية، اتجاهات عدم المطابقة، فعالية نظام الإجراءات التصحيحية والوقائية (CAPA)، تحليل الأسباب الجذرية لمشكلات الجودة، إدارة شكاوى العملاء، إدارة جودة الموردين، وعمليات التدقيق الداخلي والخارجي.
                        ${focus ? `يجب إيلاء تركيز خاص على: ${focus}\n` : ''}
                        يرجى تقديم تقرير شامل يتضمن:
                        1.  الفعالية الإجمالية لنظام إدارة الجودة وحالة الامتثال (ISO 13485, SFDA).
                        2.  تحليل مفصل للعيوب واتجاهات عدم المطابقة (إذا توفرت بيانات، استخدم أمثلة).
                        3.  تقييم قوة نظام CAPA وفعالية تحليل الأسباب الجذرية.
                        4.  تقييم التعامل مع شكاوى العملاء ومقاييس الرضا (إذا توفرت).
                        5.  مراجعة برنامج إدارة جودة الموردين.
                        6.  خطة تحسين جودة قوية وقابلة للتنفيذ مع توصيات ذات أولوية (مثل تعزيز إدارة المخاطر ISO 14971، الاستثمار في أدوات الجودة الرقمية، برامج التدريب المتقدمة).
                        الهدف هو تعزيز جودة المنتج والامتثال التنظيمي لشركة ميس السعودية، وضمان سلامة المرضى.
                    `;
                }
                return `
                    ${companyContextEn}
                    ${fileInfoEn}
                    Conduct a thorough analysis of the company's Quality Management System (QMS).
                    Evaluate its effectiveness and compliance, particularly against ISO 13485, relevant Saudi Food and Drug Authority (SFDA) regulations, and other applicable international standards for single-use medical devices.
                    The analysis should emphasize: internal and external defect rates, non-conformance trends, CAPA system effectiveness, root cause analysis of quality issues, customer complaint management, supplier quality management, and internal/external audit processes.
                    ${focus ? `Specific focus should be given to: ${focus}\n` : ''}
                    Please deliver a comprehensive report including:
                    1.  Overall QMS Effectiveness and Compliance Status (ISO 13485, SFDA).
                    2.  Detailed Defect Analysis and Non-Conformance Trends (if data available, use examples).
                    3.  Assessment of CAPA System robustness and Root Cause Analysis effectiveness.
                    4.  Evaluation of Customer Complaint Handling and Satisfaction Metrics (if available).
                    5.  Review of Supplier Quality Management program.
                    6.  A robust, actionable Quality Improvement Plan with prioritized recommendations (e.g., strengthening ISO 14971 risk management, investing in digital quality tools, advanced training programs).
                    The aim is to enhance product quality, regulatory compliance for Saudi Mais Co., and ensure patient safety.
                `;
            });
        }

        function startDemandForecasting() {
            startAnalysis('demand', (data, focus, lang) => {
                const companyContextEn = "As an expert demand planner and inventory strategist for Saudi Mais Co. for Medical Products (a leading manufacturer of single-use medical consumables in the Middle East, founded in 1994 in Riyadh, aiming to meet increasing regional demand efficiently):";
                const companyContextAr = "بصفتك خبير تخطيط طلب واستراتيجي مخزون لشركة ميس السعودية للمنتجات الطبية (شركة رائدة في تصنيع المستهلكات الطبية ذات الاستخدام الواحد في الشرق الأوسط، تأسست عام 1994 في الرياض، وتهدف إلى تلبية الطلب الإقليمي المتزايد بكفاءة):";

                const fileInfoEn = data ? "Based *primarily* on the provided historical sales, inventory, and market data for Saudi Mais Co.'s single-use medical consumables:" : "Using your analytical expertise and general knowledge of demand patterns for medical consumables in the Middle East, specifically for Saudi Mais Co., considering factors like Vision 2030 healthcare expansion:";
                const fileInfoAr = data ? "بالاعتماد *بشكل أساسي* على بيانات المبيعات والمخزون والسوق التاريخية المقدمة لمستهلكات شركة ميس السعودية الطبية ذات الاستخدام الواحد:" : "باستخدام خبرتك التحليلية ومعرفتك العامة بأنماط الطلب على المستهلكات الطبية في الشرق الأوسط، وتحديداً لشركة ميس السعودية، مع مراعاة عوامل مثل توسع الرعاية الصحية ضمن رؤية 2030:";

                if (lang === 'ar') {
                    return `
                        ${companyContextAr}
                        ${fileInfoAr}
                        قم بإجراء تحليل مفصل لتوقعات الطلب ووضع استراتيجية لتحسين المخزون.
                        حلل البيانات التاريخية (إذا توفرت، مثل بيانات المبيعات لآخر 3-5 سنوات حسب فئة المنتج/وحدة حفظ المخزون) لتحديد الأنماط الموسمية، واتجاهات النمو، وتأثير عوامل مثل مبادرات توسيع الرعاية الصحية (مثل رؤية 2030)، والأحداث الصحية العامة، وإطلاق منتجات جديدة للأجهزة الطبية ذات الاستخدام الواحد.
                        ${focus ? `يجب إيلاء تركيز خاص على: ${focus}\n` : ''}
                        يجب أن يتضمن تقريرك ما يلي:
                        1.  تحليل شامل للطلب: مراجعة اتجاهات المبيعات التاريخية، تحديد محركات الطلب الرئيسية (مثل العقود الحكومية، طلبات المستشفيات الخاصة)، تحليل الموسمية.
                        2.  نتائج التوقعات: توقعات طلب كمية لمدة 12-18 شهرًا (إذا أمكن، حسب فئة المنتج الرئيسية)، مع ذكر النماذج المستخدمة (مثل ARIMA، التمهيد الأسي) ومستوى الثقة المتوقع (MAPE المستهدف). قدم مثالاً لجدول توقعات.
                        3.  استراتيجية تحسين المخزون: توصيات لمستويات المخزون المثلى (باستخدام تحليل ABC)، حسابات مخزون الأمان ونقاط إعادة الطلب، وتقنيات التحكم في المخزون (مثل JIT للمواد المناسبة، إدارة المخزون بطيء الحركة والمتقادم SLOB).
                        4.  خارطة طريق للتنفيذ: الخطوات الرئيسية لشركة ميس السعودية لتنفيذ استراتيجيات التنبؤ والمخزون المقترحة، بما في ذلك تكامل الأنظمة (ERP/SCM) وتدريب الفريق.
                        الهدف هو تحسين دقة التوقعات، وتحسين مستويات المخزون (تقليل التكاليف وزيادة معدل الدوران)، وتقليل حالات نفاد المخزون، وتحسين خدمة العملاء.
                    `;
                }
                return `
                    ${companyContextEn}
                    ${fileInfoEn}
                    Conduct a detailed demand forecasting analysis and develop an inventory optimization strategy.
                    Analyze historical data (if available, e.g., last 3-5 years sales data by product category/SKU) to identify seasonal patterns, growth trends, and the impact of factors such as healthcare expansion initiatives (e.g., Vision 2030), public health events, and new product introductions for single-use medical devices.
                    ${focus ? `Specific focus should be given to: ${focus}\n` : ''}
                    Your report should include:
                    1.  Comprehensive Demand Analysis: Review of historical sales trends, identification of key demand drivers (e.g., government tenders, private hospital orders), seasonality analysis.
                    2.  Forecasting Results: A quantitative 12-18 month demand projection (if possible, by major product category), mentioning models used (e.g., ARIMA, Exponential Smoothing) and expected confidence level (target MAPE). Provide an example forecast table.
                    3.  Inventory Optimization Strategy: Recommendations for optimal inventory levels (using ABC analysis), safety stock calculations, reorder points, and inventory control techniques (e.g., JIT for suitable items, SLOB management).
                    4.  Implementation Roadmap: Key steps for Saudi Mais Co. to implement the proposed forecasting and inventory strategies, including system integration (ERP/SCM) and team training.
                    The goal is to improve forecast accuracy, optimize stock levels (reducing costs and increasing turnover), minimize stockouts, and enhance customer service.
                `;
            });
        }

        function startCompetitorAnalysis() {
             startAnalysis('competitor', (data, focus, lang) => {
                const companyContextEn = "As a market intelligence analyst specializing in the medical device sector for Saudi Mais Co. for Medical Products (a leading manufacturer of single-use medical consumables in the Middle East, founded in 1994 in Riyadh, operating in a competitive Saudi and regional market):";
                const companyContextAr = "بصفتك محلل معلومات سوق متخصص في قطاع الأجهزة الطبية لشركة ميس السعودية للمنتجات الطبية (شركة رائدة في تصنيع المستهلكات الطبية ذات الاستخدام الواحد في الشرق الأوسط، تأسست عام 1994 في الرياض، وتعمل في سوق سعودي وإقليمي تنافسي):";

                const fileInfoEn = data ? "Based *primarily* on the provided competitor data, market reports, and pricing information for Saudi Mais Co.'s single-use medical consumables market:" : "Leveraging your market research skills and knowledge of the competitive landscape for medical device manufacturers in Saudi Arabia and the Middle East, with a focus on Saudi Mais Co.:";
                const fileInfoAr = data ? "بالاعتماد *بشكل أساسي* على بيانات المنافسين وتقارير السوق ومعلومات التسعير المقدمة لسوق مستهلكات شركة ميس السعودية الطبية ذات الاستخدام الواحد:" : "بالاستفادة من مهاراتك في أبحاث السوق ومعرفتك بالمشهد التنافسي لمصنعي الأجهزة الطبية في المملكة العربية السعودية والشرق الأوسط، مع التركيز على شركة ميس السعودية:";

                if (lang === 'ar') {
                    return `
                        ${companyContextAr}
                        ${fileInfoAr}
                        قم بإجراء تحليل تنافسي شامل يركز على أسواق المملكة العربية السعودية والأسواق الرئيسية في دول مجلس التعاون الخليجي للأجهزة الطبية ذات الاستخدام الواحد.
                        حدد المنافسين الرئيسيين (المحليين، الإقليميين، والدوليين)، وحلل حصصهم السوقية التقديرية، ومحافظ منتجاتهم، واستراتيجيات التسعير، وقنوات التوزيع، ونقاط القوة والضعف (SWOT من منظور شركة ميس)، والتكتيكات التسويقية.
                        ${focus ? `يجب إيلاء تركيز خاص على: ${focus}\n` : ''}
                        يرجى تنظيم تحليلك ليشمل:
                        1.  نظرة عامة مفصلة على المشهد السوقي: الحجم، النمو، القطاعات الرئيسية للمستهلكات الطبية، وديناميكيات الشراء (مثل المناقصات الحكومية، مشتريات القطاع الخاص).
                        2.  تقييم تنافسي متعمق: ملفات تعريفية لـ 3-5 منافسين رئيسيين، بما في ذلك تحليل SWOT الخاص بهم، استراتيجياتهم، ووجودهم في السوق.
                        3.  تحليل مقارن (Benchmarking): مقارنة شركة ميس السعودية بالمنافسين على العوامل الرئيسية (جودة المنتج وامتثاله للمعايير، السعر، نطاق المنتج، قوة التوزيع، الابتكار، السمعة، الاستفادة من برنامج اكتفاء). قدم جدول مقارنة.
                        4.  تحديد الفرص والتهديدات التنافسية: بناءً على الديناميكيات التنافسية واتجاهات السوق (مثل ظهور منافسين جدد، تغيير تفضيلات العملاء).
                        5.  توصيات استراتيجية تنافسية: استراتيجيات قابلة للتنفيذ لشركة ميس السعودية لتعزيز مركزها التنافسي، وتمييز عروضها، والاستفادة من فرص السوق المحددة، ومواجهة التهديدات التنافسية.
                        يجب أن يوفر التحليل لشركة ميس السعودية رؤى واضحة لإرشاد استراتيجيتها التنافسية وتخصيص الموارد.
                    `;
                }
                return `
                    ${companyContextEn}
                    ${fileInfoEn}
                    Conduct a comprehensive competitor analysis focusing on the Saudi Arabian and key GCC markets for single-use medical devices.
                    Identify key competitors (local, regional, and international), analyze their estimated market shares, product portfolios, pricing strategies, distribution channels, strengths, weaknesses (SWOT from Mais Co.'s perspective), and marketing tactics.
                    ${focus ? `Specific focus should be given to: ${focus}\n` : ''}
                    Please structure your analysis to include:
                    1.  Detailed Market Landscape Overview: Size, growth, key segments for medical consumables, and purchasing dynamics (e.g., government tenders, private sector procurement).
                    2.  In-depth Competitive Assessment: Profiles of 3-5 key competitors, including their SWOT analysis, strategies, and market presence.
                    3.  Comparative Analysis (Benchmarking): Benchmarking Saudi Mais Co. against competitors on key factors (product quality & compliance, price, product range, distribution strength, innovation, reputation, IKTVA leverage). Provide a comparison table.
                    4.  Identification of Competitive Opportunities and Threats: Based on competitive dynamics and market trends (e.g., emergence of new competitors, changing customer preferences).
                    5.  Strategic Competitive Recommendations: Actionable strategies for Saudi Mais Co. to enhance its competitive positioning, differentiate its offerings, capitalize on identified market opportunities, and counter competitive threats.
                    The analysis should provide Saudi Mais Co. with clear insights to inform its competitive strategy and resource allocation.
                `;
            });
        }

        async function sendMessageToAI(message, loadingTextKey, promptBuilder) {
            const chatMessagesContainer = document.getElementById('chatMessages');
            
            const aiThinkingPara = document.createElement('p');
            const aiStrong = document.createElement('strong');
            aiStrong.textContent = translations[currentLanguage].aiAssistantName;
            aiThinkingPara.appendChild(aiStrong);
            aiThinkingPara.innerHTML += ` <div class="loading-enhanced" style="margin-top: 5px;"><div class="loading-dots"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div>${translations[currentLanguage][loadingTextKey]}</div>`;
            chatMessagesContainer.appendChild(aiThinkingPara);
            chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;

            const prompt = promptBuilder(message, currentLanguage);
            const response = await callGeminiAPI(prompt); 
            
            aiThinkingPara.innerHTML = ''; 
            aiThinkingPara.appendChild(aiStrong); 
            const responseContentDiv = document.createElement('div');
            responseContentDiv.className = 'formatted-content'; 
            responseContentDiv.innerHTML = formatContent(response); 
            aiThinkingPara.appendChild(responseContentDiv);
            
            chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            if (!message) return;

            const chatMessagesContainer = document.getElementById('chatMessages');
            const userPara = document.createElement('p');
            const userStrong = document.createElement('strong');
            userStrong.textContent = currentLanguage === 'ar' ? "أنت:" : "You:";
            userPara.appendChild(userStrong);
            userPara.appendChild(document.createTextNode(` ${message}`));
            chatMessagesContainer.appendChild(userPara);
            input.value = '';

            await sendMessageToAI(message, 'loadingQueryText', (query, lang) => {
                if (lang === 'ar') {
                    return `
                        بصفتك يزيد AI، مستشارك الذكي المخصص لشركة ميس السعودية للمنتجات الطبية (شركة رائدة في تصنيع المستهلكات الطبية ذات الاستخدام الواحد في الشرق الأوسط منذ عام 1994، مقرها الرياض، تركز على الإنتاج عالي الجودة وتواجه حاليًا تحديات في الأعمال):
                        يرجى معالجة استفسار المستخدم التالي بعناية: "${query}".
                        يجب أن يستند ردك إلى ملف الشركة، وديناميكيات أسواق الرعاية الصحية السعودية والشرق أوسطية، وأهداف رؤية السعودية 2030، والاتجاهات الحالية في المعدات والمستهلكات الطبية، وبرنامج اكتفاء. قدم رؤى قابلة للتنفيذ أو تفسيرات واضحة حيثما أمكن، مع الحفاظ على سياق شركة ميس السعودية.
                    `;
                }
                return `
                    As Yazeed AI, your dedicated AI consultant for Saudi Mais Co. for Medical Products (a leading manufacturer of single-use medical consumables in the Middle East since 1994, based in Riyadh, focused on high-quality production and currently navigating business challenges):
                    Please address the following user query thoughtfully: "${query}".
                    Your response should be informed by the company's profile, the dynamics of the Saudi and Middle Eastern healthcare markets, the objectives of Saudi Vision 2030, current trends in medical equipment and consumables, and the IKTVA program. Provide actionable insights or clear explanations where possible, maintaining the context of Saudi Mais Co.
                `;
            });
        }

        async function startComprehensiveAnalysis() {
            const chatMessagesContainer = document.getElementById('chatMessages');
             const analysisTitlePara = document.createElement('p');
             const analysisTitleStrong = document.createElement('strong');
             analysisTitleStrong.textContent = translations[currentLanguage].comprehensiveAnalysisResultTitle;
             analysisTitlePara.appendChild(analysisTitleStrong);
             chatMessagesContainer.appendChild(analysisTitlePara);


            await sendMessageToAI("", 'loadingComprehensiveAnalysisText', (queryIgnored, lang) => {
                if (lang === 'ar') {
                     return `
                        بصفتك يزيد AI، قدم تحليل أعمال استراتيجي شامل ومفصل لشركة ميس السعودية للمنتجات الطبية.
                        ملف الشركة: شركة رائدة في تصنيع المستهلكات الطبية ذات الاستخدام الواحد في الشرق الأوسط، تأسست عام 1994، ومقرها الرياض، المملكة العربية السعودية. تؤكد الشركة على الالتزام بأعلى معايير الجودة العالمية (ISO 13485، متطلبات الهيئة العامة للغذاء والدواء) في إنتاجها وتواجه حاليًا تحديات كبيرة في الأعمال والجوانب المالية.
                        يجب أن يكون تحليلك منظمًا ومفصلاً، ويغطي المجالات الحيوية التالية بعمق:
                        1.  الوضع المالي الحالي واستراتيجيات التعافي الممكنة: تقييم شامل للسيولة، الربحية (تحليل هوامش الربح حسب المنتج/القطاع)، هيكل التكاليف، والديون. اقتراح خطوات عملية ومحددة لتحقيق الاستقرار المالي والتحول الإيجابي، بما في ذلك تحسين رأس المال العامل.
                        2.  المركز السوقي والمشهد التنافسي: تقييم دقيق للحصة السوقية، وتصور العلامة التجارية، والمنافسين الرئيسيين (محليين ودوليين) في قطاع الأجهزة الطبية ذات الاستخدام الواحد. تحليل تأثير مبادرات الرعاية الصحية ضمن رؤية 2030 وبرنامج اكتفاء على وضع الشركة.
                        3.  تقييم الكفاءة التشغيلية: مراجعة تفصيلية لعمليات التصنيع (الكفاءة، الفاقد، استخدام الطاقة الإنتاجية)، إدارة سلسلة التوريد (الموردين، اللوجستيات، المخاطر)، أنظمة مراقبة الجودة (فعالية ISO 13485، معدلات العيوب، CAPA)، وفرص تحسين التكاليف وزيادة الكفاءة بشكل ملموس.
                        4.  فرص النمو الاستراتيجية: تحديد مجالات نمو محتملة ذات أولوية، مثل تطوير منتجات جديدة مبتكرة (في إطار المستهلكات الطبية المتخصصة أو الصديقة للبيئة)، والتوسع المدروس في السوق (إقليميًا مع خطة دخول واضحة)، والاستفادة القصوى من مبادرات المحتوى المحلي (مثل برنامج اكتفاء) من خلال استراتيجيات محددة.
                        5.  خارطة طريق استراتيجية مفصلة: ضع خطة مرحلية (قصيرة 0-1 سنة، متوسطة 1-3 سنوات، طويلة 3-5 سنوات) بأهداف واضحة وقابلة للقياس (SMART)، ومؤشرات أداء رئيسية (KPIs) لكل مرحلة، ومسؤوليات مقترحة.
                        6.  تحليل المخاطر الشامل والتخفيف منها: تحديد المخاطر الرئيسية (المالية، التشغيلية، السوقية، التنظيمية، الجيوسياسية) وتقييم احتمالية وتأثير كل منها. اقتراح استراتيجيات تخفيف محددة وقابلة للتطبيق.
                        ضع تحليلك في سياق رؤية السعودية 2030، والتوجه نحو المحتوى المحلي (اكتفاء)، وإمكانات التوسع الإقليمي في الشرق الأوسط، والتطورات التكنولوجية في قطاع الأجهزة الطبية. يجب أن يكون الناتج احترافيًا، ثاقبًا، ويقدم توصيات واضحة، عملية، وقابلة للتنفيذ لقيادة شركة ميس السعودية نحو التعافي والنمو المستدام.
                    `;
                }
                return `
                    As Yazeed AI, provide a comprehensive and detailed strategic business analysis for Saudi Mais Co. for Medical Products.
                    Company Profile: A leading manufacturer of single-use medical consumables in the Middle East, founded in 1994, located in Riyadh, Saudi Arabia. The company emphasizes adherence to the highest international quality standards (ISO 13485, SFDA compliance) in its production and is currently addressing significant business and financial challenges.
                    Your analysis should be structured and detailed, covering the following critical areas in depth:
                    1.  Current Financial Situation & Viable Recovery Strategies: Comprehensive assessment of liquidity, profitability (margin analysis by product/segment), cost structure, and debt. Propose specific, actionable steps for financial stabilization and turnaround, including working capital optimization.
                    2.  Market Position & Competitive Landscape: Accurate evaluation of market share, brand perception, and key competitors (local and international) in the single-use medical device sector. Analyze the impact of Vision 2030 healthcare initiatives and the IKTVA program on the company's standing.
                    3.  Operational Efficiency Assessment: Detailed review of manufacturing processes (efficiency, waste, capacity utilization), supply chain management (suppliers, logistics, risks), quality control systems (ISO 13485 effectiveness, defect rates, CAPA), and tangible opportunities for cost optimization and efficiency gains.
                    4.  Strategic Growth Opportunities: Identification of prioritized potential growth areas, such as innovative new product development (within specialized or eco-friendly medical consumables), carefully planned market expansion (regional with clear entry strategy), and maximizing local content initiatives (e.g., IKTVA program) through specific strategies.
                    5.  Detailed Strategic Roadmap: Outline a phased plan (short-term 0-1 year, medium-term 1-3 years, long-term 3-5 years) with clear, measurable (SMART) objectives, Key Performance Indicators (KPIs) for each phase, and suggested responsibilities.
                    6.  Comprehensive Risk Analysis and Mitigation: Identify key risks (financial, operational, market, regulatory, geopolitical) and assess the likelihood and impact of each. Propose specific and applicable mitigation strategies.
                    Contextualize your analysis within the framework of Saudi Vision 2030, the drive for local content (IKTVA), potential for regional expansion in the Middle East, and technological advancements in the medical device sector. The output should be professional, insightful, and provide clear, practical, and actionable recommendations for Saudi Mais Co.'s leadership to navigate towards recovery and sustainable growth.
                `;
            });
        }

        document.getElementById('userInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) { 
                e.preventDefault();
                sendMessage();
            }
        });

        window.addEventListener('scroll', function() {
            if (window.innerWidth <= 768) { 
                 document.querySelectorAll('.analysis-card, .section-card, .results-section').forEach(card => {
                    card.style.transform = card.style.transform.replace(/rotateY\([^)]+\)/, 'rotateY(0deg)'); 
                 });
                return;
            }

            const cards = document.querySelectorAll('.analysis-card, .section-card, .results-section');
            cards.forEach((card) => {
                const rect = card.getBoundingClientRect();
                const isVisible = rect.top < window.innerHeight && rect.bottom > 0;
                
                if (isVisible) {
                    const scrollFactor = Math.min(1, Math.max(-1, (rect.top - (window.innerHeight / 2) + (rect.height / 2)) / (window.innerHeight / 2)));
                    const translateZ = 60 - Math.abs(scrollFactor) * 40; 
                    let rotateY = scrollFactor * -7; 
                    if (currentLanguage === 'ar') rotateY *= -1; 
                    const scale = 1 - Math.abs(scrollFactor) * 0.03; 
                    
                    if(Math.abs(rotateY) > 0.5 || Math.abs(1-scale) > 0.005) {
                       card.style.transform = `translateZ(${translateZ}px) rotateY(${rotateY}deg) scale(${scale})`;
                    }
                }
            });
        });

        function saveAnalysisResults(section, results) {
            analysisHistory[section] = {
                timestamp: new Date().toISOString(),
                results: results,
                version: '2.2' 
            };
            try {
                localStorage.setItem('maisAnalysisHistory', JSON.stringify(analysisHistory));
            } catch (e) {
                console.warn("Could not save analysis history to localStorage:", e);
            }
        }

        function loadAnalysisHistory() {
            try {
                const saved = localStorage.getItem('maisAnalysisHistory');
                if (saved) {
                    const loadedHistory = JSON.parse(saved);
                    if (loadedHistory && (loadedHistory.version === '2.1' || loadedHistory.version === '2.2')) { // Basic version check
                         analysisHistory = loadedHistory;
                    } else {
                        analysisHistory = {}; // Clear old history if version mismatch or invalid
                        localStorage.removeItem('maisAnalysisHistory');
                    }
                }
            } catch (error) {
                console.warn('Failed to load analysis history:', error);
                analysisHistory = {}; // Reset on error
            }
        }

        function adjustApiStatusPosition() {
            const apiStatus = document.getElementById('apiStatus');
            if (!apiStatus) return;

            if (window.innerWidth <= 768) {
                if (apiStatus.style.position !== 'relative') {
                    apiStatus.style.position = 'relative';
                    apiStatus.style.top = 'auto';
                    apiStatus.style.right = 'auto';
                    apiStatus.style.left = 'auto';
                    apiStatus.style.margin = '10px auto';
                    apiStatus.style.width = 'fit-content';
                }
            } else {
                 if (apiStatus.style.position !== 'fixed') {
                    apiStatus.style.position = 'fixed';
                    apiStatus.style.top = '20px';
                    apiStatus.style.margin = '0';
                    apiStatus.style.width = 'auto'; 
                    if (currentLanguage === 'ar') {
                        apiStatus.style.left = '20px';
                        apiStatus.style.right = 'auto';
                    } else {
                        apiStatus.style.right = '20px';
                        apiStatus.style.left = 'auto';
                    }
                 }
            }
        }

        window.addEventListener('resize', adjustApiStatusPosition);
        
        document.addEventListener('DOMContentLoaded', function() {
            setLanguage(currentLanguage);
            loadAnalysisHistory();
            adjustApiStatusPosition(); 
            
            const defaultActiveButton = document.querySelector(`.nav-btn[onclick*="showSection('${currentSection}')"]`);
            if (defaultActiveButton) defaultActiveButton.classList.add('active');
            
            const elementsToAnimate = document.querySelectorAll('.analysis-card, .solution-card, .section-card, .company-info');
            elementsToAnimate.forEach((element, index) => {
                element.style.opacity = '0';
                const baseTransformZ = element.classList.contains('company-info') ? '50px' : '40px';
                element.style.transform = `translateZ(0px) translateY(50px)`;
                
                setTimeout(() => {
                    element.style.transition = 'opacity 0.7s ease-out, transform 0.7s cubic-bezier(0.23, 1, 0.320, 1)';
                    element.style.opacity = '1';
                    element.style.transform = `translateZ(${baseTransformZ}) translateY(0px)`;
                }, index * 80); 
            });
        });
    </script>
</body>
</html>