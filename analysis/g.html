<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAIS Medical Products Analysis</title>
    <style>
        :root {
            --primary-color: #0056b3;
            --secondary-color: #4CAF50;
            --background-color: #f9f9f9;
            --card-color: #ffffff;
            --text-color: #333333;
            --border-color: #e0e0e0;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --hover-shadow: 0 10px 15px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            box-shadow: var(--shadow);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .logo img {
            height: 48px;
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav ul li {
            margin-left: 20px;
        }

        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
        }

        nav ul li a:hover {
            color: var(--secondary-color);
        }

        .main-content {
            margin: 40px 0;
        }

        .section-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--primary-color);
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 10px;
            position: relative;
        }

        .input-section {
            background-color: var(--card-color);
            padding: 25px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .product-selection {
            margin-bottom: 25px;
        }

        .select-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: #fff;
            font-size: 16px;
            transition: var(--transition);
        }

        select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 86, 179, 0.2);
        }

        .input-tabs {
            margin-top: 20px;
        }

        .tab-buttons {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .tab-button {
            padding: 10px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: var(--transition);
            color: var(--text-color);
        }

        .tab-button.active {
            border-bottom-color: var(--secondary-color);
            color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .file-upload {
            border: 2px dashed var(--border-color);
            padding: 30px;
            text-align: center;
            border-radius: 6px;
            margin-bottom: 20px;
            transition: var(--transition);
        }

        .file-upload:hover {
            border-color: var(--primary-color);
        }

        .file-upload p {
            margin-bottom: 15px;
            color: #666;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            display: inline-block;
            padding: 10px 25px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            transition: var(--transition);
        }

        .upload-btn:hover {
            background-color: #004494;
        }

        .text-input textarea {
            min-height: 200px;
            resize: vertical;
        }

        .submit-btn {
            display: block;
            width: 100%;
            padding: 14px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 18px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 20px;
        }

        .submit-btn:hover {
            background-color: #3e8e41;
        }

        .submit-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .results-section {
            display: none;
            margin-top: 40px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .result-card {
            background-color: var(--card-color);
            border-radius: 8px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            overflow: hidden;
        }

        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }

        .card-header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 20px;
            font-weight: 500;
            font-size: 18px;
        }

        .card-body {
            padding: 20px;
            min-height: 300px;
            max-height: 500px;
            overflow-y: auto;
        }

        /* Make the "Product Performance" card larger and rectangular */
        #performance-card {
            grid-column: span 2;
            min-height: 400px;
        }

        /* Responsive design improvements */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }

            nav ul {
                margin-top: 15px;
                justify-content: center;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }

            #performance-card {
                grid-column: span 1;
            }

            .footer-content {
                flex-direction: column;
                text-align: center;
            }

            .footer-links {
                margin-top: 15px;
            }
        }

        @media (max-width: 480px) {
            .tab-buttons {
                flex-direction: column;
                border-bottom: none;
            }

            .tab-button {
                border-bottom: 1px solid var(--border-color);
                text-align: left;
                padding: 12px 10px;
            }

            .tab-button.active {
                border-left: 3px solid var(--secondary-color);
                border-bottom: 1px solid var(--border-color);
            }

            .result-card {
                padding: 10px;
            }

            .card-header {
                font-size: 16px;
                padding: 10px;
            }

            .card-body {
                padding: 15px;
            }
        }

        /* Loading Animation Styles */
        .loading {
            display: none;
            text-align: center;
            padding: 30px;
            margin: 20px 0;
        }

        .loading p {
            color: var(--primary-color);
            margin-top: 15px;
            font-size: 18px;
        }

        .spinner {
            width: 70px;
            height: 70px;
            margin: 0 auto;
            border: 8px solid #f3f3f3;
            border-top: 8px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite, pulse 1.5s ease-in-out infinite;
            box-shadow: 0 0 15px rgba(0, 86, 179, 0.2);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }

        /* 3D Support Button Styles */
        .support-btn-3d {
            position: fixed;
            bottom: 32px;
            right: 32px;
            z-index: 9999;
            width: 64px;
            height: 64px;
            background: linear-gradient(145deg, #0056b3 60%, #4CAF50 100%);
            border-radius: 50%;
            box-shadow: 0 8px 24px rgba(0,86,179,0.25), 0 2px 8px rgba(0,0,0,0.10);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            border: none;
            outline: none;
        }
        .support-btn-3d:hover {
            transform: translateY(-6px) scale(1.07);
            box-shadow: 0 16px 32px rgba(0,86,179,0.30), 0 4px 16px rgba(0,0,0,0.12);
        }
        .support-btn-3d svg {
            width: 36px;
            height: 36px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.18));
        }

        /* Support Modal Styles */
        .support-modal-bg {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0; top: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.25);
            align-items: center;
            justify-content: center;
        }
        .support-modal {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,86,179,0.18);
            max-width: 400px;
            width: 95vw;
            padding: 28px 24px 18px 24px;
            position: relative;
            animation: supportModalIn 0.25s;
        }
        @keyframes supportModalIn {
            from { transform: scale(0.92) translateY(40px); opacity: 0; }
            to { transform: scale(1) translateY(0); opacity: 1; }
        }
        .support-modal-close {
            position: absolute;
            top: 14px; right: 18px;
            background: none;
            border: none;
            font-size: 22px;
            color: #888;
            cursor: pointer;
        }
        .support-modal-title {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 12px;
        }
        .support-modal-desc {
            font-size: 15px;
            color: #444;
            margin-bottom: 18px;
        }
        .support-modal textarea {
            width: 100%;
            min-height: 80px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 10px;
            font-size: 15px;
            margin-bottom: 12px;
            resize: vertical;
        }
        .support-modal .support-send-btn {
            background: var(--primary-color);
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 10px 22px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }
        .support-modal .support-send-btn:disabled {
            background: #b0b0b0;
            cursor: not-allowed;
        }
        .support-modal .support-response {
            margin-top: 16px;
            background: #f6faff;
            border-radius: 6px;
            padding: 12px;
            font-size: 15px;
            color: #222;
            min-height: 32px;
            white-space: pre-line;
        }
        .support-modal .support-loading {
            margin-top: 10px;
            color: var(--primary-color);
            font-size: 15px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="../logo.png" alt="MAIS Logo" style="height:48px;">
                </div>
                <nav>
                    <ul>
                        <li><a href="#">Home</a></li>
                        <li><a href="Competitor-analysis.html">Competitor analysis </a></li>
                        <li><a href="#">Reports</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <div class="container">
        <main class="main-content">
            <h1 class="section-title">Sales Data Analysis Platform</h1>
            
            <section class="input-section">
                <div class="product-selection">
                    <div class="select-group">
                        <label for="product-category">Select Product Category:</label>
                        <select id="product-category">
                            <option value="">-- Select Category --</option>
                            <option value="any">any</option>
                            <option value="Airway">Airway</option>
                            <option value="Anesthesia">Anesthesia</option>
                            <option value="Oxygen Therapy">Oxygen Therapy</option>
                            <option value="Neonatal">Neonatal</option>
                            <option value="I.V. Therapy">I.V. Therapy</option>
                            <option value="Syringes">Syringes</option>
                            <option value="Kits & Sets">Kits & Sets</option>
                            <option value="Hemodialysis">Hemodialysis</option>
                            <option value="Tubes & Catheters">Tubes & Catheters</option>
                            <option value="Pulse Oximeter">Pulse Oximeter</option>
                            <option value="General Surgery">General Surgery</option>
                            <option value="Urology">Urology</option>
                            <option value="Obstetrics & Gynecology">Obstetrics & Gynecology</option>
                            <option value="Miscellaneous">Miscellaneous</option>
                        </select>
                    </div>
                    <div class="select-group">
                        <label for="product-subcategory">Select Specific Product:</label>
                        <select id="product-subcategory" disabled>
                            <option value="">-- Optional --</option>
                        </select>
                    </div>
                </div>
                
                <div class="input-tabs">
                    <div class="tab-buttons">
                        <button class="tab-button active" data-tab="file-tab">Upload File</button>
                        <button class="tab-button" data-tab="text-tab">Enter Text</button>
                    </div>
                    
                    <div id="file-tab" class="tab-content active">
                        <div class="file-upload">
                            <p>Drag and drop a file or click the button below</p>
                            <input type="file" id="file-input" class="file-input" accept=".pdf,.doc,.docx,.xls,.xlsx,.csv,.txt">
                            <label for="file-input" class="upload-btn">Choose File</label>
                            <p id="file-name" style="margin-top: 10px; font-size: 14px;"></p>
                        </div>
                    </div>
                    
                    <div id="text-tab" class="tab-content">
                        <div class="text-input">
                            <label for="analysis-text">Enter text for analysis:</label>
                            <textarea id="analysis-text" placeholder="Paste your text here for analysis..."></textarea>
                        </div>
                    </div>
                    
                    <button id="analyze-btn" class="submit-btn" disabled>Analyze Data</button>
                </div>
            </section>
            
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>جاري تحليل البيانات... يرجى الانتظار</p>
            </div>
            
            <section id="results-section" class="results-section">
                <h2 class="section-title">Analysis Results</h2>
                
                <div class="results-grid">
                    <div class="result-card">
                        <div class="card-header">Comprehensive Analysis</div>
                        <div class="card-body" id="analysis-content">
                            <!-- Analysis content will be loaded here -->
                        </div>
                    </div>
                    
                    <div id="performance-card" class="result-card">
                        <div class="card-header">Product Performance</div>
                        <div class="card-body" id="performance-content">
                            <!-- Performance table will be loaded here -->
                        </div>
                    </div>
                    
                    <div class="result-card">
                        <div class="card-header">AI Insights</div>
                        <div class="card-body" id="insights-content">
                            <!-- AI insights will be loaded here -->
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>
    
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">MAIS Analytics by YAZEED</div>
                <div class="footer-links">
                    <a href="#">Privacy Policy</a>
                    <a href="#">Terms of Service</a>
                    <a href="#">Support</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- 3D Support Button -->
    <button class="support-btn-3d" id="support-btn" title="دعم فني">
        <!-- 3D headset icon SVG -->
        <svg viewBox="0 0 64 64" fill="none">
            <defs>
                <radialGradient id="g1" cx="50%" cy="50%" r="70%">
                    <stop offset="0%" stop-color="#4CAF50"/>
                    <stop offset="100%" stop-color="#0056b3"/>
                </radialGradient>
            </defs>
            <ellipse cx="32" cy="32" rx="30" ry="30" fill="url(#g1)" />
            <ellipse cx="32" cy="38" rx="18" ry="10" fill="#fff" opacity="0.18"/>
            <path d="M16 36v-6c0-8.8 7.2-16 16-16s16 7.2 16 16v6" stroke="#fff" stroke-width="3" stroke-linecap="round"/>
            <rect x="14" y="36" width="8" height="14" rx="4" fill="#fff" stroke="#0056b3" stroke-width="2"/>
            <rect x="42" y="36" width="8" height="14" rx="4" fill="#fff" stroke="#0056b3" stroke-width="2"/>
            <circle cx="32" cy="32" r="7" fill="#fff" stroke="#0056b3" stroke-width="2"/>
            <ellipse cx="32" cy="32" rx="4" ry="4" fill="#4CAF50"/>
            <path d="M50 50c0 4-6 6-18 6s-18-2-18-6" stroke="#0056b3" stroke-width="2" stroke-linecap="round"/>
        </svg>
    </button>

    <!-- Support Modal -->
    <div class="support-modal-bg" id="support-modal-bg">
        <div class="support-modal">
            <button class="support-modal-close" id="support-modal-close" title="إغلاق">&times;</button>
            <div class="support-modal-title">الدعم الفني - MAIS</div>
            <div class="support-modal-desc">اكتب مشكلتك أو استفسارك حول منصة MAIS وسيتم الرد عليك بواسطة الذكاء الاصطناعي.</div>
            <textarea id="support-input" placeholder="صف مشكلتك أو سؤالك هنا..."></textarea>
            <button class="support-send-btn" id="support-send-btn" disabled>إرسال</button>
            <div class="support-loading" id="support-loading" style="display:none;">Thinking and writing now</div>
            <div class="support-response" id="support-response"></div>
        </div>
    </div>

    <script>
        // DOM elements
        const productCategorySelect = document.getElementById('product-category');
        const productSubcategorySelect = document.getElementById('product-subcategory');
        const fileInput = document.getElementById('file-input');
        const fileName = document.getElementById('file-name');
        const analysisText = document.getElementById('analysis-text');
        const analyzeBtn = document.getElementById('analyze-btn');
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        const loadingDiv = document.getElementById('loading');
        const resultsSection = document.getElementById('results-section');
        const analysisContent = document.getElementById('analysis-content');
        const performanceContent = document.getElementById('performance-content');
        const insightsContent = document.getElementById('insights-content');
        
        // Current active tab
        let activeTab = 'file-tab';

        // Airway subcategories
        const airwaySubcategories = [
            "Pharyngeal Airway",
            "Naso-Pharyngeal Airway-PVC",
            "Naso-Pharyngeal Airway-Silicon",
            "laryngeal Airway Mask -PVC",
            "laryngeal Airway Mask (Reinforced Reusable -silicon)",
            "laryngeal Airway Mask set (Reinforced Reusable -silicon)",
            "All-Silicone Tracheostomy Tube : Un-Cuffed",
            "All-Silicone Tracheostomy Tube : Cuffed",
            "Tracheostomy     Tube                       Tracheostomy Mask"
        ];

        // Anesthesia subcategories
        const anesthesiaSubcategories = [
            "Anesthesia Breathing circuit (Smooth Bore )",
            "Anesthesia Breathing circuit (corrugated)",
            "Ventelation Breathing Circuit",
            "Catheter Mount",
            "Breathing Bag ( Antistatic ) Reusable",
            "MdI meter Dose",
            "Bacterial & Viral Filters",
            "Bacterial /Viral Filter With Heat & Moisture exchange Type",
            "Bacterial /Viral Filter With Heat & Moisture exchange Type (Artificial Nose )",
            "Tracheostomy HME Filter",
            "E.T.T preformed (South Facing-oral) Cuffed",
            "E.T.T preformed (north Facing Nasal) Cuffed",
            "E.T.T preformed (South Facing-oral) UNCuffed",
            "E.T.T preformed (north Facing Nasal) UNCuffed",
            "Endotracheal Tubes Oral/Nasal-Cuffed",
            "Endotracheal Tubes Reinforced Oral/Nasal-Cuffed",
            "Endotracheal Tubes Oral/Nasal-UnCffed",
            "Endotracheal Tubes Reinforced Oral/Nasal-UnCffed"
        ];

        // Oxygen Therapy subcategories
        const oxygenTherapySubcategories = [
            "Oxygen Nasal Cannula",
            "Aerosol Mask Without Tube",
            "Nebulizer Mask With tube",
            "Oxygen Catheter",
            "Oxygen Mask With tube",
            "Nebulizer kit with (T-mouth pc , 15cm corrugated tube )",
            "Aerosol Mask with Tube",
            "Non-Rebreathing Mask",
            "Partially Non Rebreathing Mask",
            "Venturi Mask /Mask Vent Adult",
            "Accessories",
            "Oxygen Catheter"
        ];

        // Neonatal subcategories
        const neonatalSubcategories = [
            "Polyurethane Catheter",
            "Positioning Aid / Snuggle Ups",
            "NCAP-Hat(cap)",
            "Eye Protector",
            "Little Suckers/Neosuchers-neonate Gentle Plastic",
            "Nasal Prong , Maximum Patient flow 6 1/min",
            "NCPAP Mask",
            "Hat For Neonate",
            "Infant bonnet , head cover to keep the premature and newborn Warm, Soft,latex free",
            "SIPAP Inflow flow circuit"
        ];

        // I.V. Therapy subcategories
        const ivTherapySubcategories = [
            "Blood Transfusion Set with “y” injection site- sterile",
            "blood Administrator set -Burette Type -Sterile",
            "Blood filter for removal of blood clots-sterile",
            "I.V Infusion set With “Y” injection site / Administration set",
            "I.V Infusion set With flow control",
            "Burette I.V Infusion set With “Y” Injection site",
            "Infusion Accessories",
            "Transfer Set",
            "Venting Needle",
            "I.V. adhesive Fixer"
        ];

        // Syringes subcategories
        const syringesSubcategories = [
            "Dual Syringe Injector",
            "Special Syringes",
            "Syringe Insulin (sterile)",
            "Syringe Luer Lock/side Nozzle (Sterile)",
            "Syringe luer tip (sterile)"
        ];

        // Hemodialysis subcategories
        const hemodialysisSubcategories = [
            "Blood Lines for (Fresenius Machines) – Sterile",
            "Blood Lines for (Other Machines) – Sterile",
            "Arterial Venous Catheter for Haemodialysis – Sterile",
            "Hemodialyzer Filters – Sterile",
            "Cartridge for hemodialysis – Non Sterile",
            "Fistula Needle – Sterile",
            "Fistula Needle Set (Pair) – Sterile",
            "“Y” Connector for Single Needle Dialysis – Sterile",
            "Trans Urethral Resection Catheter – Sterile",
            "Dialysis Catheter (short term): Single Lumen Catheter",
            "Blood Lines for (Gambro Machines) – Sterile",
            "Blood Lines for (B. Braun Machines) – Sterile"
        ];

        // Pulse Oximeter subcategories
        const pulseOximeterSubcategories = [
            "Sensor Oxygen Forehead Masimo SET Technology",
            "SPO2 Probe with Adhesive Tape Masimo SET Technology",
            "Pulse Oximeter Sensor Probe Adhesive Tape Masimo SET Technology",
            "Saturation Probe Neonates Nellcor Technology",
            "Skin Temperature Probe Giraffe Incubator",
            "Saturation Probe (For Pulse Oximeter) Finger Tip",
            "Temperature Probe"
        ];

        // General Surgery subcategories
        const generalSurgerySubcategories = [
            "PVC Wound Drainage Set (Silicon Multi Channel Tube)",
            "Open Surgery Abdominal Drain (Without trocar) Sterile",
            "Hi-Vacuum Wound Drainage Set Spring Type",
            "Silicon Hubless Wound Drainage (Silicon Multi Channel Tube)",
            "Wound Drainage Set Pre-evacuated – Sterile",
            "Wound Drainage Set Bellow Pump – Sterile",
            "Under Water Drainage System 2000/3000 Thoracic",
            "Under Water Drainage System 700/2000 Pleural",
            "Under Water Drainage System: Two Bottle",
            "Under Water Drainage System: One Bottle"
        ];

        // Urology subcategories
        const urologySubcategories = [
            "Tiemann Catheter",
            "Nelaton Catheter Male",
            "Nelaton Catheter Female",
            "Double Lumen Catheter, Radio-Opaque, Graduated Soft Tip",
            "Set Replacement, Polyurethane Pigtail",
            "2-Way Foley Catheter 100% Pure Silicone",
            "2-Way Foley Catheter Natural Latex Silicone Coated",
            "Ureteral Stent (Indwelling Catheter) Distal End Opened – PUR",
            "Ureteral Stent (Indwelling Catheter) Distal End Closed – PUR"
        ];

        // Obstetrics & Gynecology subcategories
        const obstetricsGynecologySubcategories = [
            "Vaginal Dilator Set",
            "Water Based Gel"
        ];

        // Miscellaneous subcategories
        const miscellaneousSubcategories = [
            "IV Cannula With Port – Sterile",
            "IV Cannula Without Port (Small Wings) – Sterile",
            "Safety Intravenous (I.V) Cannula",
            "Scalp Vein",
            "IV Butterfly",
            "Vacuum Tube",
            "Multi Sample Needle",
            "Multi Sample Holder & Adapter",
            "Arterial Catheter"
        ];

        // Update subcategory dropdown based on category selection
        productCategorySelect.addEventListener('change', function() {
            if (this.value === "Airway") {
                productSubcategorySelect.innerHTML = '<option value="">-- Optional --</option>';
                airwaySubcategories.forEach(sub => {
                    const opt = document.createElement('option');
                    opt.value = sub;
                    opt.textContent = sub;
                    productSubcategorySelect.appendChild(opt);
                });
                productSubcategorySelect.disabled = false;
            } else if (this.value === "Anesthesia") {
                productSubcategorySelect.innerHTML = '<option value="">-- Optional --</option>';
                anesthesiaSubcategories.forEach(sub => {
                    const opt = document.createElement('option');
                    opt.value = sub;
                    opt.textContent = sub;
                    productSubcategorySelect.appendChild(opt);
                });
                productSubcategorySelect.disabled = false;
            } else if (this.value === "Oxygen Therapy") {
                productSubcategorySelect.innerHTML = '<option value="">-- Optional --</option>';
                oxygenTherapySubcategories.forEach(sub => {
                    const opt = document.createElement('option');
                    opt.value = sub;
                    opt.textContent = sub;
                    productSubcategorySelect.appendChild(opt);
                });
                productSubcategorySelect.disabled = false;
            } else if (this.value === "Neonatal") {
                productSubcategorySelect.innerHTML = '<option value="">-- Optional --</option>';
                neonatalSubcategories.forEach(sub => {
                    const opt = document.createElement('option');
                    opt.value = sub;
                    opt.textContent = sub;
                    productSubcategorySelect.appendChild(opt);
                });
                productSubcategorySelect.disabled = false;
            } else if (this.value === "I.V. Therapy") {
                productSubcategorySelect.innerHTML = '<option value="">-- Optional --</option>';
                ivTherapySubcategories.forEach(sub => {
                    const opt = document.createElement('option');
                    opt.value = sub;
                    opt.textContent = sub;
                    productSubcategorySelect.appendChild(opt);
                });
                productSubcategorySelect.disabled = false;
            } else if (this.value === "Syringes") {
                productSubcategorySelect.innerHTML = '<option value="">-- Optional --</option>';
                syringesSubcategories.forEach(sub => {
                    const opt = document.createElement('option');
                    opt.value = sub;
                    opt.textContent = sub;
                    productSubcategorySelect.appendChild(opt);
                });
                productSubcategorySelect.disabled = false;
            } else if (this.value === "Kits & Sets") {
                productSubcategorySelect.innerHTML = '<option value="">-- Optional --</option>';
                const kitsAndSetsSubcategories = [
                    "CVC Single Lumen with J trip guide wire – Sterile",
                    "CVC Double Lumen with J trip guide wire – Sterile",
                    "CVC Triple Lumen with J trip guide wire – Sterile",
                    "CVC Four Lumen with J trip guide wire – Sterile",
                    "CVC Five Lumen with J trip guide wire – Sterile",
                    "HDC Single Lumen Catheter Set (Straight/ Femoral with J trip guide wire)",
                    "HDC Double Lumen Catheter Set (Straight/ Femoral with J trip guide wire)",
                    "HDC Single Lumen Catheter Set (curved with J trip guide wire)",
                    "HDC Double Lumen Catheter Set (curved/Jugular with J trip guide wire)",
                    "HDC Triple Lumen Catheter Set (straight/Femoral with J trip guide wire)",
                    "HDC Triple Lumen Catheter Set (curved/Jugular with J trip guide wire)",
                    "Peritoneal Dialysis Catheter Set – PDC",
                    "Permthane Double Lumen Catheter Set",
                    "Lumbar Puncture Set – Sterilized",
                    "Combined Spinal – Epidural Set – Sterilized",
                    "Epidural Set – Sterilized",
                    "Biopsy Set – Sterilized",
                    "Tracheostomy Care Kit",
                    "Patient Care Kit",
                    "Suction Catheter Kit"
                ];
                kitsAndSetsSubcategories.forEach(sub => {
                    const opt = document.createElement('option');
                    opt.value = sub;
                    opt.textContent = sub;
                    productSubcategorySelect.appendChild(opt);
                });
                productSubcategorySelect.disabled = false;
            } else if (this.value === "Hemodialysis") {
                productSubcategorySelect.innerHTML = '<option value="">-- Optional --</option>';
                hemodialysisSubcategories.forEach(sub => {
                    const opt = document.createElement('option');
                    opt.value = sub;
                    opt.textContent = sub;
                    productSubcategorySelect.appendChild(opt);
                });
                productSubcategorySelect.disabled = false;
            } else if (this.value === "Tubes & Catheters") {
                productSubcategorySelect.innerHTML = '<option value="">-- Optional --</option>';
                const tubesAndCathetersSubcategories = [
                    "Feeding Tube with Guide Wire – Silicon",
                    "Enteral Feeding Bag with Set",
                    "Feeding Tube with X-Ray Line",
                    "Feeding Tube Gastrostomy – Silicone",
                    "Ryles Tubes with X-Ray Line",
                    "Rectal Tube",
                    "Drainage Tubes",
                    "Extension / Connection Tubes",
                    "Suction Connection Tubes (ID=5.0mm, 7.0mm) – Sterile",
                    "Nasojejunal Feeding Tube / Suction Silicon Tube",
                    "I.V. Amber Tubing",
                    "Suction Catheter with Finger Control Tip",
                    "Suction Catheter Funnel Type",
                    "CO₂ Gas Tubing Compatible with Insufflator (150–200 cm)",
                    "Laparoscopic",
                    "Adaptor",
                    "Thoracic Catheter Right Angle with Connector without Trocar",
                    "Thoracic Catheter Straight with Connector without Trocar",
                    "Thoracic Catheter Straight with Trocar"
                ];
                tubesAndCathetersSubcategories.forEach(sub => {
                    const opt = document.createElement('option');
                    opt.value = sub;
                    opt.textContent = sub;
                    productSubcategorySelect.appendChild(opt);
                });
                productSubcategorySelect.disabled = false;
            } else if (this.value === "Pulse Oximeter") {
                productSubcategorySelect.innerHTML = '<option value="">-- Optional --</option>';
                pulseOximeterSubcategories.forEach(sub => {
                    const opt = document.createElement('option');
                    opt.value = sub;
                    opt.textContent = sub;
                    productSubcategorySelect.appendChild(opt);
                });
                productSubcategorySelect.disabled = false;
            } else if (this.value === "General Surgery") {
                productSubcategorySelect.innerHTML = '<option value="">-- Optional --</option>';
                generalSurgerySubcategories.forEach(sub => {
                    const opt = document.createElement('option');
                    opt.value = sub;
                    opt.textContent = sub;
                    productSubcategorySelect.appendChild(opt);
                });
                productSubcategorySelect.disabled = false;
            } else if (this.value === "Urology") {
                productSubcategorySelect.innerHTML = '<option value="">-- Optional --</option>';
                urologySubcategories.forEach(sub => {
                    const opt = document.createElement('option');
                    opt.value = sub;
                    opt.textContent = sub;
                    productSubcategorySelect.appendChild(opt);
                });
                productSubcategorySelect.disabled = false;
            } else if (this.value === "Obstetrics & Gynecology") {
                productSubcategorySelect.innerHTML = '<option value="">-- Optional --</option>';
                obstetricsGynecologySubcategories.forEach(sub => {
                    const opt = document.createElement('option');
                    opt.value = sub;
                    opt.textContent = sub;
                    productSubcategorySelect.appendChild(opt);
                });
                productSubcategorySelect.disabled = false;
            } else if (this.value === "Miscellaneous") {
                productSubcategorySelect.innerHTML = '<option value="">-- Optional --</option>';
                miscellaneousSubcategories.forEach(sub => {
                    const opt = document.createElement('option');
                    opt.value = sub;
                    opt.textContent = sub;
                    productSubcategorySelect.appendChild(opt);
                });
                productSubcategorySelect.disabled = false;
            }
            updateAnalyzeButtonState();
        });
        
        // Handle file selection
        fileInput.addEventListener('change', function() {
            if (this.files.length > 0) {
                fileName.textContent = this.files[0].name;
            } else {
                fileName.textContent = '';
            }
            updateAnalyzeButtonState();
        });
        
        // Handle text input
        analysisText.addEventListener('input', updateAnalyzeButtonState);
        
        // Tab switching functionality
        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // Update active tab
                tabButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                // Show active tab content
                tabContents.forEach(content => content.classList.remove('active'));
                document.getElementById(tabId).classList.add('active');
                
                activeTab = tabId;
                updateAnalyzeButtonState();
            });
        });
        
        // Check if all required fields are filled to enable analyze button
        function updateAnalyzeButtonState() {
            const categorySelected = productCategorySelect.value !== '';
            // subcategory is now always optional
            let dataProvided = false;
            if (activeTab === 'file-tab') {
                dataProvided = fileInput.files.length > 0;
            } else {
                dataProvided = analysisText.value.trim() !== '';
            }
            analyzeBtn.disabled = !(categorySelected && dataProvided);
        }
        
        // Analyze button click handler
        analyzeBtn.addEventListener('click', async function() {
            // Show loading spinner
            loadingDiv.style.display = 'block';
            resultsSection.style.display = 'none';
            
            try {
                // Get selected product information
                const category = productCategorySelect.options[productCategorySelect.selectedIndex].text;
                const subcategory = ""; // always empty for now

                // Get input data (text or file)
                let inputData = '';
                if (activeTab === 'text-tab') {
                    inputData = analysisText.value.trim();
                } else {
                    inputData = `Data from file: ${fileName.textContent}`;
                }

                // Perform sales analysis with Groq API
                const results = await analyzeWithGroq(category, subcategory, inputData);
                
                // Display results
                displayResults(results);
                
                // Hide loading spinner and show results
                loadingDiv.style.display = 'none';
                resultsSection.style.display = 'block';
                
                // Scroll to results
                resultsSection.scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                console.error('Sales analysis error:', error);
                alert('An error occurred during sales analysis. Please try again.');
                loadingDiv.style.display = 'none';
            }
        });
        
        // Function to analyze sales data using Groq API
        async function analyzeWithGroq(category, subcategory, inputData) {
            const GROQ_API_KEY = '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';
            const GROQ_API_ENDPOINT = 'https://api.groq.com/openai/v1/chat/completions';
            const MODEL_NAME = 'deepseek-r1-distill-llama-70b';
            
            // Create a detailed system prompt
            const systemPrompt = `You are an advanced AI specialized in sales data analysis for MAIS. 
Your primary focus is on identifying patterns, trends, profitable areas, and areas of loss in sales data.

When analyzing data, follow these precise steps:
1. Understand the context of the sales data provided.
2. Identify key metrics, trends, and patterns related to sales performance.
3. Highlight profitable areas and areas of loss with specific causes.
4. Compare against industry benchmarks and historical sales data.
5. Provide actionable recommendations to improve sales performance.
6. Offer strategic insights for optimizing sales strategies.

Provide your analysis in three distinct sections:
1. COMPREHENSIVE ANALYSIS: A detailed assessment of sales performance, trends, and overall business impact. Include relevant metrics and their interpretation.
2. PERFORMANCE TABLE: A structured assessment of profitable vs. loss-making areas, specific causes for each, and actionable recommendations. Format this as a clear HTML table.
3. STRATEGIC INSIGHTS: Provide unexpected, high-value observations that could significantly impact sales strategies.

Your analysis should be evidence-based, strategic, and actionable. Highlight specific numbers and metrics where possible. Focus on providing concrete, specific insights rather than general observations.`;

            // Prepare the API request
            const response = await fetch(GROQ_API_ENDPOINT, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${GROQ_API_KEY}`
                },
                body: JSON.stringify({
                    model: MODEL_NAME,
                    messages: [
                        { role: "system", content: systemPrompt },
                        { role: "user", content: `Please analyze the following data for ${category} - ${subcategory}: ${inputData}` }
                    ],
                    temperature: 0.5,
                    max_tokens: 2000
                })
            });
            
            if (!response.ok) {
                throw new Error(`API request failed with status: ${response.status}`);
            }
            
            const responseData = await response.json();
            const analysisText = responseData.choices[0].message.content;
            
            // Parse the response into our three sections
            // This is a simplified approach - in production, you might want a more robust parsing
            const sections = parseAnalysisResponse(analysisText);
            
            return sections;
        }
        
        // Function to parse the Groq response into sections
        function parseAnalysisResponse(text) {
            // For demonstration purposes, let's create a basic parser
            // In production, you would need more robust parsing logic
            
            // Example parsing logic - looking for section headers
            const comprehensiveAnalysisMatch = text.match(/COMPREHENSIVE ANALYSIS:?([\s\S]*?)(?=PERFORMANCE TABLE:|STRATEGIC INSIGHTS:|$)/i);
            const performanceTableMatch = text.match(/PERFORMANCE TABLE:?([\s\S]*?)(?=STRATEGIC INSIGHTS:|$)/i);
            const strategicInsightsMatch = text.match(/STRATEGIC INSIGHTS:?([\s\S]*?)$/i);
            
            return {
                analysis: comprehensiveAnalysisMatch ? comprehensiveAnalysisMatch[1].trim() : "Analysis not available",
                performance: performanceTableMatch ? performanceTableMatch[1].trim() : "Performance data not available",
                insights: strategicInsightsMatch ? strategicInsightsMatch[1].trim() : "Insights not available"
            };
        }
        
        // Function to display results
        function displayResults(results) {
            // Format and display comprehensive analysis
            analysisContent.innerHTML = formatContent(results.analysis);
            
            // Format and display performance table (convert text to HTML table if needed)
            performanceContent.innerHTML = formatPerformanceTable(results.performance);
            
            // Format and display insights
            insightsContent.innerHTML = formatContent(results.insights);
        }
        
        // Helper function to format content with markdown-like syntax
        function formatContent(text) {
            // Basic formatting for demonstration purposes
            // In production, you might want to use a proper markdown parser
            
            // Replace line breaks with paragraph tags
            let formatted = text.replace(/\n\n/g, '</p><p>').replace(/\n/g, '<br>');
            
            // Wrap in paragraph tags if not already
            if (!formatted.startsWith('<p>')) {
                formatted = '<p>' + formatted;
            }
            if (!formatted.endsWith('</p>')) {
                formatted = formatted + '</p>';
            }
            
            // Format bold text
            formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // Format italic text
            formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // Format highlighting
            formatted = formatted.replace(/==(.*?)==/g, '<span class="text-highlight">$1</span>');
            
            return formatted;
        }
        
        // Helper function to format performance table
        function formatPerformanceTable(text) {
            // Check if text already contains HTML table
            if (text.includes('<table')) {
                return text;
            }
            
            // Otherwise, create a basic table from the text
            let tableHtml = `
            <table>
                <thead>
                    <tr>
                        <th>Aspect</th>
                        <th>Status</th>
                        <th>Cause</th>
                        <th>Recommendation</th>
                    </tr>
                </thead>
                <tbody>`;
            
            // Simple parsing logic - this is basic for demonstration
            // In production, you would need more robust parsing
            const lines = text.split('\n').filter(line => line.trim() !== '');
            
            let inWinningSection = false;
            let inLosingSection = false;
            
            for (const line of lines) {
                if (line.toLowerCase().includes('winning') || line.toLowerCase().includes('strengths')) {
                    inWinningSection = true;
                    inLosingSection = false;
                    continue;
                } else if (line.toLowerCase().includes('losing') || line.toLowerCase().includes('weaknesses')) {
                    inWinningSection = false;
                    inLosingSection = true;
                    continue;
                }
                
                // Simple heuristic to extract point, cause, and recommendation
                // This is simplified for demonstration purposes
                const parts = line.split(':').map(part => part.trim());
                let aspect = parts[0] || "General";
                let details = parts.length > 1 ? parts[1] : line;
                
                // Further split details if possible
                const detailParts = details.split('.').map(part => part.trim()).filter(Boolean);
                let cause = detailParts[0] || "Not specified";
                let recommendation = detailParts.length > 1 ? detailParts[1] : "See analysis for details";
                
                const status = inWinningSection ? "Winning" : inLosingSection ? "Losing" : "Neutral";
                const statusClass = inWinningSection ? "status-success" : inLosingSection ? "status-danger" : "";
                
                tableHtml += `
                <tr>
                    <td>${aspect}</td>
                    <td class="${statusClass}">${status}</td>
                    <td>${cause}</td>
                    <td>${recommendation}</td>
                </tr>`;
            }
            
            tableHtml += `
                </tbody>
            </table>
            <p><em>Note: This table is automatically generated from the analysis text.</em></p>`;
            
            return tableHtml;
        }
        
        // File drag and drop functionality
        const dropZone = document.querySelector('.file-upload');
        
        dropZone.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.style.borderColor = '#0056b3';
            this.style.backgroundColor = 'rgba(0, 86, 179, 0.05)';
        });
        
        dropZone.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.style.borderColor = '';
            this.style.backgroundColor = '';
        });
        
        dropZone.addEventListener('drop', function(e) {
            e.preventDefault();
            this.style.borderColor = '';
            this.style.backgroundColor = '';
            
            if (e.dataTransfer.files.length > 0) {
                fileInput.files = e.dataTransfer.files;
                fileName.textContent = e.dataTransfer.files[0].name;
                updateAnalyzeButtonState();
            }
        });

        // ====== Support Button & Modal Logic ======
        const supportBtn = document.getElementById('support-btn');
        const supportModalBg = document.getElementById('support-modal-bg');
        const supportModalClose = document.getElementById('support-modal-close');
        const supportInput = document.getElementById('support-input');
        const supportSendBtn = document.getElementById('support-send-btn');
        const supportLoading = document.getElementById('support-loading');
        const supportResponse = document.getElementById('support-response');

        // Open modal
        supportBtn.addEventListener('click', () => {
            supportModalBg.style.display = 'flex';
            supportInput.value = '';
            supportResponse.textContent = '';
            supportSendBtn.disabled = true;
            supportLoading.style.display = 'none';
        });
        // Close modal
        supportModalClose.addEventListener('click', () => {
            supportModalBg.style.display = 'none';
        });
        // Enable send button if input not empty
        supportInput.addEventListener('input', () => {
            supportSendBtn.disabled = supportInput.value.trim() === '';
        });

        // Send support request
        supportSendBtn.addEventListener('click', async () => {
            const userMsg = supportInput.value.trim();
            if (!userMsg) return;
            supportSendBtn.disabled = true;
            supportLoading.style.display = 'block';
            supportResponse.textContent = '';
            try {
                const reply = await supportGeminiAPI(userMsg);
                supportResponse.textContent = reply;
            } catch (e) {
                supportResponse.textContent = 'حدث خطأ أثناء التواصل مع الدعم. حاول مرة أخرى.';
            }
            supportLoading.style.display = 'none';
            supportSendBtn.disabled = false;
        });

        // Gemini API call for support
        const apiKey = 'AIzaSyCMrm1LjmlJObZsVCQEuy_wTkh9ZEEc8aQ'; // ضع هنا مفتاح API الفعلي

        async function geminiRequest(prompt) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            const body = {
                contents: [
                    { role: "user", parts: [{ text: prompt }] }
                ]
            };
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });
            if (!response.ok) throw new Error('API error');
            const data = await response.json();
            // Gemini response structure
            return data.candidates?.[0]?.content?.parts?.[0]?.text?.trim() || "لم يتم الحصول على رد من الدعم.";
        }

        async function supportGeminiAPI(userMsg) {
            const supportPrompt = `أنت مساعد دعم فني ذكي لمنصة MAIS. 
ساعد المستخدمين في حل مشاكلهم التقنية أو استفساراتهم حول استخدام المنصة أو منتجاتها أو تقاريرها.
- أجب بشكل واضح ومباشر وبأسلوب ودود.
- إذا كان السؤال خارج نطاق MAIS، اعتذر بلطف ووجه المستخدم للاتصال بالدعم البشري إذا لزم الأمر.
- لا تقدم نصائح طبية أو مالية.
- إذا كان السؤال عن بيانات أو تقارير، وضح كيفية رفع البيانات أو الاستفادة من التحليلات.
- أجب باللغة العربية الفصحى.

سؤال المستخدم: ${userMsg}`;
            return await geminiRequest(supportPrompt);
        }
    </script>
</body>
</html>
